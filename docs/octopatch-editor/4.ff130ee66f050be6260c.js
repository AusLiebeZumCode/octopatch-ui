(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{A2ki:function(t,e,n){(function(){void 0===Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},n=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},o=Math.pow(2,-65),i=function(e,o){for(var i=[],a=r(e,o),l=o.length-1,c=s(a,2*l-1,i,0),h=t(e,o[0]),d=n(h),p=0,f=0;f<c;f++){h=t(e,u(o,l,i[f],null,null));var g=n(h);g<d&&(d=g,p=i[f])}return h=t(e,o[l]),(g=n(h))<d&&(d=g,p=1),{location:p,distance:d}},r=function(e,n){for(var o=n.length-1,i=2*o-1,r=[],s=[],a=[],l=[],c=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],u=0;u<=o;u++)r[u]=t(n[u],e);for(u=0;u<=o-1;u++)s[u]=t(n[u+1],n[u]),s[u]={x:(h=s[u]).x*3,y:3*h.y};for(var h,d,p,f=0;f<=o-1;f++)for(var g=0;g<=o;g++)a[f]||(a[f]=[]),a[f][g]=(d=s[f]).x*(p=r[g]).x+d.y*p.y;for(u=0;u<=i;u++)l[u]||(l[u]=[]),l[u].y=0,l[u].x=parseFloat(u)/i;for(var m=o,v=o-1,b=0;b<=m+v;b++){var y=Math.max(0,b-v),P=Math.min(b,m);for(u=y;u<=P;u++){var C=b-u;l[u+C].y+=a[C][u]*c[C][u]}}return l},s=function(t,e,n,o){var i,r,h=[],d=[],p=[],f=[];switch(a(t,e)){case 0:return 0;case 1:if(o>=64)return n[0]=(t[0].x+t[e].x)/2,1;if(l(t,e))return n[0]=c(t,e),1}u(t,e,.5,h,d),i=s(h,e,p,o+1),r=s(d,e,f,o+1);for(var g=0;g<i;g++)n[g]=p[g];for(g=0;g<r;g++)n[g+i]=f[g];return i+r},a=function(t,e){var n,o,i=0;n=o=Math.sgn(t[0].y);for(var r=1;r<=e;r++)(n=Math.sgn(t[r].y))!=o&&i++,o=n;return i},l=function(t,e){var n,i,r,s,a,l,c,u,h;s=t[0].y-t[e].y,a=t[e].x-t[0].x,l=t[0].x*t[e].y-t[e].x*t[0].y,u=h=0;for(var d=1;d<e;d++){var p=s*t[d].x+a*t[d].y+l;p>u?u=p:p<h&&(h=p)}return n=(1*(l-u)-0*(c=a))*(1/(0*c-1*s)),i=(1*(l-h)-0*(c=a))*(1/(0*c-1*s)),r=Math.min(n,i),Math.max(n,i)-r<o?1:0},c=function(t,e){var n=t[e].x-t[0].x,o=t[e].y-t[0].y;return 0+1/(0*n-1*o)*(n*(t[0].y-0)-o*(t[0].x-0))*1},u=function(t,e,n,o,i){for(var r=[[]],s=0;s<=e;s++)r[0][s]=t[s];for(var a=1;a<=e;a++)for(s=0;s<=e-a;s++)r[a]||(r[a]=[]),r[a][s]||(r[a][s]={}),r[a][s].x=(1-n)*r[a-1][s].x+n*r[a-1][s+1].x,r[a][s].y=(1-n)*r[a-1][s].y+n*r[a-1][s+1].y;if(null!=o)for(s=0;s<=e;s++)o[s]=r[s][0];if(null!=i)for(s=0;s<=e;s++)i[s]=r[e-s][s];return r[e][0]},h={},d=function(t,e){for(var n=function(t){var e=h[t];if(!e){var n=function(t){return function(e){return t}},o=function(){return function(t){return t}},i=function(){return function(t){return 1-t}},r=function(t){return function(e){for(var n=1,o=0;o<t.length;o++)n*=t[o](e);return n}};(e=[]).push(new function(){return function(e){return Math.pow(e,t)}});for(var s=1;s<t;s++){for(var a=[new n(t)],l=0;l<t-s;l++)a.push(new o);for(l=0;l<s;l++)a.push(new i);e.push(new r(a))}e.push(new function(){return function(e){return Math.pow(1-e,t)}}),h[t]=e}return e}(t.length-1),o=0,i=0,r=0;r<t.length;r++)o+=t[r].x*n[r](e),i+=t[r].y*n[r](e);return{x:o,y:i}},p=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},f=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},g=function(t,e,n){if(f(t))return{point:t[0],location:e};for(var o=d(t,e),i=0,r=e,s=n>0?1:-1,a=null;i<Math.abs(n);)a=d(t,r+=.005*s),i+=p(a,o),o=a;return{point:a,location:r}},m=function(t,e){var n=d(t,e),o=d(t.slice(0,t.length-1),e),i=o.y-n.y;return 0===i?1/0:Math.atan(i/(o.x-n.x))},v=function(t,e,n,o,i){var r=o-e,s=t-n,a=t*(e-o)+e*(n-t),l=function(t){return[b(t,"x"),b(t,"y")]}(i),c=P.apply(null,[r*l[0][0]+s*l[1][0],r*l[0][1]+s*l[1][1],r*l[0][2]+s*l[1][2],r*l[0][3]+s*l[1][3]+a]),u=[];if(null!=c)for(var h=0;h<3;h++){var d,p=c[h],f=Math.pow(p,2),g=Math.pow(p,3),m=[l[0][0]*g+l[0][1]*f+l[0][2]*p+l[0][3],l[1][0]*g+l[1][1]*f+l[1][2]*p+l[1][3]];d=n-t!=0?(m[0]-t)/(n-t):(m[1]-e)/(o-e),p>=0&&p<=1&&d>=0&&d<=1&&u.push(m)}return u};function b(t,e){return[3*t[1][e]-t[0][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function y(t){return t<0?-1:t>0?1:0}function P(t,e,n,o){var i,r,s=e/t,a=n/t,l=o/t,c=(3*a-Math.pow(s,2))/9,u=(9*s*a-27*l-2*Math.pow(s,3))/54,h=Math.pow(c,3)+Math.pow(u,2),d=[];if(h>=0)i=y(u+Math.sqrt(h))*Math.pow(Math.abs(u+Math.sqrt(h)),1/3),r=y(u-Math.sqrt(h))*Math.pow(Math.abs(u-Math.sqrt(h)),1/3),d[0]=-s/3+(i+r),d[1]=-s/3-(i+r)/2,d[2]=-s/3-(i+r)/2,0!==Math.abs(Math.sqrt(3)*(i-r)/2)&&(d[1]=-1,d[2]=-1);else{var p=Math.acos(u/Math.sqrt(-Math.pow(c,3)));d[0]=2*Math.sqrt(-c)*Math.cos(p/3)-s/3,d[1]=2*Math.sqrt(-c)*Math.cos((p+2*Math.PI)/3)-s/3,d[2]=2*Math.sqrt(-c)*Math.cos((p+4*Math.PI)/3)-s/3}for(var f=0;f<3;f++)(d[f]<0||d[f]>1)&&(d[f]=-1);return d}var C=this.jsBezier={distanceFromCurve:i,gradientAtPoint:m,gradientAtPointAlongCurveFrom:function(t,e,n){var o=g(t,e,n);return o.location>1&&(o.location=1),o.location<0&&(o.location=0),m(t,o.location)},nearestPointOnCurve:function(t,e){var n=i(t,e);return{point:u(e,e.length-1,n.location,null,null),location:n.location}},pointOnCurve:d,pointAlongCurveFrom:function(t,e,n){return g(t,e,n).point},perpendicularToCurveAt:function(t,e,n,o){var i=g(t,e,o=null==o?0:o),r=m(t,i.location),s=Math.atan(-1/r),a=n/2*Math.sin(s),l=n/2*Math.cos(s);return[{x:i.point.x+l,y:i.point.y+a},{x:i.point.x-l,y:i.point.y-a}]},locationAlongCurveFrom:function(t,e,n){return g(t,e,n).location},getLength:function(t){var e=(new Date).getTime();if(f(t))return 0;for(var n=d(t,0),o=0,i=0,r=null;i<1;)r=d(t,i+=.005),o+=p(r,n),n=r;return console.log("length",(new Date).getTime()-e),o},lineIntersection:v,boxIntersection:function(t,e,n,o,i){var r=[];return r.push.apply(r,v(t,e,t+n,e,i)),r.push.apply(r,v(t+n,e,t+n,e+o,i)),r.push.apply(r,v(t+n,e+o,t,e+o,i)),r.push.apply(r,v(t,e+o,t,e,i)),r},boundingBoxIntersection:function(t,e){var n=[];return n.push.apply(n,v(t.x,t.y,t.x+t.w,t.y,e)),n.push.apply(n,v(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),n.push.apply(n,v(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),n.push.apply(n,v(t.x,t.y+t.h,t.x,t.y,e)),n},version:"0.9.0"};e.jsBezier=C}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.Biltong={version:"0.4.0"};e.Biltong=t;var n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=function(t,e,o){return o(t=n(t)?t:[t.x,t.y],e=n(e)?e:[e.x,e.y])},i=t.gradient=function(t,e){return o(t,e,(function(t,e){return e[0]==t[0]?e[1]>t[1]?1/0:-1/0:e[1]==t[1]?e[0]>t[0]?0:-0:(e[1]-t[1])/(e[0]-t[0])}))},r=(t.normal=function(t,e){return-1/i(t,e)},t.lineLength=function(t,e){return o(t,e,(function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))}))},t.quadrant=function(t,e){return o(t,e,(function(t,e){return e[0]>t[0]||e[0]==t[0]?e[1]>t[1]?2:1:e[1]>t[1]?3:4}))}),s=(t.theta=function(t,e){return o(t,e,(function(t,e){var n=i(t,e),o=Math.atan(n),s=r(t,e);return 4!=s&&3!=s||(o+=Math.PI),o<0&&(o+=2*Math.PI),o}))},t.intersects=function(t,e){var n=t.x,o=t.x+t.w,i=t.y,r=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,c=e.y+e.h;return n<=s&&s<=o&&i<=l&&l<=r||n<=a&&a<=o&&i<=l&&l<=r||n<=s&&s<=o&&i<=c&&c<=r||n<=a&&s<=o&&i<=c&&c<=r||s<=n&&n<=a&&l<=i&&i<=c||s<=o&&o<=a&&l<=i&&i<=c||s<=n&&n<=a&&l<=r&&r<=c||s<=o&&n<=a&&l<=r&&r<=c},t.encloses=function(t,e,n){var o=t.y,i=t.y+t.h,r=e.y,s=e.y+e.h,a=function(t,e,o,i){return n?t<=e&&o>=i:t<e&&o>i};return a(t.x,e.x,t.x+t.w,e.x+e.w)&&a(o,r,i,s)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),a=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,e,n){var o=i(t,e),l=r(t,e),c=n>0?s[l]:a[l],u=Math.atan(o),h=Math.abs(n*Math.sin(u))*c[1],d=Math.abs(n*Math.cos(u))*c[0];return{x:t.x+d,y:t.y+h}},t.perpendicularLineTo=function(t,e,n){var o=i(t,e),r=Math.atan(-1/o),s=n/2*Math.sin(r),a=n/2*Math.cos(r);return[{x:e.x+a,y:e.y+s},{x:e.x-a,y:e.y-s}]}}).call("undefined"!=typeof window?window:this),(function(){"use strict";function t(t,e,n,o,i,r,s,a){return new Touch({target:e,identifier:I(),pageX:n,pageY:o,screenX:i,screenY:r,clientX:s||i,clientY:a||r})}function n(){var t=[];return Array.prototype.push.apply(t,arguments),t.item=function(t){return this[t]},t}var o=function(t,e,n){for(var o=(n=n||t.parentNode).querySelectorAll(e),i=0;i<o.length;i++)if(o[i]===t)return!0;return!1},i=function(t){return"string"==typeof t||t.constructor===String?document.getElementById(t):t},r=function(t){return t.srcElement||t.target},s=function(t,e,n,o){if(o){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var i={path:[],end:-1},r=function(t){i.path.push(t),t===n?i.end=i.path.length-1:null!=t.parentNode&&r(t.parentNode)};return r(e),i}return{path:[e],end:1}},a=function(t,e){for(var n=0,o=t.length;n<o&&t[n]!=e;n++);n<t.length&&t.splice(n,1)},l=1,c=function(t,e,n){var o=l++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][o]=n,n.__tauid=o,o},u=function(t,e,n,i){if(null==t)return n;var a=t.split(","),l=function(i){l.__tauid=n.__tauid;var c=r(i),u=c,h=s(i,c,e,null!=t);if(-1!=h.end)for(var d=0;d<h.end;d++){u=h.path[d];for(var p=0;p<a.length;p++)o(u,a[p],e)&&n.apply(u,arguments)}};return h(n,i,l),l},h=function(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])},d=function(t,e,n,o){if(v&&y[e]){var i=u(o,t,n,y[e]);j(t,y[e],i,n)}"focus"===e&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),j(t,e,u(o,t,n,e),n)},p={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},f=function(t,e){return function(n,i,l,c){if("contextmenu"==i&&b)d(n,i,l,c);else{if(null==n.__taTapHandler){var u=n.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},h=function(){u.down=!1},f=function(){u.taps=0};d(n,"mousedown",(function(i){for(var a=r(i),l=s(i,a,n,null!=c),d=!1,p=0;p<l.end;p++){if(d)return;a=l.path[p];for(var g=0;g<u.downSelectors.length;g++)if(null==u.downSelectors[g]||o(a,u.downSelectors[g],n)){u.down=!0,setTimeout(h,t),setTimeout(f,e),d=!0;break}}})),d(n,"mouseup",(function(t){if(u.down){var e,i,a=r(t);u.taps++;var l=E(t);for(var c in p)if(p.hasOwnProperty(c)){var h=p[c];if(h.touches===l&&(1===h.taps||h.taps===u.taps))for(var d=0;d<u[c].length;d++){i=s(t,a,n,null!=u[c][d][1]);for(var f=0;f<i.end;f++)if(e=i.path[f],null==u[c][d][1]||o(e,u[c][d][1],n)){u[c][d][0].apply(e,[t]);break}}}}}))}n.__taTapHandler.downSelectors.push(c),n.__taTapHandler[i].push([l,c]),l.__taUnstore=function(){a(n.__taTapHandler[i],l)}}}},g=function(t,e,n,o){for(var i in n.__tamee[t])n.__tamee[t].hasOwnProperty(i)&&n.__tamee[t][i].apply(o,[e])},m=function(){var t=[];return function(e,n,i,s){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var a=function(n){var i=r(n);(null==s&&i==e&&!e.__tamee.over||o(i,s,e)&&(null==i.__tamee||!i.__tamee.over))&&(g("mouseenter",n,e,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,t.push(i))},l=function(n){for(var i=r(n),s=0;s<t.length;s++)i!=t[s]||o(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,t.splice(s,1),g("mouseexit",n,e,i))};j(e,"mouseover",u(s,e,a,"mouseover"),a),j(e,"mouseout",u(s,e,l,"mouseout"),l)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]},c(e,n,i),e.__tamee[n][i.__tauid]=i}},v="ontouchstart"in document.documentElement||navigator.maxTouchPoints,b="onmousedown"in document.documentElement,y={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},P=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),C=P>-1&&P<9,x=function(t,e){if(null==t)return[0,0];var n=w(t),o=S(n,0);return[o[e+"X"],o[e+"Y"]]},_=function(t){return null==t?[0,0]:C?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:x(t,"page")},S=function(t,e){return t.item?t.item(e):t[e]},w=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},E=function(t){return w(t).length},j=function(t,e,n,o){if(c(t,e,n),o.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var i=e+n.__tauid;t["e"+i]=n,t[i]=function(){t["e"+i]&&t["e"+i](window.event)},t.attachEvent("on"+e,t[i])}},D=function(t,e,n){null!=n&&k(t,(function(){var o=i(this);if(function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var o=0;o<n.__taExtra.length;o++)D(t,n.__taExtra[o][0],n.__taExtra[o][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,e,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(e,n,!1),v&&y[e]&&o.removeEventListener(y[e],n,!1);else if(this.detachEvent){var r=e+n.__tauid;o[r]&&o.detachEvent("on"+e,o[r]),o[r]=null,o["e"+r]=null}n.__taTouchProxy&&D(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}))},k=function(t,e){if(null!=t){t="undefined"!=typeof Window&&"unknown"!=typeof t.top&&t==t.top?[t]:"string"!=typeof t&&null==t.tagName&&null!=t.length?t:"string"==typeof t?document.querySelectorAll(t):[t];for(var n=0;n<t.length;n++)e.apply(t[n])}},I=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))};this.Mottle=function(e){var o=(e=e||{}).clickThreshold||250,s=e.dblClickThreshold||450,l=new m,c=new f(o,s),u=e.smartClicks,h=function(t,e,n,o){null!=n&&k(t,(function(){var t=i(this);u&&"click"===e?function(t,e,n,o){null==t.__taSmartClicks&&(d(t,"mousedown",(function(e){t.__tad=_(e)}),o),d(t,"mouseup",(function(e){t.__tau=_(e)}),o),d(t,"click",(function(e){if(t.__tad&&t.__tau&&t.__tad[0]===t.__tau[0]&&t.__tad[1]===t.__tau[1])for(var n=0;n<t.__taSmartClicks.length;n++)t.__taSmartClicks[n].apply(r(e),[e])}),o),t.__taSmartClicks=[]),t.__taSmartClicks.push(n),n.__taUnstore=function(){a(t.__taSmartClicks,n)}}(t,0,n,o):"tap"===e||"dbltap"===e||"contextmenu"===e?c(t,e,n,o):"mouseenter"===e||"mouseexit"==e?l(t,e,n,o):d(t,e,n,o)}))};this.remove=function(t){return k(t,(function(){var t=i(this);if(t.__ta)for(var e in t.__ta)if(t.__ta.hasOwnProperty(e))for(var n in t.__ta[e])t.__ta[e].hasOwnProperty(n)&&D(t,e,t.__ta[e][n]);t.parentNode&&t.parentNode.removeChild(t)})),this},this.on=function(t,e,n,o){var i=arguments[0],r=4==arguments.length?arguments[2]:null,s=arguments[1],a=arguments[arguments.length-1];return h(i,s,a,r),this},this.off=function(t,e,n){return D(t,e,n),this},this.trigger=function(e,o,r,s){var a=b&&("undefined"==typeof MouseEvent||null==r||r.constructor===MouseEvent),l=v&&!b&&y[o]?y[o]:o,c=!(v&&!b&&y[o]),u=_(r),h=x(r,"screen"),d=function(t){return x(t,"client")}(r);return k(e,(function(){var e,p=i(this);r=r||{screenX:h[0],screenY:h[1],clientX:d[0],clientY:d[1]};var f=function(t){s&&(t.payload=s)},g={TouchEvent:function(e){var o=function(e,o,i,r,s,a,l,c){return n(t.apply(null,arguments))}(window,p,0,u[0],u[1],h[0],h[1],d[0],d[1]);(e.initTouchEvent||e.initEvent)(l,!0,!0,window,null,h[0],h[1],d[0],d[1],!1,!1,!1,!1,o,o,o,1,0)},MouseEvents:function(t){t.initMouseEvent(l,!0,!0,window,0,h[0],h[1],d[0],d[1],!1,!1,!1,!1,1,p)}};if(document.createEvent){var m=!c&&!a&&v&&y[o]?"TouchEvent":"MouseEvents";e=document.createEvent(m),g[m](e),f(e),p.dispatchEvent(e)}else document.createEventObject&&((e=document.createEventObject()).eventType=e.eventName=l,e.screenX=h[0],e.screenY=h[1],e.clientX=d[0],e.clientY=d[1],f(e),p.fireEvent("on"+l,e))})),this}},this.Mottle.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.Mottle.pageLocation=_,this.Mottle.setForceTouchEvents=function(t){v=t},this.Mottle.setForceMouseEvents=function(t){b=t},this.Mottle.version="0.8.0",e.Mottle=this.Mottle}).call("undefined"==typeof window?this:window),(function(){"use strict";var t=function(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)},n=function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},o=function(t,e){for(var n=[],o=0;o<t.length;o++)-1===e.indexOf(t[o])&&n.push(t[o]);return n},i=function(t){return null!=t&&("string"==typeof t||t.constructor===String)},r=function(t){var e=t.getBoundingClientRect(),n=document.body,o=document.documentElement,i=window.pageYOffset||o.scrollTop||n.scrollTop,r=window.pageXOffset||o.scrollLeft||n.scrollLeft,s=e.left+r-(o.clientLeft||n.clientLeft||0);return{top:Math.round(e.top+i-(o.clientTop||n.clientTop||0)),left:Math.round(s)}},s=function(t,e,n){for(var o=(n=n||t.parentNode).querySelectorAll(e),i=0;i<o.length;i++)if(o[i]===t)return!0;return!1},a=function(t,e,n){if(s(e,n,t))return e;for(var o=e.parentNode;null!=o&&o!==t;){if(s(o,n,t))return o;o=o.parentNode}},l=function(t,e,n){for(var o=null,i=e.getAttribute("katavorio-draggable"),r=null!=i?"[katavorio-draggable='"+i+"'] ":"",l=0;l<t.length;l++)if(null!=(o=a(e,n,r+t[l].selector))){if(t[l].filter){var c=s(n,t[l].filter,o);if(!0===t[l].filterExclude&&!c||c)return null}return[t[l],o]}return null},c=function(){var t=-1;if("Microsoft Internet Explorer"===navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),u=c>-1&&c<9,h=9===c,d=function(t){if(u)return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop];var e=f(t),n=p(e,0);return h?[n.pageX||n.clientX,n.pageY||n.clientY]:[n.pageX,n.pageY]},p=function(t,e){return t.item?t.item(e):t[e]},f=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},g={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},m=["stop","start","drag","drop","over","out","beforeStart"],v=function(){},b=function(){return!0},y=function(t,e,n){for(var o=0;o<t.length;o++)t[o]!=n&&e(t[o])},P=function(t,e,n,o){y(t,(function(t){t.setActive(e),e&&t.updatePosition(),n&&t.setHover(o,e)}))},C=function(t,e){if(null!=t){t=i(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},x=function(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):t.returnValue=!1},_=function(t,e,n){return!s(t.srcElement||t.target,n.getInputFilterSelector(),e)},S=function(t,e,n,o){this.params=e||{},this.el=t,this.params.addClass(this.el,this._class),this.uuid=k();var i=!0;return this.setEnabled=function(t){i=t},this.isEnabled=function(){return i},this.toggleEnabled=function(){i=!i},this.setScope=function(t){this.scopes=t?t.split(/\s+/):[o]},this.addScope=function(t){var e={};for(var n in C(this.scopes,(function(t){e[t]=!0})),C(t?t.split(/\s+/):[],(function(t){e[t]=!0})),this.scopes=[],e)this.scopes.push(n)},this.removeScope=function(t){var e={};for(var n in C(this.scopes,(function(t){e[t]=!0})),C(t?t.split(/\s+/):[],(function(t){delete e[t]})),this.scopes=[],e)this.scopes.push(n)},this.toggleScope=function(t){var e={};for(var n in C(this.scopes,(function(t){e[t]=!0})),C(t?t.split(/\s+/):[],(function(t){e[t]?delete e[t]:e[t]=!0})),this.scopes=[],e)this.scopes.push(n)},this.setScope(e.scope),this.k=e.katavorio,e.katavorio},w=function(){return!0},E=function(){return!1},j=function(t,e,n,o){this._class=n.draggable;var a=S.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var c,u,h,p,f=[0,0],m=null,v=null,y=[0,0],C=!1,j=[0,0],D=!1!==this.params.consumeStartEvent,O=this.el,T=this.params.clone,A=!1!==e.multipleDrop,M=!1,L=!0===e.ghostProxy?w:e.ghostProxy&&"function"==typeof e.ghostProxy?e.ghostProxy:E,F=function(t){return t.cloneNode(!0)},N=null,R=[],H=null,U=e.ghostProxyParent;if(e.selector){var G=t.getAttribute("katavorio-draggable");null==G&&(G=""+(new Date).getTime(),t.setAttribute("katavorio-draggable",G)),R.push(e)}var B,W=e.snapThreshold,X=function(t,e,n,o,i){var r=e*Math.floor(t[0]/e),s=r+e,a=Math.abs(t[0]-r)<=o?r:Math.abs(s-t[0])<=o?s:t[0],l=n*Math.floor(t[1]/n),c=l+n;return[a,Math.abs(t[1]-l)<=i?l:Math.abs(c-t[1])<=i?c:t[1]]};this.posses=[],this.posseRoles={},this.toGrid=function(t){return null==this.params.grid?t:X(t,this.params.grid[0],this.params.grid[1],this.params.grid?this.params.grid[0]/2:W||5,this.params.grid?this.params.grid[1]/2:W||5)},this.snap=function(t,e){if(null!=O){t=t||(this.params.grid?this.params.grid[0]:10),e=e||(this.params.grid?this.params.grid[1]:10);var n=this.params.getPosition(O),o=X(n,t,e,this.params.grid?this.params.grid[0]/2:W,this.params.grid?this.params.grid[1]/2:W);return this.params.setPosition(O,o),o}},this.setUseGhostProxy=function(t){L=t?w:E};var q,Y=function(t){return!1===e.allowNegative?[Math.max(0,t[0]),Math.max(0,t[1])]:t},z=(function(t){B="function"==typeof t?t:t?(function(t,e,n,o){return Y([Math.max(0,Math.min(n.w-o[0],t[0])),Math.max(0,Math.min(n.h-o[1],t[1]))])}).bind(this):function(t){return Y(t)}}).bind(this);z("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(t){z(t)},this.setRevert=function(t){q=t},this.params.revert&&(q=this.params.revert);var V=function(t){return"function"==typeof t?(t._katavorioId=k(),t._katavorioId):t},Q={},J=function(t){for(var e in Q){var n=Q[e],o=n[0](t);if(n[1]&&(o=!o),!o)return!1}return!0},K=this.setFilter=function(e,n){if(e){var o=V(e);Q[o]=[function(n){var o,r=n.srcElement||n.target;return i(e)?o=s(r,e,t):"function"==typeof e&&(o=e(n,t)),o},!1!==n]}};this.addFilter=K,this.removeFilter=function(t){delete Q["function"==typeof t?t._katavorioId:t]},this.clearAllFilters=function(){Q={}},this.canDrag=this.params.canDrag||b;var Z,$=[],tt=[];this.addSelector=function(t){t.selector&&R.push(t)},this.downListener=(function(t){if(!t.defaultPrevented&&(this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this.canDrag())if(J(t)&&_(t,this.el,this.k)){if(H=null,N=null,R.length>0){var e=l(R,this.el,t.target||t.srcElement);if(null!=e&&(H=e[0],N=e[1]),null==N)return}else N=this.el;if(T)if(O=N.cloneNode(!0),this.params.addClass(O,g.clonedDrag),O.setAttribute("id",null),O.style.position="absolute",null!=this.params.parent){var o=this.params.getPosition(this.el);O.style.left=o[0]+"px",O.style.top=o[1]+"px",this.params.parent.appendChild(O)}else{var i=r(N);O.style.left=i.left+"px",O.style.top=i.top+"px",document.body.appendChild(O)}else O=N;D&&x(t),f=d(t),O&&O.parentNode&&(j=[O.parentNode.scrollLeft,O.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),a.markSelection(this),a.markPosses(this),this.params.addClass(document.body,n.noSelect),ot("beforeStart",{el:this.el,pos:m,e:t,drag:this})}else this.params.consumeFilteredEvents&&x(t)}).bind(this),this.moveListener=(function(t){if(f){if(!C)if(!1!==ot("start",{el:this.el,pos:m,e:t,drag:this})){if(!f)return;this.mark(!0),C=!0}else this.abort();if(f){tt.length=0;var e=d(t),n=e[0]-f[0],o=e[1]-f[1],i=this.params.ignoreZoom?1:a.getZoom();O&&O.parentNode&&(n+=O.parentNode.scrollLeft-j[0],o+=O.parentNode.scrollTop-j[1]),this.moveBy(n/=i,o/=i,t),a.updateSelection(n,o,this),a.updatePosses(n,o,this)}}}).bind(this),this.upListener=(function(t){f&&(f=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,n.noSelect),this.unmark(t),a.unmarkSelection(this,t),a.unmarkPosses(this,t),this.stop(t),a.notifyPosseDragStop(this,t),C=!1,tt.length=0,T?(O&&O.parentNode&&O.parentNode.removeChild(O),O=null):q&&!0===q(O,this.params.getPosition(O))&&(this.params.setPosition(O,m),ot("revert",O)))}).bind(this),this.getFilters=function(){return Q},this.abort=function(){null!=f&&this.upListener()},this.getDragElement=function(t){return t?N||this.el:O||this.el};var et={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};e.events.start&&et.start.push(e.events.start),e.events.beforeStart&&et.beforeStart.push(e.events.beforeStart),e.events.stop&&et.stop.push(e.events.stop),e.events.drag&&et.drag.push(e.events.drag),e.events.revert&&et.revert.push(e.events.revert),this.on=function(t,e){et[t]&&et[t].push(e)},this.off=function(t,e){if(et[t]){for(var n=[],o=0;o<et[t].length;o++)et[t][o]!==e&&n.push(et[t][o]);et[t]=n}};var nt,ot=function(t,e){var n=null;if(H&&H[t])n=H[t](e);else if(et[t])for(var o=0;o<et[t].length;o++)try{var i=et[t][o](e);null!=i&&(n=i)}catch(r){}return n};this.notifyStart=function(t){ot("start",{el:this.el,pos:this.params.getPosition(O),e:t,drag:this})},this.stop=function(t,e){if(e||C){var n=[],o=a.getSelection(),i=this.params.getPosition(O);if(o.length>0)for(var r=0;r<o.length;r++){var s=this.params.getPosition(o[r].el);n.push([o[r].el,{left:s[0],top:s[1]},o[r]])}else n.push([O,{left:i[0],top:i[1]},this]);ot("stop",{el:O,pos:nt||i,finalPos:i,e:t,drag:this,selection:n})}},this.mark=function(t){var e;m=this.params.getPosition(O),v=this.params.getPosition(O,!0),y=[v[0]-m[0],v[1]-m[1]],this.size=this.params.getSize(O),$=a.getMatchingDroppables(this),P($,!0,!1,this),this.params.addClass(O,this.params.dragClass||n.drag),e=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(O):this.params.getSize(O.parentNode),Z={w:e[0],h:e[1]},h=0,p=0,t&&a.notifySelectionDragStart(this)},this.unmark=function(t,o){if(P($,!1,!0,this),M&&L(N,O)?(nt=[O.offsetLeft-h,O.offsetTop-p],O.parentNode.removeChild(O),O=N):nt=null,this.params.removeClass(O,this.params.dragClass||n.drag),$.length=0,M=!1,!o){tt.length>0&&nt&&e.setPosition(N,nt),tt.sort(I);for(var i=0;i<tt.length&&!0!==tt[i].drop(this,t);i++);}},this.moveBy=function(t,n,o){tt.length=0;var i=this.toGrid([m[0]+t,m[1]+n]),r=B(i,O,Z,this.size);if(L(this.el,O))if(i[0]!==r[0]||i[1]!==r[1]){if(!M){var s=F(N);e.addClass(s,g.ghostProxy),U?(U.appendChild(s),c=e.getPosition(N.parentNode,!0),u=e.getPosition(e.ghostProxyParent,!0),h=c[0]-u[0],p=c[1]-u[1]):N.parentNode.appendChild(s),O=s,M=!0}r=i}else M&&(O.parentNode.removeChild(O),O=N,M=!1,c=null,u=null,h=0,p=0);var a={x:r[0],y:r[1],w:this.size[0],h:this.size[1]},l={x:a.x+y[0],y:a.y+y[1],w:a.w,h:a.h},d=null;this.params.setPosition(O,[r[0]+h,r[1]+p]);for(var f=0;f<$.length;f++)this.params.intersects(l,{x:$[f].pagePosition[0],y:$[f].pagePosition[1],w:$[f].size[0],h:$[f].size[1]})&&(A||null==d||d===$[f].el)&&$[f].canDrop(this)?(d||(d=$[f].el),tt.push($[f]),$[f].setHover(this,!0,o)):$[f].isHover()&&$[f].setHover(this,!1,o);ot("drag",{el:this.el,pos:r,e:o,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?K(this.params.handle,!1):K(this.params.filter,this.params.filterExclude)},D=function(t,e,n,o){this._class=n.droppable,this.params=e||{},this.rank=e.rank||0,this._activeClass=this.params.activeClass||n.active,this._hoverClass=this.params.hoverClass||n.hover,S.apply(this,arguments);var i=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(t){return!0},this.isHover=function(){return i},this.setHover=function(t,e,n){(e||null==this.el._katavorioDragHover||this.el._katavorioDragHover===t.el._katavorio)&&(this.params[e?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=e?t.el._katavorio:null,i!==e&&this.params.events[e?"over":"out"]({el:this.el,e:n,drag:t,drop:this}),i=e)},this.drop=function(t,e){return this.params.events.drop({drag:t,e:e,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,i=null}},k=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},I=function(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:0},O=function(t){return null==t||null==(t="string"==typeof t||t.constructor===String?document.getElementById(t):t)?null:(t._katavorio=t._katavorio||k(),t)};this.Katavorio=function(e){var r=[],s={};this._dragsByScope={},this._dropsByScope={};var a=1,l=function(t,e){C(t,(function(t){for(var n=0;n<t.scopes.length;n++)e[t.scopes[n]]=e[t.scopes[n]]||[],e[t.scopes[n]].push(t)}))},c=function(t,n){var o=0;return C(t,(function(t){for(var i=0;i<t.scopes.length;i++)if(n[t.scopes[i]]){var r=e.indexOf(n[t.scopes[i]],t);-1!==r&&(n[t.scopes[i]].splice(r,1),o++)}})),o>0},u=(this.getMatchingDroppables=function(t){for(var e=[],n={},o=0;o<t.scopes.length;o++){var i=this._dropsByScope[t.scopes[o]];if(i)for(var r=0;r<i.length;r++)!i[r].canDrop(t)||n[i[r].uuid]||!i[r].allowLoopback&&i[r].el===t.el||(n[i[r].uuid]=!0,e.push(i[r]))}return e.sort(I),e},(function(t){t=t||{};var n,o={events:{}};for(n in e)o[n]=e[n];for(n in t)o[n]=t[n];for(n=0;n<m.length;n++)o.events[m[n]]=t[m[n]]||v;return o.katavorio=this,o}).bind(this)),h=(function(t,e){for(var n=0;n<m.length;n++)e[m[n]]&&t.on(m[n],e[m[n]])}).bind(this),d={},p=e.css||{},f=e.scope||"katavorio-drag-scope";for(var b in g)d[b]=g[b];for(var b in p)d[b]=p[b];var P=e.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return P},this.setInputFilterSelector=function(t){return P=t,this},this.draggable=function(t,n){var o=[];return C(t,(function(t){if(null!=(t=O(t)))if(null==t._katavorioDrag){var i=u(n);t._katavorioDrag=new j(t,i,d,f),l(t._katavorioDrag,this._dragsByScope),o.push(t._katavorioDrag),e.addClass(t,i.selector?d.delegatedDraggable:d.draggable)}else h(t._katavorioDrag,n)}).bind(this)),o},this.droppable=function(t,n){var o=[];return C(t,(function(t){if(null!=(t=O(t))){var i=new D(t,u(n),d,f);t._katavorioDrop=t._katavorioDrop||[],t._katavorioDrop.push(i),l(i,this._dropsByScope),o.push(i),e.addClass(t,d.droppable)}}).bind(this)),o},this.select=function(t){return C(t,(function(){var t=O(this);t&&t._katavorioDrag&&(s[t._katavorio]||(r.push(t._katavorioDrag),s[t._katavorio]=[t,r.length-1],e.addClass(t,d.selected)))})),this},this.deselect=function(t){return C(t,(function(){var t=O(this);if(t&&t._katavorio&&s[t._katavorio]){for(var n=[],o=0;o<r.length;o++)r[o].el!==t&&n.push(r[o]);r=n,delete s[t._katavorio],e.removeClass(t,d.selected)}})),this},this.deselectAll=function(){for(var t in s)e.removeClass(s[t][0],d.selected);r.length=0,s={}},this.markSelection=function(t){y(r,(function(t){t.mark()}),t)},this.markPosses=function(t){t.posses&&C(t.posses,(function(e){t.posseRoles[e]&&E[e]&&y(E[e].members,(function(t){t.mark()}),t)}))},this.unmarkSelection=function(t,e){y(r,(function(t){t.unmark(e)}),t)},this.unmarkPosses=function(t,e){t.posses&&C(t.posses,(function(n){t.posseRoles[n]&&E[n]&&y(E[n].members,(function(t){t.unmark(e,!0)}),t)}))},this.getSelection=function(){return r.slice(0)},this.updateSelection=function(t,e,n){y(r,(function(n){n.moveBy(t,e)}),n)};var x=function(t,e){e.posses&&C(e.posses,(function(n){e.posseRoles[n]&&E[n]&&y(E[n].members,(function(e){t(e)}),e)}))};this.updatePosses=function(t,e,n){x((function(n){n.moveBy(t,e)}),n)},this.notifyPosseDragStop=function(t,e){x((function(t){t.stop(e,!0)}),t)},this.notifySelectionDragStop=function(t,e){y(r,(function(t){t.stop(e,!0)}),t)},this.notifySelectionDragStart=function(t,e){y(r,(function(t){t.notifyStart(e)}),t)},this.setZoom=function(t){a=t},this.getZoom=function(){return a};var _=function(t,e,n,o){C(t,(function(t){c(t,n),t[o](e),l(t,n)}))};C(["set","add","remove","toggle"],(function(t){this[t+"Scope"]=(function(e,n){_(e._katavorioDrag,n,this._dragsByScope,t+"Scope"),_(e._katavorioDrop,n,this._dropsByScope,t+"Scope")}).bind(this),this[t+"DragScope"]=(function(e,n){_(e.constructor===j?e:e._katavorioDrag,n,this._dragsByScope,t+"Scope")}).bind(this),this[t+"DropScope"]=(function(e,n){_(e.constructor===D?e:e._katavorioDrop,n,this._dropsByScope,t+"Scope")}).bind(this)}).bind(this)),this.snapToGrid=function(t,e){for(var n in this._dragsByScope)y(this._dragsByScope[n],(function(n){n.snap(t,e)}))},this.getDragsForScope=function(t){return this._dragsByScope[t]},this.getDropsForScope=function(t){return this._dropsByScope[t]};var S=function(t,e,n){if((t=O(t))[e]){var o=r.indexOf(t[e]);o>=0&&r.splice(o,1),c(t[e],n)&&C(t[e],(function(t){t.destroy()})),delete t[e]}},w=function(t,e,n,o){(t=O(t))[e]&&t[e].off(n,o)};this.elementRemoved=function(t){this.destroyDraggable(t),this.destroyDroppable(t)},this.destroyDraggable=function(t,e,n){1===arguments.length?S(t,"_katavorioDrag",this._dragsByScope):w(t,"_katavorioDrag",e,n)},this.destroyDroppable=function(t,e,n){1===arguments.length?S(t,"_katavorioDrop",this._dropsByScope):w(t,"_katavorioDrop",e,n)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},r=[],s={},E={}};var E={},k=function(e,n,o){var r,s=i(n)?n:n.id,a=!!i(n)||!1!==n.active,l=E[s]||(E[s]=r={name:s,members:[]},r);return C(e,(function(e){if(e._katavorioDrag){if(o&&null!=e._katavorioDrag.posseRoles[l.name])return;t(l.members,e._katavorioDrag),t(e._katavorioDrag.posses,l.name),e._katavorioDrag.posseRoles[l.name]=a}})),l};this.addToPosse=function(t,e){for(var n=[],o=1;o<arguments.length;o++)n.push(k(t,arguments[o]));return 1===n.length?n[0]:n},this.setPosse=function(t,e){for(var n=[],i=1;i<arguments.length;i++)n.push(k(t,arguments[i],!0).name);return C(t,(function(t){if(t._katavorioDrag){var e=o(t._katavorioDrag.posses,n);Array.prototype.push.apply([],t._katavorioDrag.posses);for(var i=0;i<e.length;i++)this.removeFromPosse(t,e[i])}}).bind(this)),1===n.length?n[0]:n},this.removeFromPosse=function(t,e){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var o=1;o<arguments.length;o++)e=arguments[o],C(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var o=t._katavorioDrag;C(e,(function(t){n(E[t].members,o),n(o.posses,t),delete o.posseRoles[t]}))}}))},this.removeFromAllPosses=function(t){C(t,(function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;C(e.posses,(function(t){n(E[t].members,e)})),e.posses.length=0,e.posseRoles={}}}))},this.setPosseState=function(t,e,n){var o=E[e];o&&C(t,(function(t){t._katavorioDrag&&t._katavorioDrag.posses&&(t._katavorioDrag.posseRoles[o.name]=n)}))}},this.Katavorio.version="1.0.0",e.Katavorio=this.Katavorio}).call("undefined"!=typeof window?window:this),(function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t=this.jsPlumbUtil;function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t){return"string"==typeof t}function i(t){return"boolean"==typeof t}function r(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function s(t){return"[object Date]"===Object.prototype.toString.call(t)}function a(t){return"[object Function]"===Object.prototype.toString.call(t)}function l(t){if(o(t))return""+t;if(i(t))return!!t;if(s(t))return new Date(t.getTime());if(a(t))return t;if(n(t)){for(var e=[],c=0;c<t.length;c++)e.push(l(t[c]));return e}if(r(t)){var u={};for(var h in t)u[h]=l(t[h]);return u}return t}function c(t,e,s,a){var c,u,h={},d={};for(s=s||[],a=a||[],u=0;u<s.length;u++)h[s[u]]=!0;for(u=0;u<a.length;u++)d[a[u]]=!0;var p=l(t);for(u in e)if(null==p[u]||d[u])p[u]=e[u];else if(o(e[u])||i(e[u]))h[u]?((c=[]).push.apply(c,n(p[u])?p[u]:[p[u]]),c.push.apply(c,i(e[u])?e[u]:[e[u]]),p[u]=c):p[u]=e[u];else if(n(e[u]))c=[],n(p[u])&&c.push.apply(c,p[u]),c.push.apply(c,e[u]),p[u]=c;else if(r(e[u]))for(var f in r(p[u])||(p[u]={}),e[u])p[u][f]=e[u][f];return p}function u(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function h(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function d(t,e,n,o){var i=t[e];return null==i&&(t[e]=i=[]),i[o?"unshift":"push"](n),i}e.jsPlumbUtil=t,t.isArray=n,t.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},t.isString=o,t.isBoolean=i,t.isNull=function(t){return null==t},t.isObject=r,t.isDate=s,t.isFunction=a,t.isNamedFunction=function(t){return a(t)&&null!=t.name&&t.name.length>0},t.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},t.clone=l,t.merge=c,t.replace=function(t,e,n){if(null!=t){var o=t;return e.replace(/([^\.])+/g,(function(t,e,i,r){var s=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=function(){return o[s[1]]||(o[s[1]]=[],o[s[1]])};if(i+t.length>=r.length)s?a()[s[3]]=n:o[t]=n;else if(s){var l=a();o=l[s[3]]||(l[s[3]]={},l[s[3]])}else o=o[t]||(o[t]={},o[t]);return""})),t}},t.functionChain=function(t,e,n){for(var o=0;o<n.length;o++){var i=n[o][0][n[o][1]].apply(n[o][0],n[o][2]);if(i===e)return i}return t},t.populate=function(t,e,i,s){var l=function(t){if(null!=t){if(o(t))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var o=0;o<n.length;o++){var i=e[n[o].substring(2,n[o].length-1)]||"";null!=i&&(t=t.replace(n[o],i))}return t}(t);if(!a(t)||s||null!=i&&0!==(t.name||"").indexOf(i)){if(n(t)){for(var c=[],u=0;u<t.length;u++)c.push(l(t[u]));return c}if(r(t)){var h={};for(var d in t)h[d]=l(t[d]);return h}return t}return t(e)}};return l(t)},t.findWithFunction=u,t.removeWithFunction=function(t,e){var n=u(t,e);return n>-1&&t.splice(n,1),-1!==n},t.remove=h,t.addWithFunction=function(t,e,n){-1===u(t,n)&&t.push(e)},t.addToList=d,t.suggest=function(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)},t.extend=function(t,e,o){var i;e=n(e)?e:[e];var r=function(e){for(var n=e.__proto__;null!=n;)if(null!=n.prototype){for(var o in n.prototype)n.prototype.hasOwnProperty(o)&&!t.prototype.hasOwnProperty(o)&&(t.prototype[o]=n.prototype[o]);n=n.prototype.__proto__}else n=null};for(i=0;i<e.length;i++){for(var s in e[i].prototype)e[i].prototype.hasOwnProperty(s)&&!t.prototype.hasOwnProperty(s)&&(t.prototype[s]=e[i].prototype[s]);r(e[i])}var a=function(t,n){return function(){for(i=0;i<e.length;i++)e[i].prototype[t]&&e[i].prototype[t].apply(this,arguments);return n.apply(this,arguments)}},l=function(e){for(var n in e)t.prototype[n]=a(n,e[n])};if(arguments.length>2)for(i=2;i<arguments.length;i++)l(arguments[i]);return t};for(var p=[],f=0;f<256;f++)p[f]=(f<16?"0":"")+f.toString(16);function g(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return p[255&t]+p[t>>8&255]+p[t>>16&255]+p[t>>24&255]+"-"+p[255&e]+p[e>>8&255]+"-"+p[e>>16&15|64]+p[e>>24&255]+"-"+p[63&n|128]+p[n>>8&255]+"-"+p[n>>16&255]+p[n>>24&255]+p[255&o]+p[o>>8&255]+p[o>>16&255]+p[o>>24&255]}function m(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t.logEnabled&&"undefined"!=typeof console)try{var o=arguments[arguments.length-1];console.log(o)}catch(i){}}t.uuid=g,t.fastTrim=function(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,o=e.length;n.test(e.charAt(--o)););return e.slice(0,o+1)},t.each=function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])},t.map=function(t,e){for(var n=[],o=0;o<t.length;o++)n.push(e(t[o]));return n},t.mergeWithParents=function(t,e,n){n=n||"parent";var o=function(t){return t?e[t]:null},i=function(t){return t?o(t[n]):null},r=function(t,e){if(null==t)return e;var n=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];"override"===e.mergeStrategy&&Array.prototype.push.apply(n,["events","overlays"]);var o=c(t,e,[],n);return r(i(t),o)},s=function(t){if(null==t)return{};if("string"==typeof t)return o(t);if(t.length){for(var e=!1,n=0,i=void 0;!e&&n<t.length;)(i=s(t[n]))?e=!0:n++;return i}},a=s(t);return a?r(i(a),a):{}},t.logEnabled=!0,t.log=m,t.wrap=function(t,e,n){return function(){var o=null;try{null!=e&&(o=e.apply(this,arguments))}catch(i){m("jsPlumb function failed : "+i)}if(null!=t&&(null==n||o!==n))try{o=t.apply(this,arguments)}catch(i){m("wrapped function failed : "+i)}return o}},t.EventGenerator=function(){var t=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(e,n,o){var i=function(e){d(t._listeners,e,n,o),n.__jsPlumb=n.__jsPlumb||{},n.__jsPlumb[g()]=e};if("string"==typeof e)i(e);else if(null!=e.length)for(var r=0;r<e.length;r++)i(e[r]);return t},this.fire=function(t,e,n){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var o=this._listeners[t].length,i=0,r=!1,s=null;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!r&&i<o&&!1!==s;){if(this.eventsToDieOn[t])this._listeners[t][i].apply(this,[e,n]);else try{s=this._listeners[t][i].apply(this,[e,n])}catch(a){m("jsPlumb: fire failed for event "+t+" : "+a)}i++,null!=this._listeners&&null!=this._listeners[t]||(r=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var e=t.queue.pop();e&&t.fire.apply(t,e)},this.unbind=function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb)for(var n in t.__jsPlumb)h(this._listeners[t.__jsPlumb[n]]||[],t)}else 2===arguments.length&&h(this._listeners[t]||[],e);return this},this.getListener=function(e){return t._listeners[e]},this.setSuspendEvents=function(e){t.eventsSuspended=e},this.isSuspendEvents=function(){return t.eventsSuspended},this.silently=function(e){t.setSuspendEvents(!0);try{e()}catch(n){m("Cannot execute silent function "+n)}t.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var e in t._listeners)t._listeners[e]=null}}}).call("undefined"!=typeof window?window:this),(function(){"use strict";this.jsPlumbUtil.matchesSelector=function(t,e,n){for(var o=(n=n||t.parentNode).querySelectorAll(e),i=0;i<o.length;i++)if(o[i]===t)return!0;return!1},this.jsPlumbUtil.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.jsPlumbUtil.sizeElement=function(t,e,n,o,i){t&&(t.style.height=i+"px",t.height=i,t.style.width=o+"px",t.width=o,t.style.left=e+"px",t.style.top=n+"px")}}).call("undefined"!=typeof window?window:this),(function(){var t={deriveAnchor:function(t,e,n,o){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][e]}},e=function(t,e){this.count=0,this.instance=t,this.lists={},this.options=e||{},this.instance.addList=function(t,e){return this.listManager.addList(t,e)},this.instance.removeList=function(t){this.listManager.removeList(t)},this.instance.bind("manageElement",(function(t){for(var e=this.instance.getSelector(t.el,"[jtk-scrollable-list]"),n=0;n<e.length;n++)this.addList(e[n])}).bind(this)),this.instance.bind("unmanageElement",(function(t){this.removeList(t.el)})),this.instance.bind("connection",(function(t,e){null==e&&(this._maybeUpdateParentList(t.source),this._maybeUpdateParentList(t.target))}).bind(this))};this.jsPlumbListManager=e,e.prototype={addList:function(e,o){var i=this.instance.extend({},t);this.instance.extend(i,this.options),o=this.instance.extend(i,o||{});var r=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[r]=new n(this.instance,e,o,r)},removeList:function(t){var e=this.lists[t._jsPlumbList];e&&(e.destroy(),delete this.lists[t._jsPlumbList])},_maybeUpdateParentList:function(t){for(var e=t.parentNode,n=this.instance.getContainer();null!=e&&e!==n;){if(null!=e._jsPlumbList&&null!=this.lists[e._jsPlumbList])return void e._jsPlumbScrollHandler();e=e.parentNode}}};var n=function(t,e,n,o){function i(t,e,o,i){return n.anchor?n.anchor:n.deriveAnchor(t,e,o,i)}function r(t,e,o,i){return n.deriveEndpoint?n.deriveEndpoint(t,e,o,i):n.endpoint?n.endpoint:o.type}e._jsPlumbList=o;var s=function(n){for(var o=t.getSelector(e,".jtk-managed"),s=t.getId(e),a=0;a<o.length;a++){if(o[a].offsetTop<e.scrollTop)o[a]._jsPlumbProxies||(o[a]._jsPlumbProxies=o[a]._jsPlumbProxies||[],t.select({source:o[a]}).each((function(n){t.proxyConnection(n,0,e,s,(function(){return r("top",0,n.endpoints[0],n)}),(function(){return i("top",0,n.endpoints[0],n)})),o[a]._jsPlumbProxies.push([n,0])})),t.select({target:o[a]}).each((function(n){t.proxyConnection(n,1,e,s,(function(){return r("top",1,n.endpoints[1],n)}),(function(){return i("top",1,n.endpoints[1],n)})),o[a]._jsPlumbProxies.push([n,1])})));else if(o[a].offsetTop+o[a].offsetHeight>e.scrollTop+e.offsetHeight)o[a]._jsPlumbProxies||(o[a]._jsPlumbProxies=o[a]._jsPlumbProxies||[],t.select({source:o[a]}).each((function(n){t.proxyConnection(n,0,e,s,(function(){return r("bottom",0,n.endpoints[0],n)}),(function(){return i("bottom",0,n.endpoints[0],n)})),o[a]._jsPlumbProxies.push([n,0])})),t.select({target:o[a]}).each((function(n){t.proxyConnection(n,1,e,s,(function(){return r("bottom",1,n.endpoints[1],n)}),(function(){return i("bottom",1,n.endpoints[1],n)})),o[a]._jsPlumbProxies.push([n,1])})));else if(o[a]._jsPlumbProxies){for(var l=0;l<o[a]._jsPlumbProxies.length;l++)t.unproxyConnection(o[a]._jsPlumbProxies[l][0],o[a]._jsPlumbProxies[l][1],s);delete o[a]._jsPlumbProxies}t.revalidate(o[a])}!function(e){for(var n=e.parentNode,o=t.getContainer();null!=n&&n!==o;){if(t.hasClass(n,"jtk-managed"))return void t.recalculateOffsets(n);n=n.parentNode}}(e)};t.setAttribute(e,"jtk-scrollable-list","true"),e._jsPlumbScrollHandler=s,t.on(e,"scroll",s),s(),this.destroy=function(){t.off(e,"scroll",s),delete e._jsPlumbScrollHandler;for(var n=t.getSelector(e,".jtk-managed"),o=t.getId(e),i=0;i<n.length;i++)if(n[i]._jsPlumbProxies){for(var r=0;r<n[i]._jsPlumbProxies.length;r++)t.unproxyConnection(n[i]._jsPlumbProxies[r][0],n[i]._jsPlumbProxies[r][1],o);delete n[i]._jsPlumbProxies}}}}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this,n=t.jsPlumbUtil,o=function(){return""+(new Date).getTime()},i=function(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var e={};p.extend(e,t._jsPlumb.paintStyle),p.extend(e,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,e.gradient&&t._jsPlumb.paintStyle.fill&&delete e.gradient,t._jsPlumb.hoverPaintStyle=e}},r=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],s=function(t){return null==t?null:t.split(" ")},a=function(t,e,n){for(var o in e)t[o]=n},l=function(t,e,o){if(t.getDefaultType){var i=t.getTypeDescriptor(),r={},s=t.getDefaultType(),l=n.merge({},s);a(r,s,"__default");for(var c=0,u=t._jsPlumb.types.length;c<u;c++){var h=t._jsPlumb.types[c];if("__default"!==h){var d=t._jsPlumb.instance.getType(h,i);if(null!=d){var p=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"],f=[];"override"===d.mergeStrategy?Array.prototype.push.apply(p,["events","overlays","cssClass"]):f.push("cssClass"),l=n.merge(l,d,f,p),a(r,d,h)}}}e&&(l=n.populate(l,e,"_")),t.applyType(l,o,r),o||t.repaint()}},c=t.jsPlumbUIComponent=function(t){n.EventGenerator.apply(this,arguments);var e=this,o=arguments,i=e.idPrefix,r=i+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(t,e,n){this._jsPlumb.typeCache[n]=this._jsPlumb.typeCache[n]||{},this._jsPlumb.typeCache[n][t]=e},this.getCachedTypeItem=function(t,e){return this._jsPlumb.typeCache[e]?this._jsPlumb.typeCache[e][t]:null},this.getId=function(){return r};var s=t.overlays||[],a={};if(this.defaultOverlayKeys){for(var l=0;l<this.defaultOverlayKeys.length;l++)Array.prototype.push.apply(s,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[l]]||[]);for(l=0;l<s.length;l++){var c=p.convertToFullOverlaySpec(s[l]);a[c[1].id]=c}}var u={overlays:a,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return u},this.appendToDefaultType=function(t){for(var e in t)u[e]=t[e]},t.events)for(var h in t.events)e.bind(h,t.events[h]);this.clone=(function(){var t=Object.create(this.constructor.prototype);return this.constructor.apply(t,o),t}).bind(this),this.isDetachAllowed=function(t){var e=!0;if(this._jsPlumb.beforeDetach)try{e=this._jsPlumb.beforeDetach(t)}catch(o){n.log("jsPlumb: beforeDetach callback failed",o)}return e},this.isDropAllowed=function(t,e,o,i,r,s,a){var l=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:e,scope:o,connection:i,dropEndpoint:r,source:s,target:a});if(this._jsPlumb.beforeDrop)try{l=this._jsPlumb.beforeDrop({sourceId:t,targetId:e,scope:o,connection:i,dropEndpoint:r,source:s,target:a})}catch(c){n.log("jsPlumb: beforeDrop callback failed",c)}return l};var d=[];this.setListenerComponent=function(t){for(var e=0;e<d.length;e++)d[e][3]=t}},u=function(t,e){var n=t._jsPlumb.instance.getType(t._jsPlumb.types[e],t.getTypeDescriptor());null!=n&&n.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,n.cssClass)};n.extend(t.jsPlumbUIComponent,n.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,e){this._jsPlumb.parameters[t]=e},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return p.getClass(this.canvas)},hasClass:function(t){return p.hasClass(this.canvas,t)},addClass:function(t){p.addClass(this.canvas,t)},removeClass:function(t){p.removeClass(this.canvas,t)},updateClasses:function(t,e){p.updateClasses(this.canvas,t,e)},setType:function(t,e,n){this.clearTypes(),this._jsPlumb.types=s(t)||[],l(this,e,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,e){l(this,t,e)},hasType:function(t){return-1!==this._jsPlumb.types.indexOf(t)},addType:function(t,e,n){var o=s(t),i=!1;if(null!=o){for(var r=0,a=o.length;r<a;r++)this.hasType(o[r])||(this._jsPlumb.types.push(o[r]),i=!0);i&&l(this,e,n)}},removeType:function(t,e,n){var o=s(t),i=!1,r=(function(t){var e=this._jsPlumb.types.indexOf(t);return-1!==e&&(u(this,e),this._jsPlumb.types.splice(e,1),!0)}).bind(this);if(null!=o){for(var a=0,c=o.length;a<c;a++)i=r(o[a])||i;i&&l(this,e,n)}},clearTypes:function(t,e){for(var n=this._jsPlumb.types.length,o=0;o<n;o++)u(this,0),this._jsPlumb.types.splice(0,1);l(this,t,e)},toggleType:function(t,e,n){var o=s(t);if(null!=o){for(var i=0,r=o.length;i<r;i++){var a=this._jsPlumb.types.indexOf(o[i]);-1!==a?(u(this,a),this._jsPlumb.types.splice(a,1)):this._jsPlumb.types.push(o[i])}l(this,e,n)}},applyType:function(t,e){if(this.setPaintStyle(t.paintStyle,e),this.setHoverPaintStyle(t.hoverPaintStyle,e),t.parameters)for(var n in t.parameters)this.setParameter(n,t.parameters[n]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,e){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,i(this),e||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,e){this._jsPlumb.hoverPaintStyle=t,i(this),e||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){(t||null==this.typeId)&&(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(t,e,n){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=t;var i=t?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[i](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[i](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(n=n||o(),this.repaint({timestamp:n,recalc:!1}))),this.getAttachedElements&&!e&&function(t,e,n,o){var i=t.getAttachedElements();if(i)for(var r=0,s=i.length;r<s;r++)o&&o===i[r]||i[r].setHover(e,!0,n)}(this,t,o(),this)}}});var h=0,d=t.jsPlumbInstance=function(e){this.version="2.14.3",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},ListStyle:{},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},e&&p.extend(this.Defaults,e),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},n.EventGenerator.apply(this);var i=this,s=function(){var t=h+1;return h++,t}(),a=i.bind,l={},u=1,d=function(t){if(null==t)return null;if(3===t.nodeType||8===t.nodeType)return{el:t,text:!0};var e=i.getElement(t);return{el:e,id:n.isString(t)&&null==e?t:G(e)}};for(var f in this.getInstanceIndex=function(){return s},this.setZoom=function(t,e){return i.fire("zoom",u=t),e&&i.repaintEverything(),!0},this.getZoom=function(){return u},this.Defaults)l[f]=this.Defaults[f];var g,m=[];this.unbindContainer=function(){if(null!=g&&m.length>0)for(var t=0;t<m.length;t++)i.off(g,m[t][0],m[t][1])},this.setContainer=function(t){this.unbindContainer(),t=this.getElement(t),this.select().each((function(e){e.moveParent(t)})),this.selectEndpoints().each((function(e){e.moveParent(t)}));var e=g;g=t,m.length=0;for(var n={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},o=function(t,e,o){var r=e.srcElement||e.target,s=(r&&r.parentNode?r.parentNode._jsPlumb:null)||(r?r._jsPlumb:null)||(r&&r.parentNode&&r.parentNode.parentNode?r.parentNode.parentNode._jsPlumb:null);s&&(s.fire(t,s,e),i.fire(o&&n[o+t]||t,s.component||s,e))},s=function(t,e,n){m.push([t,n]),i.on(g,t,e,n)},a=function(t){s(t,".jtk-connector",(function(e){o(t,e)})),s(t,".jtk-endpoint",(function(e){o(t,e,"endpoint")})),s(t,".jtk-overlay",(function(e){o(t,e)}))},l=0;l<r.length;l++)a(r[l]);for(var c in x){var u=x[c].el;u.parentNode===e&&(e.removeChild(u),g.appendChild(u))}},this.getContainer=function(){return g},this.bind=function(t,e){"ready"===t&&b?e():a.apply(i,[t,e])},i.importDefaults=function(t){for(var e in t)i.Defaults[e]=t[e];return t.Container&&i.setContainer(t.Container),i},i.restoreDefaults=function(){return i.Defaults=p.extend({},l),i};var v=null,b=!1,y=[],P={},C={},x={},_={},S={},w=!1,E=[],j=!1,D=null,k=this.Defaults.Scope,I=1,O=function(){return""+I++},T=(function(t,e){g?g.appendChild(t):e?this.getElement(e).appendChild(t):this.appendToRoot(t)}).bind(this),A=function(t,e,n,r){if(!j&&null!=(t=i.getElement(t))){var s=G(t),a=t.querySelectorAll(".jtk-managed");null==n&&(n=o()),st({elId:s,offset:e,recalc:!1,timestamp:n});for(var l=0;l<a.length;l++)st({elId:a[l].getAttribute("id"),recalc:!0,timestamp:n});if(i.anchorManager.redraw(s,e,n,null,r),a)for(var c=0;c<a.length;c++)i.anchorManager.redraw(a[c].getAttribute("id"),null,n,null,r,!0)}},M=function(t){return C[t]},L=(function(t,e){var o=p.extend({},t);if(e&&p.extend(o,e),o.source&&(o.source.endpoint?o.sourceEndpoint=o.source:o.source=i.getElement(o.source)),o.target&&(o.target.endpoint?o.targetEndpoint=o.target:o.target=i.getElement(o.target)),t.uuids&&(o.sourceEndpoint=M(t.uuids[0]),o.targetEndpoint=M(t.uuids[1])),o.sourceEndpoint&&o.sourceEndpoint.isFull())n.log(i,"could not add connection; source endpoint is full");else if(o.targetEndpoint&&o.targetEndpoint.isFull())n.log(i,"could not add connection; target endpoint is full");else{if(!o.type&&o.sourceEndpoint&&(o.type=o.sourceEndpoint.connectionType),o.sourceEndpoint&&o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var r=0,s=o.sourceEndpoint.connectorOverlays.length;r<s;r++)o.overlays.push(o.sourceEndpoint.connectorOverlays[r])}o.sourceEndpoint&&o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope),!o["pointer-events"]&&o.sourceEndpoint&&o.sourceEndpoint.connectorPointerEvents&&(o["pointer-events"]=o.sourceEndpoint.connectorPointerEvents);var a=function(t,e,n,r){if(o[t]&&!o[t].endpoint&&!o[t+"Endpoint"]&&!o.newConnection){var s=n[G(o[t])];if(s=s?s[r]:null){if(!s.enabled)return!1;var a=p.extend({},s.def);delete a.label;var l=null!=s.endpoint&&s.endpoint._jsPlumb?s.endpoint:function(t,e,n){var r=function(t,e){var n=p.extend({},t);for(var o in e)e[o]&&(n[o]=e[o]);return n}(e,{anchor:o.anchors?o.anchors[n]:o.anchor,endpoint:o.endpoints?o.endpoints[n]:o.endpoint,paintStyle:o.endpointStyles?o.endpointStyles[n]:o.endpointStyle,hoverPaintStyle:o.endpointHoverStyles?o.endpointHoverStyles[n]:o.endpointHoverStyle});return i.addEndpoint(t,r)}(o[t],a,e);if(l.isFull())return!1;o[t+"Endpoint"]=l,!o.scope&&a.scope&&(o.scope=a.scope),s.uniqueEndpoint?s.endpoint?l.finalEndpoint=s.endpoint:(s.endpoint=l,l.setDeleteOnEmpty(!1)):l.setDeleteOnEmpty(!0),0===e&&s.def.connectorOverlays&&(o.overlays=o.overlays||[],Array.prototype.push.apply(o.overlays,s.def.connectorOverlays))}}};if(!1!==a("source",0,this.sourceEndpointDefinitions,o.type||"default")&&!1!==a("target",1,this.targetEndpointDefinitions,o.type||"default"))return o.sourceEndpoint&&o.targetEndpoint&&(function(t,e){for(var n=t.scope.split(/\s/),o=e.scope.split(/\s/),i=0;i<n.length;i++)for(var r=0;r<o.length;r++)if(o[r]===n[i])return!0;return!1}(o.sourceEndpoint,o.targetEndpoint)||(o=null)),o}}).bind(i),F=function(t){var e=i.Defaults.ConnectionType||i.getDefaultConnectionType();t._jsPlumb=i,t.newConnection=F,t.newEndpoint=R,t.endpointsByUUID=C,t.endpointsByElement=P,t.finaliseConnection=N,t.id="con_"+O();var n=new e(t);return n.isDetachable()&&(n.endpoints[0].initDraggable("_jsPlumbSource"),n.endpoints[1].initDraggable("_jsPlumbTarget")),n},N=i.finaliseConnection=function(t,e,n,o){e=e||{},t.suspendedEndpoint||y.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,!1!==o&&i.router.newConnection(t),A(t.source),e.doNotFireConnectionEvent||!1===e.fireEvent||i.fire("connection",{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]},n)},R=function(t,e){var n=i.Defaults.EndpointType||p.Endpoint,o=p.extend({},t);o._jsPlumb=i,o.newConnection=F,o.newEndpoint=R,o.endpointsByUUID=C,o.endpointsByElement=P,o.fireDetachEvent=X,o.elementId=e||G(o.source);var r=new n(o);return r.id="ep_"+O(),rt(o.elementId,o.source),p.headless||i.getDragManager().endpointAdded(o.source,e),r},H=function(t,e,n){var o=P[t];if(o&&o.length)for(var i=0,r=o.length;i<r;i++){for(var s=0,a=o[i].connections.length;s<a;s++)if(e(o[i].connections[s]))return;n&&n(o[i])}},U=function(t,e,n){e="block"===e;var o=null;n&&(o=function(t){t.setVisible(e,!0,!0)});var i=d(t);H(i.id,(function(t){e&&n?t.endpoints[t.sourceId===i.id?1:0].isVisible()&&t.setVisible(!0):t.setVisible(e)}),o)},G=function(t,e,o){if(n.isString(t))return t;if(null==t)return null;var r=i.getAttribute(t,"id");return r&&"undefined"!==r||(2===arguments.length&&void 0!==arguments[1]?r=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(r="jsPlumb_"+s+"_"+O()),o||i.setAttribute(t,"id",r)),r};this.setConnectionBeingDragged=function(t){w=t},this.isConnectionBeingDragged=function(){return w},this.getManagedElements=function(){return x},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(t,e,o){var r=p.extend({},o=o||{});p.extend(r,e),r.endpoint=r.endpoint||i.Defaults.Endpoint,r.paintStyle=r.paintStyle||i.Defaults.EndpointStyle;for(var s=[],a=n.isArray(t)||null!=t.length&&!n.isString(t)?t:[t],l=0,c=a.length;l<c;l++){r.source=i.getElement(a[l]),it(r.source);var u=G(r.source),h=R(r,u),d=rt(u,r.source,null,!j).info.o;n.addToList(P,u,h),j||h.paint({anchorLoc:h.anchor.compute({xy:[d.left,d.top],wh:E[u],element:h,timestamp:D}),timestamp:D}),s.push(h)}return 1===s.length?s[0]:s},this.addEndpoints=function(t,e,o){for(var r=[],s=0,a=e.length;s<a;s++){var l=i.addEndpoint(t,e[s],o);n.isArray(l)?Array.prototype.push.apply(r,l):r.push(l)}return r},this.animate=function(t,e,o){if(!this.animationSupported)return!1;o=o||{};var r=i.getElement(t),s=G(r),a=p.animEvents.step,l=p.animEvents.complete;o[a]=n.wrap(o[a],(function(){i.revalidate(s)})),o[l]=n.wrap(o[l],(function(){i.revalidate(s)})),i.doAnimate(r,e,o)},this.checkCondition=function(t,e){var o=i.getListener(t),r=!0;if(o&&o.length>0){var s=Array.prototype.slice.call(arguments,1);try{for(var a=0,l=o.length;a<l;a++)r=r&&o[a].apply(o[a],s)}catch(c){n.log(i,"cannot check condition ["+t+"]"+c)}}return r},this.connect=function(t,e){var o,i=L(t,e);if(i){if(null==i.source&&null==i.sourceEndpoint)return void n.log("Cannot establish connection - source does not exist");if(null==i.target&&null==i.targetEndpoint)return void n.log("Cannot establish connection - target does not exist");it(i.source),o=F(i),N(o,i)}return o};var B=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],W=(function(t,e,n,o){var i,r,s,a=B[n],l=t[a.elId],c=t.endpoints[n],u={index:n,originalSourceId:0===n?l:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?l:t.targetId,newTargetId:t.targetId,connection:t};if(e.constructor===p.Endpoint)(i=e).addConnection(t),e=i.element;else if(r=G(e),s=this[a.epDefs][r],r===t[a.elId])i=null;else if(s)for(var h in s){if(!s[h].enabled)return;i=null!=s[h].endpoint&&s[h].endpoint._jsPlumb?s[h].endpoint:this.addEndpoint(e,s[h].def),s[h].uniqueEndpoint&&(s[h].endpoint=i),i.addConnection(t)}else i=t.makeEndpoint(0===n,e,r);return null!=i&&(c.detachFromConnection(t),t.endpoints[n]=i,t[a.el]=i.element,t[a.elId]=i.elementId,u[0===n?"newSourceId":"newTargetId"]=i.elementId,q(u),o||t.repaint()),u.element=e,u}).bind(this);this.setSource=function(t,e,n){var o=W(t,e,0,n);this.router.sourceOrTargetChanged(o.originalSourceId,o.newSourceId,t,o.el,0)},this.setTarget=function(t,e,n){var o=W(t,e,1,n);this.router.sourceOrTargetChanged(o.originalTargetId,o.newTargetId,t,o.el,1)},this.deleteEndpoint=function(t,e,n){var o="string"==typeof t?C[t]:t;return o&&i.deleteObject({endpoint:o,dontUpdateHover:e,deleteAttachedObjects:n}),i},this.deleteEveryEndpoint=function(){var t=i.setSuspendDrawing(!0);for(var e in P){var n=P[e];if(n&&n.length)for(var o=0,r=n.length;o<r;o++)i.deleteEndpoint(n[o],!0)}P={},x={},C={},_={},S={},i.router.reset();var s=i.getDragManager();return s&&s.reset(),t||i.setSuspendDrawing(!1),i};var X=function(t,e,n){var o=i.Defaults.ConnectionType||i.getDefaultConnectionType(),r=t.constructor===o?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&i.fire("connectionDetached",r,n),i.fire("internal.connectionDetached",r,n),i.router.connectionDetached(r)},q=i.fireMoveEvent=function(t,e){i.fire("connectionMoved",t,e)};this.unregisterEndpoint=function(t){for(var e in t._jsPlumb.uuid&&(C[t._jsPlumb.uuid]=null),i.anchorManager.deleteEndpoint(t),P){var n=P[e];if(n){for(var o=[],r=0,s=n.length;r<s;r++)n[r]!==t&&o.push(n[r]);P[e]=o}P[e].length<1&&delete P[e]}},this.deleteConnection=function(t,e){return!(null==t||!(e=e||{}).force&&!n.functionChain(!0,!1,[[t.endpoints[0],"isDetachAllowed",[t]],[t.endpoints[1],"isDetachAllowed",[t]],[t,"isDetachAllowed",[t]],[i,"checkCondition",["beforeDetach",t]]])||(t.setHover(!1),X(t,!t.pending&&!1!==e.fireEvent,e.originalEvent),t.endpoints[0].detachFromConnection(t),t.endpoints[1].detachFromConnection(t),n.removeWithFunction(y,(function(e){return t.id===e.id})),t.cleanup(),t.destroy(),0))},this.deleteEveryConnection=function(t){t=t||{};var e=y.length,n=0;return i.batch((function(){for(var o=0;o<e;o++)n+=i.deleteConnection(y[0],t)?1:0})),n},this.deleteConnectionsForElement=function(t,e){e=e||{},t=i.getElement(t);var n=G(t),o=P[n];if(o&&o.length)for(var r=0,s=o.length;r<s;r++)o[r].deleteEveryConnection(e);return i},this.deleteObject=function(t){var e={endpoints:{},connections:{},endpointCount:0,connectionCount:0},o=!1!==t.deleteAttachedObjects,r=function(n){null!=n&&null==e.connections[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),e.connections[n.id]=n,e.connectionCount++)};for(var s in t.connection?r(t.connection):function(n){if(null!=n&&null==e.endpoints[n.id]&&(t.dontUpdateHover||null==n._jsPlumb||n.setHover(!1),e.endpoints[n.id]=n,e.endpointCount++,o))for(var i=0;i<n.connections.length;i++)r(n.connections[i])}(t.endpoint),e.connections){var a=e.connections[s];if(a._jsPlumb){n.removeWithFunction(y,(function(t){return a.id===t.id})),X(a,!1!==t.fireEvent&&!a.pending,t.originalEvent);var l=null==t.deleteAttachedObjects?null:!t.deleteAttachedObjects;a.endpoints[0].detachFromConnection(a,null,l),a.endpoints[1].detachFromConnection(a,null,l),a.cleanup(!0),a.destroy(!0)}}for(var c in e.endpoints){var u=e.endpoints[c];u._jsPlumb&&(i.unregisterEndpoint(u),u.cleanup(!0),u.destroy(!0))}return e};var Y=function(t,e,n,o){for(var i=0,r=t.length;i<r;i++)t[i][e].apply(t[i],n);return o(t)},z=function(t,e,n){for(var o=[],i=0,r=t.length;i<r;i++)o.push([t[i][e].apply(t[i],n),t[i]]);return o},V=function(t,e,n){return function(){return Y(t,e,arguments,n)}},Q=function(t,e){return function(){return z(t,e,arguments)}},J=function(t,e){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(e)n=t;else if(t.length)for(var o=0,i=t.length;o<i;o++)n.push(d(t[o]).id);else n.push(d(t).id);return n},K=function(t,e,n){return"*"===t||(t.length>0?-1!==t.indexOf(e):!n)};this.getConnections=function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var n=t.scope||i.getDefaultScope(),o=J(n,!0),r=J(t.source),s=J(t.target),a=!e&&o.length>1?{}:[],l=function(t,n){if(!e&&o.length>1){var i=a[t];null==i&&(i=a[t]=[]),i.push(n)}else a.push(n)},c=0,u=y.length;c<u;c++){var h=y[c],d=h.proxies&&h.proxies[0]?h.proxies[0].originalEp.elementId:h.sourceId,p=h.proxies&&h.proxies[1]?h.proxies[1].originalEp.elementId:h.targetId;K(o,h.scope)&&K(r,d)&&K(s,p)&&l(h.scope,h)}return a};var Z=function(t,e){return function(n){for(var o=0,i=t.length;o<i;o++)n(t[o]);return e(t)}},$=function(t){return function(e){return t[e]}},tt=function(t,e){var n,o,i={length:t.length,each:Z(t,e),get:$(t)},r=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],s=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(n=0,o=r.length;n<o;n++)i[r[n]]=V(t,r[n],e);for(n=0,o=s.length;n<o;n++)i[s[n]]=Q(t,s[n]);return i},et=function(t){var e=tt(t,et);return p.extend(e,{setDetachable:V(t,"setDetachable",et),setReattach:V(t,"setReattach",et),setConnector:V(t,"setConnector",et),delete:function(){for(var e=0,n=t.length;e<n;e++)i.deleteConnection(t[e])},isDetachable:Q(t,"isDetachable"),isReattach:Q(t,"isReattach")})},nt=function(t){var e=tt(t,nt);return p.extend(e,{setEnabled:V(t,"setEnabled",nt),setAnchor:V(t,"setAnchor",nt),isEnabled:Q(t,"isEnabled"),deleteEveryConnection:function(){for(var e=0,n=t.length;e<n;e++)t[e].deleteEveryConnection()},delete:function(){for(var e=0,n=t.length;e<n;e++)i.deleteEndpoint(t[e])}})};this.select=function(t){return(t=t||{}).scope=t.scope||"*",et(t.connections||i.getConnections(t,!0))},this.selectEndpoints=function(t){(t=t||{}).scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":J(t.element),o=e?"*":J(t.source),i=e?"*":J(t.target),r=J(t.scope,!0),s=[];for(var a in P){var l=K(n,a,!0),c=K(o,a,!0),u="*"!==o,h=K(i,a,!0),d="*"!==i;if(l||c||h)t:for(var p=0,f=P[a].length;p<f;p++){var g=P[a][p];if(K(r,g.scope,!0)){if(u&&o.length>0&&!g.isSource||d&&i.length>0&&!g.isTarget)continue t;s.push(g)}}}return nt(s)},this.getAllConnections=function(){return y},this.getDefaultScope=function(){return k},this.getEndpoint=M,this.getEndpoints=function(t){return P[d(t).id]||[]},this.getDefaultEndpointType=function(){return p.Endpoint},this.getDefaultConnectionType=function(){return p.Connection},this.getId=G,this.draw=A,this.info=d,this.appendElement=T;var ot=!1;this.isHoverSuspended=function(){return ot},this.setHoverSuspended=function(t){ot=t},this.hide=function(t,e){return U(t,"none",e),i},this.idstamp=O;var it=function(t){if(!g&&t){var e=i.getElement(t);e.offsetParent&&i.setContainer(e.offsetParent)}},rt=i.manage=function(t,e,n,o){return x[t]?o&&(x[t].info=st({elId:t,timestamp:D,recalc:!0})):(x[t]={el:e,endpoints:[],connections:[]},x[t].info=st({elId:t,timestamp:D}),i.addClass(e,"jtk-managed"),n||i.fire("manageElement",{id:t,info:x[t].info,el:e})),x[t]},st=(i.unmanage=function(t){if(x[t]){var e=x[t].el;i.removeClass(e,"jtk-managed"),delete x[t],i.fire("unmanageElement",{id:t,el:e})}},function(t){var e,n=t.timestamp,o=t.recalc,r=t.offset,s=t.elId;return j&&!n&&(n=D),!o&&n&&n===S[s]?{o:t.offset||_[s],s:E[s]}:(o||!r&&null==_[s]?null!=(e=x[s]?x[s].el:null)&&(E[s]=i.getSize(e),_[s]=i.getOffset(e),S[s]=n):(_[s]=r||_[s],null==E[s]&&null!=(e=x[s].el)&&(E[s]=i.getSize(e)),S[s]=n),_[s]&&!_[s].right&&(_[s].right=_[s].left+E[s][0],_[s].bottom=_[s].top+E[s][1],_[s].width=E[s][0],_[s].height=E[s][1],_[s].centerx=_[s].left+_[s].width/2,_[s].centery=_[s].top+_[s].height/2),{o:_[s],s:E[s]})});this.updateOffset=st,this.init=(function(){b||(i.Defaults.Container&&i.setContainer(i.Defaults.Container),i.router=new t.jsPlumb.DefaultRouter(i),i.anchorManager=i.router.anchorManager,b=!0,i.fire("ready",i))}).bind(this),this.log=v,this.jsPlumbUIComponent=c,this.makeAnchor=function(){var e,o=function(e,n){if(t.jsPlumb.Anchors[e])return new t.jsPlumb.Anchors[e](n);if(!i.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+e+"'"}};if(0===arguments.length)return null;var r=arguments[0],s=arguments[1],a=null;if(r.compute&&r.getOrientation)return r;if("string"==typeof r)a=o(arguments[0],{elementId:s,jsPlumbInstance:i});else if(n.isArray(r))if(n.isArray(r[0])||n.isString(r[0]))2===r.length&&n.isObject(r[1])?n.isString(r[0])?(e=t.jsPlumb.extend({elementId:s,jsPlumbInstance:i},r[1]),a=o(r[0],e)):(e=t.jsPlumb.extend({elementId:s,jsPlumbInstance:i,anchors:r[0]},r[1]),a=new t.jsPlumb.DynamicAnchor(e)):a=new p.DynamicAnchor({anchors:r,selector:null,elementId:s,jsPlumbInstance:i});else{var l={x:r[0],y:r[1],orientation:r.length>=4?[r[2],r[3]]:[0,0],offsets:r.length>=6?[r[4],r[5]]:[0,0],elementId:s,jsPlumbInstance:i,cssClass:7===r.length?r[6]:null};(a=new t.jsPlumb.Anchor(l)).clone=function(){return new t.jsPlumb.Anchor(l)}}return a.id||(a.id="anchor_"+O()),a},this.makeAnchors=function(e,o,r){for(var s=[],a=0,l=e.length;a<l;a++)"string"==typeof e[a]?s.push(t.jsPlumb.Anchors[e[a]]({elementId:o,jsPlumbInstance:r})):n.isArray(e[a])&&s.push(i.makeAnchor(e[a],o,r));return s},this.makeDynamicAnchor=function(e,n){return new t.jsPlumb.DynamicAnchor({anchors:e,selector:n,elementId:null,jsPlumbInstance:i})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};var at=function(e,o,r,s,a){var l=new c(o),u=o._jsPlumb.EndpointDropHandler({jsPlumb:i,enabled:function(){return e.def.enabled},isFull:function(){var t=i.select({target:e.id}).length;return e.def.maxConnections>0&&t>=e.def.maxConnections},element:e.el,elementId:e.id,isSource:s,isTarget:a,addClass:function(t){i.addClass(e.el,t)},removeClass:function(t){i.removeClass(e.el,t)},onDrop:function(t){t.endpoints[0].anchor.unlock()},isDropAllowed:function(){return l.isDropAllowed.apply(l,arguments)},isRedrop:function(t){return null!=t.suspendedElement&&null!=t.suspendedEndpoint&&t.suspendedEndpoint.element===e.el},getEndpoint:function(n){var r=e.def.endpoint;if(null==r||null==r._jsPlumb){var s=i.deriveEndpointAndAnchorSpec(n.getType().join(" "),!0),a=s.endpoints?t.jsPlumb.extend(o,{endpoint:e.def.def.endpoint||s.endpoints[1]}):o;s.anchors&&(a=t.jsPlumb.extend(a,{anchor:e.def.def.anchor||s.anchors[1]})),(r=i.addEndpoint(e.el,a))._mtNew=!0}if(o.uniqueEndpoint&&(e.def.endpoint=r),r.setDeleteOnEmpty(!0),n.isDetachable()&&r.initDraggable(),null!=r.anchor.positionFinder){var l=i.getUIPosition(arguments,i.getZoom()),c=i.getOffset(e.el),u=i.getSize(e.el),h=null==l?[0,0]:r.anchor.positionFinder(l,c,u,r.anchor.constructorParams);r.anchor.x=h[0],r.anchor.y=h[1]}return r},maybeCleanup:function(t){t._mtNew&&0===t.connections.length?i.deleteObject({endpoint:t}):delete t._mtNew}}),h=t.jsPlumb.dragEvents.drop;return r.scope=r.scope||o.scope||i.Defaults.Scope,r[h]=n.wrap(r[h],u,!0),r.rank=o.rank||0,a&&(r[t.jsPlumb.dragEvents.over]=function(){return!0}),!1===o.allowLoopback&&(r.canDrop=function(t){return t.getDragElement()._jsPlumbRelatedElement!==e.el}),i.initDroppable(e.el,r,"internal"),u};this.makeTarget=function(e,n,o){var r=t.jsPlumb.extend({_jsPlumb:this},o);t.jsPlumb.extend(r,n);for(var s=r.maxConnections||-1,a=(function(e){var n=d(e),o=n.id,a=t.jsPlumb.extend({},r.dropOptions||{}),l=r.connectionType||"default";this.targetEndpointDefinitions[o]=this.targetEndpointDefinitions[o]||{},it(o),n.el._isJsPlumbGroup&&null==a.rank&&(a.rank=-1);var c={def:t.jsPlumb.extend({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:s,enabled:!0};r.createEndpoint&&(c.uniqueEndpoint=!0,c.endpoint=i.addEndpoint(e,c.def),c.endpoint.setDeleteOnEmpty(!1)),n.def=c,this.targetEndpointDefinitions[o][l]=c,at(n,r,a,!0===r.isSource,!0),n.el._katavorioDrop[n.el._katavorioDrop.length-1].targetDef=c}).bind(this),l=e.length&&e.constructor!==String?e:[e],c=0,u=l.length;c<u;c++)a(l[c]);return this},this.unmakeTarget=function(t,e){var n=d(t);return i.destroyDroppable(n.el,"internal"),e||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(e,o,r){var s=t.jsPlumb.extend({_jsPlumb:this},r);t.jsPlumb.extend(s,o);var a=s.connectionType||"default",l=i.deriveEndpointAndAnchorSpec(a);s.endpoint=s.endpoint||l.endpoints[0],s.anchor=s.anchor||l.anchors[0];for(var c=s.maxConnections||-1,h=s.onMaxConnections,p=(function(o){var r=o.id,l=this.getElement(o.el);this.sourceEndpointDefinitions[r]=this.sourceEndpointDefinitions[r]||{},it(r);var d={def:t.jsPlumb.extend({},s),uniqueEndpoint:s.uniqueEndpoint,maxConnections:c,enabled:!0};s.createEndpoint&&(d.uniqueEndpoint=!0,d.endpoint=i.addEndpoint(e,d.def),d.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[r][a]=d,o.def=d;var p=t.jsPlumb.dragEvents.stop,f=t.jsPlumb.dragEvents.drag,g=t.jsPlumb.extend({},s.dragOptions||{}),m=g.drag,v=g.stop,b=null,y=!1;g.scope=g.scope||s.scope,g[f]=n.wrap(g[f],(function(){m&&m.apply(this,arguments),y=!1})),g[p]=n.wrap(g[p],(function(){if(v&&v.apply(this,arguments),this.currentlyDragging=!1,null!=b._jsPlumb){var t=s.anchor||this.Defaults.Anchor,e=b.anchor,n=b.connections[0],o=this.makeAnchor(t,r,this),a=b.element;if(null!=o.positionFinder){var l=i.getOffset(a),c=this.getSize(a),u={left:l.left+e.x*c[0],top:l.top+e.y*c[1]},h=o.positionFinder(u,l,c,o.constructorParams);o.x=h[0],o.y=h[1]}b.setAnchor(o,!0),b.repaint(),this.repaint(b.elementId),null!=n&&this.repaint(n.targetId)}}).bind(this));var P=(function(e){if(3!==e.which&&2!==e.button){r=this.getId(this.getElement(o.el));var d=this.sourceEndpointDefinitions[r][a];if(d.enabled){if(s.filter&&!1===(n.isString(s.filter)?function(t,e,n,o,i){for(var r=t.target||t.srcElement,s=!1,a=o.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===r){s=!0;break}return i?!s:s}(e,o.el,s.filter,this,s.filterExclude):s.filter(e,o.el)))return;var p=this.select({source:r}).length;if(d.maxConnections>=0&&p>=d.maxConnections)return h&&h({element:o.el,maxConnections:c},e),!1;var f=t.jsPlumb.getPositionOnElement(e,l,u),m={};t.jsPlumb.extend(m,d.def),m.isTemporarySource=!0,m.anchor=[f[0],f[1],0,0],m.dragOptions=g,d.def.scope&&(m.scope=d.def.scope),b=this.addEndpoint(r,m),y=!0,b.setDeleteOnEmpty(!0),d.uniqueEndpoint&&(d.endpoint?b.finalEndpoint=d.endpoint:(d.endpoint=b,b.setDeleteOnEmpty(!1)));var v=function(){i.off(b.canvas,"mouseup",v),i.off(o.el,"mouseup",v),y&&(y=!1,i.deleteEndpoint(b))};i.on(b.canvas,"mouseup",v),i.on(o.el,"mouseup",v);var P={};if(d.def.extract)for(var C in d.def.extract){var x=(e.srcElement||e.target).getAttribute(C);x&&(P[d.def.extract[C]]=x)}i.trigger(b.canvas,"mousedown",e,P),n.consume(e)}}}).bind(this);this.on(o.el,"mousedown",P),d.trigger=P,s.filter&&(n.isString(s.filter)||n.isFunction(s.filter))&&i.setDragFilter(o.el,s.filter);var C=t.jsPlumb.extend({},s.dropOptions||{});at(o,s,C,!0,!0===s.isTarget)}).bind(this),f=e.length&&e.constructor!==String?e:[e],g=0,m=f.length;g<m;g++)p(d(f[g]));return this},this.unmakeSource=function(t,e,n){var o=d(t);i.destroyDroppable(o.el,"internal");var r=this.sourceEndpointDefinitions[o.id];if(r)for(var s in r)if(null==e||e===s){var a=r[s].trigger;a&&i.off(o.el,"mousedown",a),n||delete this.sourceEndpointDefinitions[o.id][s]}return this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)i.unmakeSource(t,null,!0);return this.sourceEndpointDefinitions={},this};var lt=(function(t,e,o){e=n.isArray(e)?e:[e];var i=G(t);o=o||"default";for(var r=0;r<e.length;r++){var s=this[e[r]][i];if(s&&s[o])return s[o].def.scope||this.Defaults.Scope}}).bind(this),ct=(function(t,e,o,i){o=n.isArray(o)?o:[o];var r=G(t);i=i||"default";for(var s=0;s<o.length;s++){var a=this[o[s]][r];a&&a[i]&&(a[i].def.scope=e)}}).bind(this);this.getScope=function(t,e){return lt(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(t){return lt(t,"sourceEndpointDefinitions")},this.getTargetScope=function(t){return lt(t,"targetEndpointDefinitions")},this.setScope=function(t,e,n){this.setSourceScope(t,e,n),this.setTargetScope(t,e,n)},this.setSourceScope=function(t,e,n){ct(t,e,"sourceEndpointDefinitions",n),this.setDragScope(t,e)},this.setTargetScope=function(t,e,n){ct(t,e,"targetEndpointDefinitions",n),this.setDropScope(t,e)},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)i.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var ut=(function(t,e,o,r,s){var a,l,c,u="source"===t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(s=s||"default",e.length&&!n.isString(e)){a=[];for(var h=0,p=e.length;h<p;h++)u[(l=d(e[h])).id]&&u[l.id][s]&&(a[h]=u[l.id][s].enabled,u[l.id][s].enabled=c=r?!a[h]:o,i[c?"removeClass":"addClass"](l.el,"jtk-"+t+"-disabled"))}else{var f=(l=d(e)).id;u[f]&&u[f][s]&&(a=u[f][s].enabled,u[f][s].enabled=c=r?!a:o,i[c?"removeClass":"addClass"](l.el,"jtk-"+t+"-disabled"))}return a}).bind(this),ht=(function(t,e){return n.isString(t)||!t.length?e.apply(this,[t]):t.length?e.apply(this,[t[0]]):void 0}).bind(this);this.toggleSourceEnabled=function(t,e){return ut("source",t,null,!0,e),this.isSourceEnabled(t,e)},this.setSourceEnabled=function(t,e,n){return ut("source",t,e,null,n)},this.isSource=function(t,e){return e=e||"default",ht(t,(function(t){var n=this.sourceEndpointDefinitions[d(t).id];return null!=n&&null!=n[e]}).bind(this))},this.isSourceEnabled=function(t,e){return e=e||"default",ht(t,(function(t){var n=this.sourceEndpointDefinitions[d(t).id];return n&&n[e]&&!0===n[e].enabled}).bind(this))},this.toggleTargetEnabled=function(t,e){return ut("target",t,null,!0,e),this.isTargetEnabled(t,e)},this.isTarget=function(t,e){return e=e||"default",ht(t,(function(t){var n=this.targetEndpointDefinitions[d(t).id];return null!=n&&null!=n[e]}).bind(this))},this.isTargetEnabled=function(t,e){return e=e||"default",ht(t,(function(t){var n=this.targetEndpointDefinitions[d(t).id];return n&&n[e]&&!0===n[e].enabled}).bind(this))},this.setTargetEnabled=function(t,e,n){return ut("target",t,e,null,n)},this.ready=function(t){i.bind("ready",t)};var dt=function(t,e){if("object"==typeof t&&t.length)for(var n=0,o=t.length;n<o;n++)e(t[n]);else e(t);return i};this.repaint=function(t,e,n){return dt(t,(function(t){A(t,e,n)}))},this.revalidate=function(t,e,n){return dt(t,(function(t){var o=n?t:i.getId(t);i.updateOffset({elId:o,recalc:!0,timestamp:e});var r=i.getDragManager();r&&r.updateOffsets(o),i.repaint(t)}))},this.repaintEverything=function(){var t,e=o();for(t in P)i.updateOffset({elId:t,recalc:!0,timestamp:e});for(t in P)A(t,null,e);return this},this.removeAllEndpoints=function(t,e,n){n=n||[];var o=function(t){var r,s,a=d(t),l=P[a.id];if(l)for(n.push(a),r=0,s=l.length;r<s;r++)i.deleteEndpoint(l[r],!1);if(delete P[a.id],e&&a.el&&3!==a.el.nodeType&&8!==a.el.nodeType)for(r=0,s=a.el.childNodes.length;r<s;r++)o(a.el.childNodes[r])};return o(t),this};var pt=function(t,e){i.removeAllEndpoints(t.id,!0,e);for(var n=i.getDragManager(),o=function(t){n&&n.elementRemoved(t.id),i.router.elementRemoved(t.id),i.isSource(t.el)&&i.unmakeSource(t.el),i.isTarget(t.el)&&i.unmakeTarget(t.el),i.destroyDraggable(t.el),i.destroyDroppable(t.el),delete i.floatingConnections[t.id],delete x[t.id],delete _[t.id],t.el&&(i.removeElement(t.el),t.el._jsPlumb=null)},r=1;r<e.length;r++)o(e[r]);o(t)};this.remove=function(t,e){var n=d(t),o=[];return n.text&&n.el.parentNode?n.el.parentNode.removeChild(n.el):n.id&&i.batch((function(){pt(n,o)}),!0===e),i},this.empty=function(t,e){var n=[],o=function(t,e){var i=d(t);if(i.text)i.el.parentNode.removeChild(i.el);else if(i.el){for(;i.el.childNodes.length>0;)o(i.el.childNodes[0]);e||pt(i,n)}};return i.batch((function(){o(t,!0)}),!1===e),i},this.reset=function(t){i.silently((function(){ot=!1,i.removeAllGroups(),i.removeGroupManager(),i.deleteEveryEndpoint(),t||i.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},y.length=0,this.doReset&&this.doReset()}).bind(this))};var ft=function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),t.cleanup(),t.destroy()};this.clear=function(){i.select().each(ft),i.selectEndpoints().each(ft),P={},C={}},this.setDefaultScope=function(t){return k=t,i},this.deriveEndpointAndAnchorSpec=function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),o=null,r=null,s=null,a=null,l=0;l<n.length;l++){var c=i.getType(n[l],"connection");c&&(c.endpoints&&(o=c.endpoints),c.endpoint&&(r=c.endpoint),c.anchors&&(a=c.anchors),c.anchor&&(s=c.anchor))}return{endpoints:o||[r,r],anchors:a||[s,s]}},this.setId=function(t,e,o){var i;n.isString(t)?i=t:(t=this.getElement(t),i=this.getId(t));var r=this.getConnections({source:i,scope:"*"},!0),s=this.getConnections({target:i,scope:"*"},!0);e=""+e,o?t=this.getElement(e):(t=this.getElement(i),this.setAttribute(t,"id",e)),P[e]=P[i]||[];for(var a=0,l=P[e].length;a<l;a++)P[e][a].setElementId(e),P[e][a].setReferenceElement(t);delete P[i],this.sourceEndpointDefinitions[e]=this.sourceEndpointDefinitions[i],delete this.sourceEndpointDefinitions[i],this.targetEndpointDefinitions[e]=this.targetEndpointDefinitions[i],delete this.targetEndpointDefinitions[i],this.router.changeId(i,e);var c=this.getDragManager();c&&c.changeId(i,e),x[e]=x[i],delete x[i];var u=function(n,o,i){for(var r=0,s=n.length;r<s;r++)n[r].endpoints[o].setElementId(e),n[r].endpoints[o].setReferenceElement(t),n[r][i+"Id"]=e,n[r][i]=t};u(r,0,"source"),u(s,1,"target"),this.repaint(e)},this.setDebugLog=function(t){v=t},this.setSuspendDrawing=function(t,e){var n=j;return j=t,D=t?(new Date).getTime():null,e&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return j},this.getSuspendedAt=function(){return D},this.batch=function(t,e){var o=this.isSuspendDrawing();o||this.setSuspendDrawing(!0);try{t()}catch(i){n.log("Function run while suspended failed",i)}o||this.setSuspendDrawing(!1,!e)},this.doWhileSuspended=this.batch,this.getCachedData=function(t){var e=_[t];return e?{o:e,s:E[t]}:st({elId:t})},this.timestamp=o,this.show=function(t,e){return U(t,"block",e),i},this.toggleVisible=function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),H(t,(function(t){var e=t.isVisible();t.setVisible(!e)}),n)},this.addListener=this.bind;var gt=[];this.registerFloatingConnection=function(t,e,o){gt[t.id]=e,n.addToList(P,t.id,o)},this.getFloatingConnectionFor=function(t){return gt[t]},this.listManager=new t.jsPlumbListManager(this,this.Defaults.ListStyle)};n.extend(t.jsPlumbInstance,n.EventGenerator,{setAttribute:function(t,e,n){this.setAttribute(t,e,n)},getAttribute:function(e,n){return this.getAttribute(t.jsPlumb.getElement(e),n)},convertToFullOverlaySpec:function(t){return n.isString(t)&&(t=[t,{}]),t[1].id=t[1].id||n.uuid(),t},registerConnectionType:function(e,n){if(this._connectionTypes[e]=t.jsPlumb.extend({},n),n.overlays){for(var o={},i=0;i<n.overlays.length;i++){var r=this.convertToFullOverlaySpec(n.overlays[i]);o[r[1].id]=r}this._connectionTypes[e].overlays=o}},registerConnectionTypes:function(t){for(var e in t)this.registerConnectionType(e,t[e])},registerEndpointType:function(e,n){if(this._endpointTypes[e]=t.jsPlumb.extend({},n),n.overlays){for(var o={},i=0;i<n.overlays.length;i++){var r=this.convertToFullOverlaySpec(n.overlays[i]);o[r[1].id]=r}this._endpointTypes[e].overlays=o}},registerEndpointTypes:function(t){for(var e in t)this.registerEndpointType(e,t[e])},getType:function(t,e){return"connection"===e?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,e){this.setId(t,e,!0)},setParent:function(t,e){var n=this.getElement(t),o=this.getId(n),i=this.getElement(e),r=this.getId(i),s=this.getDragManager();n.parentNode.removeChild(n),i.appendChild(n),s&&s.setParent(n,o,i,r)},extend:function(t,e,n){var o;if(n)for(o=0;o<n.length;o++)t[n[o]]=e[n[o]];else for(o in e)t[o]=e[o];return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,e,n,o,i,r){var s,a=t.endpoints[e].elementId,l=t.endpoints[e];t.proxies=t.proxies||[],(s=t.proxies[e]?t.proxies[e].ep:this.addEndpoint(n,{endpoint:i(t,e),anchor:r(t,e),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),t.proxies[e]={ep:s,originalEp:l},this.router.sourceOrTargetChanged(a,o,t,n,0===e?0:1),l.detachFromConnection(t,null,!0),s.connections=[t],t.endpoints[e]=s,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)},unproxyConnection:function(t,e,n){if(null!=t._jsPlumb&&null!=t.proxies&&null!=t.proxies[e]){var o=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId;t.endpoints[e]=t.proxies[e].originalEp,this.router.sourceOrTargetChanged(n,i,t,o,0===e?0:1),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),delete t.proxies[e]}}});var p=new d;t.jsPlumb=p,p.getInstance=function(t,e){var n=new d(t);if(e)for(var o in e)n[o]=e[o];return n.init(),n},p.each=function(t,e){if(null!=t)if("string"==typeof t)e(p.getElement(t));else if(null!=t.length)for(var n=0;n<t.length;n++)e(p.getElement(t[n]));else e(t)},e.jsPlumb=p}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil;e.OverlayCapableJsPlumbUIComponent=function(e){t.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},e.label&&(this.getDefaultType().overlays.__label=["Label",{label:e.label,location:e.labelLocation||this.defaultLabelLocation||.5,labelStyle:e.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:"__label"}]),this.setListenerComponent=function(t){if(this._jsPlumb)for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].setListenerComponent(t)}},e.OverlayCapableJsPlumbUIComponent.applyType=function(t,e){if(e.overlays){var n,o={};for(n in e.overlays){var i=t._jsPlumb.overlays[e.overlays[n][1].id];if(i)i.updateFrom(e.overlays[n][1]),o[e.overlays[n][1].id]=!0,i.reattach(t._jsPlumb.instance,t);else{var r=t.getCachedTypeItem("overlay",e.overlays[n][1].id);null!=r?(r.reattach(t._jsPlumb.instance,t),r.setVisible(!0),r.updateFrom(e.overlays[n][1]),t._jsPlumb.overlays[r.id]=r):r=t.addOverlay(e.overlays[n],!0),o[r.id]=!0}}for(n in t._jsPlumb.overlays)null==o[t._jsPlumb.overlays[n].id]&&t.removeOverlay(t._jsPlumb.overlays[n].id,!0)}},n.extend(e.OverlayCapableJsPlumbUIComponent,t.jsPlumbUIComponent,{setHover:function(t,e){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var n in this._jsPlumb.overlays)this._jsPlumb.overlays[n][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,o){var i=function(t,o){var i=null;if(n.isArray(o)){var r=o[0],s=e.extend({component:t,_jsPlumb:t._jsPlumb.instance},o[1]);3===o.length&&e.extend(s,o[2]),i=new(e.Overlays[t._jsPlumb.instance.getRenderMode()][r])(s)}else i=o.constructor===String?new(e.Overlays[t._jsPlumb.instance.getRenderMode()][o])({component:t,_jsPlumb:t._jsPlumb.instance}):o;return i.id=i.id||n.uuid(),t.cacheTypeItem("overlay",i,i.id),t._jsPlumb.overlays[i.id]=i,i}(this,t);if(this.getData&&"Label"===i.type&&n.isArray(t)){var r=this.getData();if(r){var s=r?r[t[1].labelLocationAttribute||"labelLocation"]:null;s&&(i.loc=s)}}return o||this.repaint(),i},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var e=this.getOverlay(t);e&&e.hide()},hideOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var e=this.getOverlay(t);e&&e.show()},showOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup&&this._jsPlumb.overlays[e].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},t||this.repaint()},removeOverlay:function(t,e){var n=this._jsPlumb.overlays[t];n&&(n.setVisible(!1),!e&&n.cleanup&&n.cleanup(),delete this._jsPlumb.overlays[t],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[t])},removeOverlays:function(){for(var t=0,e=arguments.length;t<e;t++)this.removeOverlay(arguments[t])},moveParent:function(t){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var e in this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[e].isAppendedAtTopLevel){var n=this._jsPlumb.overlays[e].getElement();n.parentNode.removeChild(n),t.appendChild(n)}},getLabel:function(){var t=this.getOverlay("__label");return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay("__label")},setLabel:function(t){var n,o,i=this.getOverlay("__label");i?t.constructor===String||t.constructor===Function?i.setLabel(t):(t.label&&i.setLabel(t.label),t.location&&i.setLocation(t.location)):(this,o=e.extend({cssClass:(n=t.constructor===String||t.constructor===Function?{label:t}:t).cssClass,labelStyle:this.labelStyle,id:"__label",component:this,_jsPlumb:this._jsPlumb.instance},n),i=new(e.Overlays[this._jsPlumb.instance.getRenderMode()].Label)(o),this._jsPlumb.overlays.__label=i),this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup(t),this._jsPlumb.overlays[e].destroy(t);t&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,e){this._jsPlumb.overlayPositions[t.id]=e},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,e,n){if(!n)for(var o in this._jsPlumb.overlays)this._jsPlumb.overlays[o][t+"Class"](e)},addClass:function(t,e){this._clazzManip("add",t,e)},removeClass:function(t,e){this._clazzManip("remove",t,e)}})}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n=function(t,e,n){var o=!1;return{drag:function(){if(o)return o=!1,!0;if(e.element){var i=n.getUIPosition(arguments,n.getZoom());null!=i&&n.setPosition(e.element,i),n.repaint(e.element,i),t.paint({anchorPoint:t.anchor.getCurrentLocation({element:t})})}},stopDrag:function(){o=!0}}},o=function(t,e,n,o){var i=e.createElement("div",{position:"absolute"});e.appendElement(i);var r=e.getId(i);e.setPosition(i,n),i.style.width=o[0]+"px",i.style.height=o[1]+"px",e.manage(r,i,!0),t.id=r,t.element=i},i=function(e,n,o,i,r,s,a,l){return a({paintStyle:e,endpoint:o,anchor:new t.FloatingAnchor({reference:n,referenceCanvas:i,jsPlumbInstance:s}),source:r,scope:l})},r=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],s=function(t,e){var n=0;if(null!=e)for(var o=0;o<t.connections.length;o++)if(t.connections[o].sourceId===e||t.connections[o].targetId===e){n=o;break}return t.connections[n]};t.Endpoint=function(a){var l=a._jsPlumb,c=a.newConnection,u=a.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],t.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:a.connectionType,maxConnections:null==a.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:a.maxConnections,paintStyle:a.endpointStyle||a.paintStyle||a.style||this._jsPlumb.instance.Defaults.EndpointStyle||t.Defaults.EndpointStyle,hoverPaintStyle:a.endpointHoverStyle||a.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||t.Defaults.EndpointHoverStyle,connectorStyle:a.connectorStyle,connectorHoverStyle:a.connectorHoverStyle,connectorClass:a.connectorClass,connectorHoverClass:a.connectorHoverClass,connectorOverlays:a.connectorOverlays,connector:a.connector,connectorTooltip:a.connectorTooltip}),this._jsPlumb.enabled=!(!1===a.enabled),this._jsPlumb.visible=!0,this.element=t.getElement(a.source),this._jsPlumb.uuid=a.uuid,this._jsPlumb.floatingEndpoint=null;var h=null;this._jsPlumb.uuid&&(a.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=a.elementId,this.dragProxy=a.dragProxy,this._jsPlumb.connectionCost=a.connectionCost,this._jsPlumb.connectionsDirected=a.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var d=!0===a.deleteOnEmpty;this.setDeleteOnEmpty=function(t){d=t};var p=(function(){var e=l.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var n=l.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(e),this.addClass(n),t.updateClasses(this.element,n,e)}).bind(this);this.prepareAnchor=function(t){var e=this._jsPlumb.instance.makeAnchor(t,this.elementId,l);return e.bind("anchorChanged",(function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),p()}).bind(this)),e},this.setPreparedAnchor=function(t,e){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=t,p(),e||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(t,e){var n=this.prepareAnchor(t);return this.setPreparedAnchor(n,e),this};var f=(function(t){if(this.connections.length>0)for(var e=0;e<this.connections.length;e++)this.connections[e].setHover(t,!1);else this.setHover(t)}).bind(this);this.bind("mouseover",(function(){f(!0)})),this.bind("mouseout",(function(){f(!1)})),a._transient||this._jsPlumb.instance.anchorManager.add(this,this.elementId),this.prepareEndpoint=function(n,o){var i,r=function(e,n){var o=l.getRenderMode();if(t.Endpoints[o][e])return new t.Endpoints[o][e](n);if(!l.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+e+"'"}},s={_jsPlumb:this._jsPlumb.instance,cssClass:a.cssClass,container:a.container,tooltip:a.tooltip,connectorTooltip:a.connectorTooltip,endpoint:this};return e.isString(n)?i=r(n,s):e.isArray(n)?(s=e.merge(n[1],s),i=r(n[0],s)):i=n.clone(),i.clone=(function(){return e.isString(n)?r(n,s):e.isArray(n)?(s=e.merge(n[1],s),r(n[0],s)):void 0}).bind(this),i.typeId=o,i},this.setEndpoint=function(t,e){var n=this.prepareEndpoint(t);this.setPreparedEndpoint(n,!0)},this.setPreparedEndpoint=function(t,e){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=t,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},t.extend(this,a,r),this.isSource=a.isSource||!1,this.isTemporarySource=a.isTemporarySource||!1,this.isTarget=a.isTarget||!1,this.connections=a.connections||[],this.connectorPointerEvents=a["connector-pointer-events"],this.scope=a.scope||l.getDefaultScope(),this.timestamp=null,this.reattachConnections=a.reattach||l.Defaults.ReattachConnections,this.connectionsDetachable=l.Defaults.ConnectionsDetachable,!1!==a.connectionsDetachable&&!1!==a.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==a.dragAllowedWhenFull,a.onMaxConnections&&this.bind("maxConnections",a.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(this.connections.length>0?"add":"remove")+"Class"](l.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](l.endpointFullClass)},this.detachFromConnection=function(t,e,n){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this[(this.connections.length>0?"add":"remove")+"Class"](l.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](l.endpointFullClass)),!n&&d&&0===this.connections.length&&l.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==n})},this.deleteEveryConnection=function(t){for(var e=this.connections.length,n=0;n<e;n++)l.deleteConnection(this.connections[0],t)},this.detachFrom=function(t,e,n){for(var o=[],i=0;i<this.connections.length;i++)this.connections[i].endpoints[1]!==t&&this.connections[i].endpoints[0]!==t||o.push(this.connections[i]);for(var r=0,s=o.length;r<s;r++)l.deleteConnection(o[0]);return this},this.getElement=function(){return this.element},this.setElement=function(n){var o=this._jsPlumb.instance.getId(n),i=this.elementId;return e.removeWithFunction(a.endpointsByElement[this.elementId],(function(t){return t.id===this.id}).bind(this)),this.element=t.getElement(n),this.elementId=l.getId(this.element),l.anchorManager.rehomeEndpoint(this,i,this.element),l.dragManager.endpointAdded(this.element),e.addToList(a.endpointsByElement,o,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),e=this.anchor.getOrientation(this),n=this.anchor.getCssClass();return u({dropOptions:a.dropOptions,anchor:{bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return e},getCssClass:function(){return n}},source:this.element,paintStyle:this.getPaintStyle(),endpoint:a.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(t){var e=(t=t||{}).timestamp,n=!(!1===t.recalc);if(!e||this.timestamp!==e){var o=l.updateOffset({elId:this.elementId,timestamp:e}),i=t.offset?t.offset.o:o.o;if(null!=i){var r=t.anchorPoint,a=t.connectorPaintStyle;if(null==r){var c={xy:[i.left,i.top],wh:t.dimensions||o.s,element:this,timestamp:e};if(n&&this.anchor.isDynamic&&this.connections.length>0){var u=s(this,t.elementWithPrecedence),h=u.endpoints[0]===this?1:0,d=l.getCachedData(0===h?u.sourceId:u.targetId),p=d.o,f=d.s;c.index=0===h?1:0,c.connection=u,c.txy=[p.left,p.top],c.twh=f,c.tElement=u.endpoints[h]}else this.connections.length>0&&(c.connection=this.connections[0]);r=this.anchor.compute(c)}for(var g in this.endpoint.compute(r,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,a||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=e,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(g)){var m=this._jsPlumb.overlays[g];m.isVisible()&&(this._jsPlumb.overlayPlacements[g]=m.draw(this.endpoint,this._jsPlumb.paintStyleInUse),m.paint(this._jsPlumb.overlayPlacements[g]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var g=!1;this.initDraggable=function(){if(!g&&t.isDragSupported(this.element)){var r,s={id:null,element:null},d=null,p=!1,f=null,m=n(this,s,l),v=a.dragOptions||{},b=t.dragEvents.start,y=t.dragEvents.stop,P=t.dragEvents.drag,C=t.dragEvents.beforeStart,x=(function(e){d=this.connectorSelector();var n=!0;this.isEnabled()||(n=!1),null!=d||this.isSource||this.isTemporarySource||(n=!1),!this.isSource||!this.isFull()||null!=d&&this.dragAllowedWhenFull||(n=!1),null==d||d.isDetachable(this)||(this.isFull()?n=!1:d=null);var h=l.checkCondition(null==d?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:d});if(!1===h?n=!1:"object"==typeof h?t.extend(h,r||{}):h=r||{},!1===n)return l.stopDrag&&l.stopDrag(this.canvas),m.stopDrag(),!1;for(var g=0;g<this.connections.length;g++)this.connections[g].setHover(!1);this.addClass("endpointDrag"),l.setConnectionBeingDragged(!0),d&&!this.isFull()&&this.isSource&&(d=null),l.updateOffset({elId:this.elementId});var v=this._jsPlumb.instance.getOffset(this.canvas),b=this.canvas,y=this._jsPlumb.instance.getSize(this.canvas);o(s,l,v,y),l.setAttributes(this.canvas,{dragId:s.id,elId:this.elementId});var P=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var C=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);C.endpoints[1]&&(P=C.endpoints[1])}var x=this._jsPlumb.instance.makeAnchor("Center");x.isFloating=!0,this._jsPlumb.floatingEndpoint=i(this.getPaintStyle(),x,P,this.canvas,s.element,l,u,this.scope);var _=this._jsPlumb.floatingEndpoint.anchor;if(null==d)this.setHover(!1,!1),(d=c({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:s.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:a.connectorStyle,hoverPaintStyle:a.connectorHoverStyle,connector:a.connector,overlays:a.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:a.scope,data:h})).pending=!0,d.addClass(l.draggingClass),this._jsPlumb.floatingEndpoint.addClass(l.draggingClass),this._jsPlumb.floatingEndpoint.anchor=_,l.fire("connectionDrag",d),l.router.newConnection(d);else{p=!0,d.setHover(!1);var S=d.endpoints[0].id===this.id?0:1;this.detachFromConnection(d,null,!0);var w=l.getDragScope(b);l.setAttribute(this.canvas,"originalScope",w),l.fire("connectionDrag",d),0===S?(f=[d.source,d.sourceId,b,w],l.router.sourceOrTargetChanged(d.endpoints[S].elementId,s.id,d,s.element,0)):(f=[d.target,d.targetId,b,w],l.router.sourceOrTargetChanged(d.endpoints[S].elementId,s.id,d,s.element,1)),d.suspendedEndpoint=d.endpoints[S],d.suspendedElement=d.endpoints[S].getElement(),d.suspendedElementId=d.endpoints[S].elementId,d.suspendedElementType=0===S?"source":"target",d.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=d.suspendedEndpoint,d.endpoints[S]=this._jsPlumb.floatingEndpoint,d.addClass(l.draggingClass),this._jsPlumb.floatingEndpoint.addClass(l.draggingClass)}l.registerFloatingConnection(s,d,this._jsPlumb.floatingEndpoint),l.currentlyDragging=!0}).bind(this),_=(function(){if(l.setConnectionBeingDragged(!1),d&&null!=d.endpoints){var t=l.getDropEvent(arguments),e=l.getFloatingAnchorIndex(d);if(d.endpoints[0===e?1:0].anchor.unlock(),d.removeClass(l.draggingClass),this._jsPlumb&&(d.deleteConnectionNow||d.endpoints[e]===this._jsPlumb.floatingEndpoint)&&p&&d.suspendedEndpoint){0===e?(d.floatingElement=d.source,d.floatingId=d.sourceId,d.floatingEndpoint=d.endpoints[0],d.floatingIndex=0,d.source=f[0],d.sourceId=f[1]):(d.floatingElement=d.target,d.floatingId=d.targetId,d.floatingEndpoint=d.endpoints[1],d.floatingIndex=1,d.target=f[0],d.targetId=f[1]);var n=this._jsPlumb.floatingEndpoint;l.setDragScope(f[2],f[3]),d.endpoints[e]=d.suspendedEndpoint,d.isReattach()||d._forceReattach||d._forceDetach||!l.deleteConnection(d,{originalEvent:t})?(d.setHover(!1),d._forceDetach=null,d._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(d),d.suspendedEndpoint.addConnection(d),1===e?l.router.sourceOrTargetChanged(d.floatingId,d.targetId,d,d.target,e):l.router.sourceOrTargetChanged(d.floatingId,d.sourceId,d,d.source,e),l.repaint(f[1])):l.deleteObject({endpoint:n})}this.deleteAfterDragStop?l.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),l.fire("connectionDragStop",d,t),d.pending&&l.fire("connectionAborted",d,t),l.currentlyDragging=!1,d.suspendedElement=null,d.suspendedEndpoint=null,d=null}s&&s.element&&l.remove(s.element,!1,!1),h&&l.deleteObject({endpoint:h}),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.unlock(),this._jsPlumb.floatingEndpoint=null)}).bind(this);(v=t.extend({},v)).scope=this.scope||v.scope,v[C]=e.wrap(v[C],(function(t){r=t.e.payload||{}}),!1),v[b]=e.wrap(v[b],x,!1),v[P]=e.wrap(v[P],m.drag),v[y]=e.wrap(v[y],_),v.multipleDrop=!1,v.canDrag=(function(){return this.isSource||this.isTemporarySource||this.connections.length>0&&!1!==this.connectionsDetachable}).bind(this),l.initDraggable(this.canvas,v,"internal"),this.canvas._jsPlumbRelatedElement=this.element,g=!0}};var m=a.endpoint||this._jsPlumb.instance.Defaults.Endpoint||t.Defaults.Endpoint;this.setEndpoint(m,!0);var v=a.anchor?a.anchor:a.anchors?a.anchors:l.Defaults.Anchor||"Top";this.setAnchor(v,!0);var b=["default",a.type||""].join(" ");this.addType(b,a.data,!0),this.canvas=this.endpoint.canvas,this.canvas._jsPlumb=this,this.initDraggable();var y=(function(n,o,i,r){if(t.isDropSupported(this.element)){var s=a.dropOptions||l.Defaults.DropOptions||t.Defaults.DropOptions;(s=t.extend({},s)).scope=s.scope||this.scope;var c=t.dragEvents.drop,u=t.dragEvents.over,h=t.dragEvents.out,d=this,p=l.EndpointDropHandler({getEndpoint:function(){return d},jsPlumb:l,enabled:function(){return null==i||i.isEnabled()},isFull:function(){return i.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){d.addClass(t)},removeClass:function(t){d.removeClass(t)},isDropAllowed:function(){return d.isDropAllowed.apply(d,arguments)},reference:r,isRedrop:function(t,e){return t.suspendedEndpoint&&e.reference&&t.suspendedEndpoint.id===e.reference.id}});s[c]=e.wrap(s[c],p,!0),s[u]=e.wrap(s[u],(function(){var e=t.getDragObject(arguments),n=l.getAttribute(t.getElement(e),"dragId"),o=l.getFloatingConnectionFor(n);if(null!=o){var i=l.getFloatingAnchorIndex(o),r=this.isTarget&&0!==i||o.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===o.suspendedEndpoint.id;if(r){var s=l.checkCondition("checkDropAllowed",{sourceEndpoint:o.endpoints[i],targetEndpoint:this,connection:o});this[(s?"add":"remove")+"Class"](l.endpointDropAllowedClass),this[(s?"remove":"add")+"Class"](l.endpointDropForbiddenClass),o.endpoints[i].anchor.over(this.anchor,this)}}}).bind(this)),s[h]=e.wrap(s[h],(function(){var e=t.getDragObject(arguments),n=null==e?null:l.getAttribute(t.getElement(e),"dragId"),o=n?l.getFloatingConnectionFor(n):null;if(null!=o){var i=l.getFloatingAnchorIndex(o),r=this.isTarget&&0!==i||o.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===o.suspendedEndpoint.id;r&&(this.removeClass(l.endpointDropAllowedClass),this.removeClass(l.endpointDropForbiddenClass),o.endpoints[i].anchor.out())}}).bind(this)),l.initDroppable(n,s,"internal",o)}}).bind(this);return this.anchor.isFloating||y(this.canvas,!(a._transient||this.anchor.isFloating),this,a.reference),this},e.extend(t.Endpoint,t.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,e,n){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!e)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(t),!n){var i=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[i].connections.length&&this.connections[o].endpoints[i].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(e,n){this.setPaintStyle(e.endpointStyle||e.paintStyle,n),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle,n),null!=e.maxConnections&&(this._jsPlumb.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),t.extend(this,e,r),null!=e.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,e.cssClass),t.OverlayCapableJsPlumbUIComponent.applyType(this,e)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){t.removeClass(this.element,this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"")),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(e){this.element=t.getElement(e)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(t){return function(n){var o=t.jsPlumb;t.removeClass(o.endpointDropAllowedClass),t.removeClass(o.endpointDropForbiddenClass);var i=o.getDropEvent(arguments),r=o.getDragObject(arguments),s=o.getAttribute(r,"dragId"),a=(o.getAttribute(r,"elId"),o.getAttribute(r,"originalScope")),l=o.getFloatingConnectionFor(s);if(null!=l){var c=null!=l.suspendedEndpoint;if(!c||null!=l.suspendedEndpoint._jsPlumb){var u=t.getEndpoint(l);if(null!=u){if(t.isRedrop(l,t))return l._forceReattach=!0,l.setHover(!1),void(t.maybeCleanup&&t.maybeCleanup(u));var h=o.getFloatingAnchorIndex(l);if(0===h&&!t.isSource||1===h&&!t.isTarget)t.maybeCleanup&&t.maybeCleanup(u);else{t.onDrop&&t.onDrop(l),a&&o.setDragScope(r,a);var d=t.isFull(n);if(d&&u.fire("maxConnections",{endpoint:this,connection:l,maxConnections:u._jsPlumb.maxConnections},i),!d&&t.enabled()){var p=!0;0===h?(l.floatingElement=l.source,l.floatingId=l.sourceId,l.floatingEndpoint=l.endpoints[0],l.floatingIndex=0,l.source=t.element,l.sourceId=o.getId(t.element)):(l.floatingElement=l.target,l.floatingId=l.targetId,l.floatingEndpoint=l.endpoints[1],l.floatingIndex=1,l.target=t.element,l.targetId=o.getId(t.element)),c&&l.suspendedEndpoint.id!==u.id&&(l.isDetachAllowed(l)&&l.endpoints[h].isDetachAllowed(l)&&l.suspendedEndpoint.isDetachAllowed(l)&&o.checkCondition("beforeDetach",l)||(p=!1));var f=(function(n){l.endpoints[h].detachFromConnection(l),l.suspendedEndpoint&&l.suspendedEndpoint.detachFromConnection(l),l.endpoints[h]=u,u.addConnection(l);var r=u.getParameters();for(var s in r)l.setParameter(s,r[s]);if(c){var a=l.suspendedEndpoint.elementId;o.fireMoveEvent({index:h,originalSourceId:0===h?a:l.sourceId,newSourceId:0===h?u.elementId:l.sourceId,originalTargetId:1===h?a:l.targetId,newTargetId:1===h?u.elementId:l.targetId,originalSourceEndpoint:0===h?l.suspendedEndpoint:l.endpoints[0],newSourceEndpoint:0===h?u:l.endpoints[0],originalTargetEndpoint:1===h?l.suspendedEndpoint:l.endpoints[1],newTargetEndpoint:1===h?u:l.endpoints[1],connection:l},i)}else r.draggable&&o.initDraggable(this.element,t.dragOptions,"internal",o);1===h?o.router.sourceOrTargetChanged(l.floatingId,l.targetId,l,l.target,1):o.router.sourceOrTargetChanged(l.floatingId,l.sourceId,l,l.source,0),l.endpoints[0].finalEndpoint&&(l.endpoints[0].detachFromConnection(l),l.endpoints[0]=l.endpoints[0].finalEndpoint,l.endpoints[0].addConnection(l)),e.isObject(n)&&l.mergeData(n),o.finaliseConnection(l,null,i,!1),l.setHover(!1),o.revalidate(l.endpoints[0].element)}).bind(this),g=function(){l.suspendedEndpoint&&(l.endpoints[h]=l.suspendedEndpoint,l.setHover(!1),l._forceDetach=!0,0===h?(l.source=l.suspendedEndpoint.element,l.sourceId=l.suspendedEndpoint.elementId):(l.target=l.suspendedEndpoint.element,l.targetId=l.suspendedEndpoint.elementId),l.suspendedEndpoint.addConnection(l),1===h?o.router.sourceOrTargetChanged(l.floatingId,l.targetId,l,l.target,1):o.router.sourceOrTargetChanged(l.floatingId,l.sourceId,l,l.source,0),o.repaint(l.sourceId),l._forceDetach=!1)};if(p=p&&t.isDropAllowed(l.sourceId,l.targetId,l.scope,l,u))return f(p),!0;g()}t.maybeCleanup&&t.maybeCleanup(u),o.currentlyDragging=!1}}}}}}}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,o=function(t,o,i,r,s){if(e.Connectors[o]=e.Connectors[o]||{},null==e.Connectors[o][i]){if(null==e.Connectors[i]){if(t.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+i+"'")}e.Connectors[o][i]=function(){e.Connectors[i].apply(this,arguments),e.ConnectorRenderers[o].apply(this,arguments)},n.extend(e.Connectors[o][i],[e.Connectors[i],e.ConnectorRenderers[o]])}return new e.Connectors[o][i](r,s)},i=function(t,e,n){return t?n.makeAnchor(t,e,n):null},r=function(t,e,o,i){null!=e&&(e._jsPlumbConnections=e._jsPlumbConnections||{},i?delete e._jsPlumbConnections[t.id]:e._jsPlumbConnections[t.id]=!0,n.isEmpty(e._jsPlumbConnections)?o.removeClass(e,o.connectedClass):o.addClass(e,o.connectedClass))};e.Connection=function(t){var o=t.newEndpoint;this.id=t.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=t.previousConnection,this.source=e.getElement(t.source),this.target=e.getElement(t.target),e.OverlayCapableJsPlumbUIComponent.apply(this,arguments),t.sourceEndpoint?(this.source=t.sourceEndpoint.getElement(),this.sourceId=t.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),t.targetEndpoint?(this.target=t.targetEndpoint.getElement(),this.targetId=t.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[];var i=this._jsPlumb.instance;i.manage(this.sourceId,this.source),i.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:t.cssClass,container:t.container,"pointer-events":t["pointer-events"],editorParams:t.editorParams,overlays:t.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",(function(){this.setHover(!0)}).bind(this)),this.bind("mouseout",(function(){this.setHover(!1)}).bind(this)),this.makeEndpoint=function(e,n,r,s,a){return r=r||this._jsPlumb.instance.getId(n),this.prepareEndpoint(i,o,this,s,e?0:1,t,n,r,a)},t.type&&(t.endpoints=t.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(t.type).endpoints);var r=this.makeEndpoint(!0,this.source,this.sourceId,t.sourceEndpoint),s=this.makeEndpoint(!1,this.target,this.targetId,t.targetEndpoint);r&&n.addToList(t.endpointsByElement,this.sourceId,r),s&&n.addToList(t.endpointsByElement,this.targetId,s),this.scope||(this.scope=this.endpoints[0].scope),null!=t.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(t.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(t.deleteEndpointsOnEmpty));var a=i.Defaults.ConnectionsDetachable;!1===t.detachable&&(a=!1),!1===this.endpoints[0].connectionsDetachable&&(a=!1),!1===this.endpoints[1].connectionsDetachable&&(a=!1);var l=t.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||i.Defaults.ReattachConnections;this.appendToDefaultType({detachable:a,reattach:l,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||i.Defaults.PaintStyle||e.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||i.Defaults.HoverPaintStyle||e.Defaults.HoverPaintStyle});var c=i.getSuspendedAt();if(!i.isSuspendDrawing()){var u=i.getCachedData(this.sourceId),h=u.o,d=u.s,p=i.getCachedData(this.targetId),f=p.o,g=p.s,m=c||i.timestamp(),v=this.endpoints[0].anchor.compute({xy:[h.left,h.top],wh:d,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[f.left,f.top],twh:g,tElement:this.endpoints[1],timestamp:m});this.endpoints[0].paint({anchorLoc:v,timestamp:m}),v=this.endpoints[1].anchor.compute({xy:[f.left,f.top],wh:g,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[h.left,h.top],twh:d,tElement:this.endpoints[0],timestamp:m}),this.endpoints[1].paint({anchorLoc:v,timestamp:m})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(t){return!1!==this._jsPlumb.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this._jsPlumb.detachable)},this.setDetachable=function(t){this._jsPlumb.detachable=!0===t},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(t){this._jsPlumb.reattach=!0===t},this._jsPlumb.cost=t.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=t.directed,null==t.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var b=e.extend({},this.endpoints[1].getParameters());e.extend(b,this.endpoints[0].getParameters()),e.extend(b,this.getParameters()),this.setParameters(b),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||i.Defaults.Connector||e.Defaults.Connector,!0);var y=null!=t.data&&n.isObject(t.data)?t.data:{};this.getData=function(){return y},this.setData=function(t){y=t||{}},this.mergeData=function(t){y=e.extend(y,t)};var P=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,t.type].join(" ");/[^\s]/.test(P)&&this.addType(P,t.data,!0),this.updateConnectedClass()},n.extend(e.Connection,e.OverlayCapableJsPlumbUIComponent,{applyType:function(t,n,o){var i=null;null!=t.connector&&(null==(i=this.getCachedTypeItem("connector",o.connector))&&(i=this.prepareConnector(t.connector,o.connector),this.cacheTypeItem("connector",i,o.connector)),this.setPreparedConnector(i)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var r=null;t.anchor?null==(r=this.getCachedTypeItem("anchors",o.anchor))&&(r=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",r,o.anchor)):t.anchors&&null==(r=this.getCachedTypeItem("anchors",o.anchors))&&(r=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",r,o.anchors)),null!=r&&(this.endpoints[0].anchor=r[0],this.endpoints[1].anchor=r[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),e.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,e){e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,e){e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,this.target=null,null!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(t){this._jsPlumb&&(r(this,this.source,this._jsPlumb.instance,t),r(this,this.target,this._jsPlumb.instance,t))},setHover:function(e){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(e),t.jsPlumb[e?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),t.jsPlumb[e?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,e){var i,r={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},s=this._jsPlumb.instance.getRenderMode();return n.isString(t)?i=o(this._jsPlumb.instance,s,t,r,this):n.isArray(t)&&(i=o(this._jsPlumb.instance,s,t[0],1===t.length?r:n.merge(t[1],r),this)),null!=e&&(i.typeId=e),i},setPreparedConnector:function(t,e,n,o){if(this.connector!==t){var i,r="";if(null!=this.connector&&(r=(i=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=t,o&&this.cacheTypeItem("connector",t,o),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.connector.reattach(this._jsPlumb.instance),this.addClass(r),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=i)for(var s=this.getOverlays(),a=0;a<s.length;a++)s[a].transfer&&s[a].transfer(this.connector);n||this.setListenerComponent(this.connector),e||this.repaint()}},setConnector:function(t,e,n,o){var i=this.prepareConnector(t,o);this.setPreparedConnector(i,e,n,o)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var e=(t=t||{}).timestamp,n=this.targetId;if(null==e||e!==this._jsPlumb.lastPaintedAt){var o=this._jsPlumb.instance.updateOffset({elId:this.sourceId}).o,i=this._jsPlumb.instance.updateOffset({elId:n}).o,r=this.endpoints[0],s=this.endpoints[1],a=r.anchor.getCurrentLocation({xy:[o.left,o.top],wh:[o.width,o.height],element:r,timestamp:e}),l=s.anchor.getCurrentLocation({xy:[i.left,i.top],wh:[i.width,i.height],element:s,timestamp:e});this.connector.resetBounds(),this.connector.compute({sourcePos:a,targetPos:l,sourceOrientation:r.anchor.getOrientation(r),targetOrientation:s.anchor.getOrientation(s),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:o,targetInfo:i});var c={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var u in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(u)){var h=this._jsPlumb.overlays[u];h.isVisible()&&(this._jsPlumb.overlayPlacements[u]=h.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(h)),c.minX=Math.min(c.minX,this._jsPlumb.overlayPlacements[u].minX),c.maxX=Math.max(c.maxX,this._jsPlumb.overlayPlacements[u].maxX),c.minY=Math.min(c.minY,this._jsPlumb.overlayPlacements[u].minY),c.maxY=Math.max(c.maxY,this._jsPlumb.overlayPlacements[u].maxY))}var d=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,p=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),f={xmin:Math.min(this.connector.bounds.minX-(d+p),c.minX),ymin:Math.min(this.connector.bounds.minY-(d+p),c.minY),xmax:Math.max(this.connector.bounds.maxX+(d+p),c.maxX),ymax:Math.max(this.connector.bounds.maxY+(d+p),c.maxY)};for(var g in this.connector.paintExtents=f,this.connector.paint(this._jsPlumb.paintStyleInUse,null,f),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(g)){var m=this._jsPlumb.overlays[g];m.isVisible()&&m.paint(this._jsPlumb.overlayPlacements[g],f)}}this._jsPlumb.lastPaintedAt=e}},repaint:function(t){var e=jsPlumb.extend(t||{},{});e.elId=this.sourceId,this.paint(e)},prepareEndpoint:function(t,n,o,r,s,a,l,c,u){var h;if(r)o.endpoints[s]=r,r.addConnection(o);else{a.endpoints||(a.endpoints=[null,null]);var d=u||a.endpoints[s]||a.endpoint||t.Defaults.Endpoints[s]||e.Defaults.Endpoints[s]||t.Defaults.Endpoint||e.Defaults.Endpoint;a.endpointStyles||(a.endpointStyles=[null,null]),a.endpointHoverStyles||(a.endpointHoverStyles=[null,null]);var p=a.endpointStyles[s]||a.endpointStyle||t.Defaults.EndpointStyles[s]||e.Defaults.EndpointStyles[s]||t.Defaults.EndpointStyle||e.Defaults.EndpointStyle;null==p.fill&&null!=a.paintStyle&&(p.fill=a.paintStyle.stroke),null==p.outlineStroke&&null!=a.paintStyle&&(p.outlineStroke=a.paintStyle.outlineStroke),null==p.outlineWidth&&null!=a.paintStyle&&(p.outlineWidth=a.paintStyle.outlineWidth);var f=a.endpointHoverStyles[s]||a.endpointHoverStyle||t.Defaults.EndpointHoverStyles[s]||e.Defaults.EndpointHoverStyles[s]||t.Defaults.EndpointHoverStyle||e.Defaults.EndpointHoverStyle;null!=a.hoverPaintStyle&&(null==f&&(f={}),null==f.fill&&(f.fill=a.hoverPaintStyle.stroke));var g=a.anchors?a.anchors[s]:a.anchor?a.anchor:i(t.Defaults.Anchors[s],c,t)||i(e.Defaults.Anchors[s],c,t)||i(t.Defaults.Anchor,c,t)||i(e.Defaults.Anchor,c,t);h=n({paintStyle:p,hoverPaintStyle:f,endpoint:d,connections:[o],uuid:a.uuids?a.uuids[s]:null,anchor:g,source:l,scope:a.scope,reattach:a.reattach||t.Defaults.ReattachConnections,detachable:a.detachable||t.Defaults.ConnectionsDetachable}),null==r&&h.setDeleteOnEmpty(!0),o.endpoints[s]=h,!1===a.drawEndpoints&&h.setVisible(!1,!0,!0)}return h},replaceEndpoint:function(t,e){var n=this.endpoints[t],o=n.elementId,i=this._jsPlumb.instance.getEndpoints(o),r=i.indexOf(n),s=this.makeEndpoint(0===t,n.element,o,null,e);this.endpoints[t]=s,i.splice(r,1,s),this._jsPlumb.instance.deleteObject({endpoint:n,deleteAttachedObjects:!1}),this._jsPlumb.instance.fire("endpointReplaced",{previous:n,current:s}),this._jsPlumb.instance.router.sourceOrTargetChanged(this.endpoints[1].elementId,this.endpoints[1].elementId,this,this.endpoints[1].element,1)}})}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumbUtil,e=this.jsPlumb;e.AnchorManager=function(n){var o={},i={},r={},s={},a=this,l={},c=n.jsPlumbInstance,u={},h=function(t,e){return e[0][0]-t[0][0]},d=function(t,e){return(t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0])-(e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0])},p={top:d,right:h,bottom:h,left:d},f=function(t,e){var n=c.getCachedData(t),o=n.s,s=n.o,a=function(e,n,o,s,a,l,c){if(s.length>0)for(var u=function(t,e,n,o,i,r,s){for(var a=[],l=e[i?0:1]/(o.length+1),c=0;c<o.length;c++){var u=(c+1)*l,h=r*e[i?1:0];s&&(u=e[i?0:1]-u);var d=i?u:h,p=i?h:u;a.push([n[0]+d,n[1]+p,d/e[0],p/e[1],o[c][1],o[c][2]])}return a}(0,n,o,s.sort(p[e]),a,l,"right"===e||"top"===e),h=function(t,e){i[t.id]=[e[0],e[1],e[2],e[3]],r[t.id]=c},d=0;d<u.length;d++){var f=u[d][4],g=f.endpoints[1].elementId===t;f.endpoints[0].elementId===t&&h(f.endpoints[0],u[d]),g&&h(f.endpoints[1],u[d])}};a("bottom",o,[s.left,s.top],e.bottom,!0,1,[0,1]),a("top",o,[s.left,s.top],e.top,!0,0,[0,-1]),a("left",o,[s.left,s.top],e.left,!1,0,[-1,0]),a("right",o,[s.left,s.top],e.right,!1,1,[1,0])};this.reset=function(){o={},s={},l={}},this.addFloatingConnection=function(t,e){u[t]=e},this.newConnection=function(n){var o=n.sourceId,i=n.targetId,r=n.endpoints,a=!0,l=function(l,c,u,h,d){o===i&&u.isContinuous&&(n._jsPlumb.instance.removeElement(r[1].canvas),a=!1),t.addToList(s,h,[d,c,u.constructor===e.DynamicAnchor])};l(0,r[0],r[0].anchor,i,n),a&&l(0,r[1],r[1].anchor,o,n)};var g=function(e){!function(e,n){if(e){var o=function(t){return t[4]===n};t.removeWithFunction(e.top,o),t.removeWithFunction(e.left,o),t.removeWithFunction(e.bottom,o),t.removeWithFunction(e.right,o)}}(l[e.elementId],e.id)};this.connectionDetached=function(e,n){var o=e.connection||e,i=e.targetId,r=function(e,n,o,i,r){t.removeWithFunction(s[i],(function(t){return t[0].id===r.id}))};r(0,0,0,e.sourceId,o),r(0,0,0,i,o),o.floatingId&&(r(0,0,0,o.floatingId,o),g(o.floatingEndpoint)),g(o.endpoints[0]),g(o.endpoints[1]),n||(a.redraw(o.sourceId),o.targetId!==o.sourceId&&a.redraw(o.targetId))},this.add=function(e,n){t.addToList(o,n,e)},this.changeId=function(t,e){s[e]=s[t],o[e]=o[t],delete s[t],delete o[t]},this.getConnectionsFor=function(t){return s[t]||[]},this.getEndpointsFor=function(t){return o[t]||[]},this.deleteEndpoint=function(e){t.removeWithFunction(o[e.elementId],(function(t){return t.id===e.id})),g(e)},this.elementRemoved=function(t){delete u[t],delete o[t],o[t]=[]};var m=function(e,o,i,r,s,a,l,c,u,h,d,p){var f,g,m=-1,v=r.endpoints[l],b=v.id,y=[1,0][l],P=[[o,i],r,s,a,b],C=e[u],x=v._continuousAnchorEdge?e[v._continuousAnchorEdge]:null;if(x){var _=t.findWithFunction(x,(function(t){return t[4]===b}));if(-1!==_)for(x.splice(_,1),f=0;f<x.length;f++)t.addWithFunction(d,g=x[f][1],(function(t){return t.id===g.id})),t.addWithFunction(p,x[f][1].endpoints[l],(function(t){return t.id===g.endpoints[l].id})),t.addWithFunction(p,x[f][1].endpoints[y],(function(t){return t.id===g.endpoints[y].id}))}for(f=0;f<C.length;f++)1===n.idx&&C[f][3]===a&&-1===m&&(m=f),t.addWithFunction(d,g=C[f][1],(function(t){return t.id===g.id})),t.addWithFunction(p,C[f][1].endpoints[l],(function(t){return t.id===g.endpoints[l].id})),t.addWithFunction(p,C[f][1].endpoints[y],(function(t){return t.id===g.endpoints[y].id}));C.splice(c?-1!==m?m:0:C.length,0,P),v._continuousAnchorEdge=u};this.sourceOrTargetChanged=function(n,o,i,r,a){if(0===a){if(n!==o){i.sourceId=o,i.source=r,t.removeWithFunction(s[n],(function(t){return t[0].id===i.id}));var l=t.findWithFunction(s[i.targetId],(function(t){return t[0].id===i.id}));l>-1&&(s[i.targetId][l][0]=i,s[i.targetId][l][1]=i.endpoints[0],s[i.targetId][l][2]=i.endpoints[0].anchor.constructor===e.DynamicAnchor),t.addToList(s,o,[i,i.endpoints[1],i.endpoints[1].anchor.constructor===e.DynamicAnchor]),i.endpoints[1].anchor.isContinuous&&(i.source===i.target?i._jsPlumb.instance.removeElement(i.endpoints[1].canvas):null==i.endpoints[1].canvas.parentNode&&i._jsPlumb.instance.appendElement(i.endpoints[1].canvas)),i.updateConnectedClass()}}else if(1===a){var c=i.endpoints[0].elementId;i.target=r,i.targetId=o;var u=t.findWithFunction(s[c],(function(t){return t[0].id===i.id})),h=t.findWithFunction(s[n],(function(t){return t[0].id===i.id}));-1!==u&&(s[c][u][0]=i,s[c][u][1]=i.endpoints[1],s[c][u][2]=i.endpoints[1].anchor.constructor===e.DynamicAnchor),h>-1&&(s[n].splice(h,1),t.addToList(s,o,[i,i.endpoints[0],i.endpoints[0].anchor.constructor===e.DynamicAnchor])),i.updateConnectedClass()}},this.rehomeEndpoint=function(t,e,n){var i=o[e]||[],r=c.getId(n);if(r!==e){var s=i.indexOf(t);if(s>-1){var l=i.splice(s,1)[0];a.add(l,r)}}for(var u=0;u<t.connections.length;u++)t.connections[u].sourceId===e?a.sourceOrTargetChanged(e,t.elementId,t.connections[u],t.element,0):t.connections[u].targetId===e&&a.sourceOrTargetChanged(e,t.elementId,t.connections[u],t.element,1)},this.redraw=function(n,i,r,a,h,d){if(!c.isSuspendDrawing()){var p=o[n]||[],g=s[n]||[],v=[],b=[],y=[];r=r||c.timestamp(),a=a||{left:0,top:0},i&&(i={left:i.left+a.left,top:i.top+a.top});for(var P=c.updateOffset({elId:n,offset:i,recalc:!1,timestamp:r}),C={},x=0;x<g.length;x++){var _=g[x][0],S=_.sourceId,w=_.targetId,E=_.endpoints[0].anchor.isContinuous,j=_.endpoints[1].anchor.isContinuous;if(E||j){var D=S+"_"+w,k=C[D],I=_.sourceId===n?1:0;E&&!l[S]&&(l[S]={top:[],right:[],bottom:[],left:[]}),j&&!l[w]&&(l[w]={top:[],right:[],bottom:[],left:[]}),n!==w&&c.updateOffset({elId:w,timestamp:r}),n!==S&&c.updateOffset({elId:S,timestamp:r});var O=c.getCachedData(w),T=c.getCachedData(S);w===S&&(E||j)?(m(l[S],-Math.PI/2,0,_,!1,w,0,!1,"top",0,v,b),m(l[w],-Math.PI/2,0,_,!1,S,1,!1,"top",0,v,b)):(k||(k=this.calculateOrientation(S,w,T.o,O.o,_.endpoints[0].anchor,_.endpoints[1].anchor,_),C[D]=k),E&&m(l[S],k.theta,0,_,!1,w,0,!1,k.a[0],0,v,b),j&&m(l[w],k.theta2,-1,_,!0,S,1,!0,k.a[1],0,v,b)),E&&t.addWithFunction(y,S,(function(t){return t===S})),j&&t.addWithFunction(y,w,(function(t){return t===w})),t.addWithFunction(v,_,(function(t){return t.id===_.id})),(E&&0===I||j&&1===I)&&t.addWithFunction(b,_.endpoints[I],(function(t){return t.id===_.endpoints[I].id}))}}for(x=0;x<p.length;x++)0===p[x].connections.length&&p[x].anchor.isContinuous&&(l[n]||(l[n]={top:[],right:[],bottom:[],left:[]}),m(l[n],-Math.PI/2,0,{endpoints:[p[x],p[x]],paint:function(){}},!1,n,0,!1,p[x].anchor.getDefaultFace(),0,v,b),t.addWithFunction(y,n,(function(t){return t===n})));for(x=0;x<y.length;x++)f(y[x],l[y[x]]);for(x=0;x<p.length;x++)p[x].paint({timestamp:r,offset:P,dimensions:P.s,recalc:!0!==d});for(x=0;x<b.length;x++){var A=c.getCachedData(b[x].elementId);b[x].paint({timestamp:null,offset:A,dimensions:A.s})}for(x=0;x<g.length;x++){var M=g[x][1];if(M.anchor.constructor===e.DynamicAnchor){M.paint({elementWithPrecedence:n,timestamp:r}),t.addWithFunction(v,g[x][0],(function(t){return t.id===g[x][0].id}));for(var L=0;L<M.connections.length;L++)M.connections[L]!==g[x][0]&&t.addWithFunction(v,M.connections[L],(function(t){return t.id===M.connections[L].id}))}else t.addWithFunction(v,g[x][0],(function(t){return t.id===g[x][0].id}))}var F=u[n];for(F&&F.paint({timestamp:r,recalc:!1,elId:n}),x=0;x<v.length;x++)v[x].paint({elId:n,timestamp:null,recalc:!1,clearEdits:h})}};var v=function(e){t.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var n=e.faces||["top","right","bottom","left"],o=!(!1===e.clockwise),s={},a={top:"bottom",right:"left",left:"right",bottom:"top"},l={top:"right",right:"bottom",left:"top",bottom:"left"},c={top:"left",right:"top",left:"bottom",bottom:"right"},u=o?l:c,h=o?c:l,d=e.cssClass||"",p=null,f=null,g=["left","right"],m=["top","bottom"],v=null,b=0;b<n.length;b++)s[n[b]]=!0;this.getDefaultFace=function(){return 0===n.length?"top":n[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(t){return s[t]?t:s[a[t]]?a[t]:s[u[t]]?u[t]:s[h[t]]?h[t]:t},this.isEdgeSupported=function(t){return null==v?null==f?!0===s[t]:f===t:-1!==v.indexOf(t)},this.setCurrentFace=function(t,e){p=t,e&&null!=f&&(f=p)},this.getCurrentFace=function(){return p},this.getSupportedFaces=function(){var t=[];for(var e in s)s[e]&&t.push(e);return t},this.lock=function(){f=p},this.unlock=function(){f=null},this.isLocked=function(){return null!=f},this.lockCurrentAxis=function(){null!=p&&(v="left"===p||"right"===p?g:m)},this.unlockCurrentAxis=function(){v=null},this.compute=function(t){return i[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return i[t.element.id]||[0,0]},this.getOrientation=function(t){return r[t.id]||[0,0]},this.getCssClass=function(){return d}};c.continuousAnchorFactory={get:function(t){return new v(t)},clear:function(t){delete i[t]}}},e.AnchorManager.prototype.calculateOrientation=function(t,e,n,o,i,r){var s=["left","top","right","bottom"];if(t===e)return{orientation:"identity",a:["top","top"]};var a=Math.atan2(o.centery-n.centery,o.centerx-n.centerx),l=Math.atan2(n.centery-o.centery,n.centerx-o.centerx),c=[],u={};!function(t,e){for(var n=0;n<t.length;n++)u[t[n]]={left:[e[n].left,e[n].centery],right:[e[n].right,e[n].centery],top:[e[n].centerx,e[n].top],bottom:[e[n].centerx,e[n].bottom]}}(["source","target"],[n,o]);for(var h=0;h<s.length;h++)for(var d=0;d<s.length;d++)c.push({source:s[h],target:s[d],dist:Biltong.lineLength(u.source[s[h]],u.target[s[d]])});c.sort((function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0}));for(var p=c[0].source,f=c[0].target,g=0;g<c.length&&(p=!i.isContinuous||i.isEdgeSupported(c[g].source)?c[g].source:null,f=!r.isContinuous||r.isEdgeSupported(c[g].target)?c[g].target:null,null==p||null==f);g++);return i.isContinuous&&i.setCurrentFace(p),r.isContinuous&&r.setCurrentFace(f),{a:[p,f],theta:a,theta2:l}},e.Anchor=function(e){this.x=e.x||0,this.y=e.y||0,this.elementId=e.elementId,this.cssClass=e.cssClass||"",this.userDefinedLocation=null,this.orientation=e.orientation||[0,0],this.lastReturnValue=null,this.offsets=e.offsets||[0,0],this.timestamp=null;var n=!1!==e.relocatable;this.isRelocatable=function(){return n},this.setRelocatable=function(t){n=t};var o=!1!==e.snapOnRelocate;this.isSnapOnRelocate=function(){return o};var i=!1;this.lock=function(){i=!0},this.unlock=function(){i=!1},this.isLocked=function(){return i},t.EventGenerator.apply(this),this.compute=function(t){var e=t.xy,n=t.wh,o=t.timestamp;return t.clearUserDefinedLocation&&(this.userDefinedLocation=null),o&&o===this.timestamp||(this.lastReturnValue=null!=this.userDefinedLocation?this.userDefinedLocation:[e[0]+this.x*n[0]+this.offsets[0],e[1]+this.y*n[1]+this.offsets[1],this.x,this.y],this.timestamp=o),this.lastReturnValue},this.getCurrentLocation=function(t){return t=t||{},null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue},this.setPosition=function(t,e,n,o,r){i&&!r||(this.x=t,this.y=e,this.orientation=[n,o],this.lastReturnValue=null)}},t.extend(e.Anchor,t.EventGenerator,{equals:function(t){if(!t)return!1;var e=t.getOrientation(),n=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&n[0]===e[0]&&n[1]===e[1]},getUserDefinedLocation:function(){return this.userDefinedLocation},setUserDefinedLocation:function(t){this.userDefinedLocation=t},clearUserDefinedLocation:function(){this.userDefinedLocation=null},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),e.FloatingAnchor=function(t){e.Anchor.apply(this,arguments);var n=t.reference,o=t.referenceCanvas,i=e.getSize(o),r=0,s=0,a=null,l=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var e=t.xy,n=[e[0]+i[0]/2,e[1]+i[1]/2];return l=n,n},this.getOrientation=function(t){if(a)return a;var e=n.getOrientation(t);return[Math.abs(e[0])*r*-1,Math.abs(e[1])*s*-1]},this.over=function(t,e){a=t.getOrientation(e)},this.out=function(){a=null},this.getCurrentLocation=function(t){return null==l?this.compute(t):l}},t.extend(e.FloatingAnchor,e.Anchor);var n=function(t,n,o){return t.constructor===e.Anchor?t:n.makeAnchor(t,o,n)};e.DynamicAnchor=function(t){e.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=t.elementId,this.jsPlumbInstance=t.jsPlumbInstance;for(var o=0;o<t.anchors.length;o++)this.anchors[o]=n(t.anchors[o],this.jsPlumbInstance,this.elementId);this.getAnchors=function(){return this.anchors};var i=this.anchors.length>0?this.anchors[0]:null,r=i,s=this,a=function(t,e,n,o,i){var r=o[0]+t.x*i[0],s=o[1]+t.y*i[1],a=o[0]+i[0]/2,l=o[1]+i[1]/2;return Math.sqrt(Math.pow(e-r,2)+Math.pow(n-s,2))+Math.sqrt(Math.pow(a-r,2)+Math.pow(l-s,2))},l=t.selector||function(t,e,n,o,i){for(var r=n[0]+o[0]/2,s=n[1]+o[1]/2,l=-1,c=1/0,u=0;u<i.length;u++){var h=a(i[u],r,s,t,e);h<c&&(l=u+0,c=h)}return i[l]};this.compute=function(t){var e=t.xy,n=t.wh,o=t.txy,a=t.twh;this.timestamp=t.timestamp;var c=s.getUserDefinedLocation();return null!=c?c:(this.isLocked()||null==o||null==a||(t.timestamp=null,i=l(e,n,o,a,this.anchors),this.x=i.x,this.y=i.y,i!==r&&this.fire("anchorChanged",i),r=i),i.compute(t))},this.getCurrentLocation=function(t){return this.getUserDefinedLocation()||(null!=i?i.getCurrentLocation(t):null)},this.getOrientation=function(t){return null!=i?i.getOrientation(t):[0,0]},this.over=function(t,e){null!=i&&i.over(t,e)},this.out=function(){null!=i&&i.out()},this.setAnchor=function(t){i=t},this.getCssClass=function(){return i&&i.getCssClass()||""},this.setAnchorCoordinates=function(t){var e=jsPlumbUtil.findWithFunction(this.anchors,(function(e){return e.x===t[0]&&e.y===t[1]}));return-1!==e&&(this.setAnchor(this.anchors[e]),!0)}},t.extend(e.DynamicAnchor,e.Anchor);var o=function(t,n,o,i,r,s){e.Anchors[r]=function(e){var a=e.jsPlumbInstance.makeAnchor([t,n,o,i,0,0],e.elementId,e.jsPlumbInstance);return a.type=r,s&&s(a,e),a}};o(.5,0,0,-1,"TopCenter"),o(.5,1,0,1,"BottomCenter"),o(0,.5,-1,0,"LeftMiddle"),o(1,.5,1,0,"RightMiddle"),o(.5,0,0,-1,"Top"),o(.5,1,0,1,"Bottom"),o(0,.5,-1,0,"Left"),o(1,.5,1,0,"Right"),o(.5,.5,0,0,"Center"),o(1,0,0,-1,"TopRight"),o(1,1,0,1,"BottomRight"),o(0,0,0,-1,"TopLeft"),o(0,1,0,1,"BottomLeft"),e.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},e.Anchors.AutoDefault=function(t){var n=t.jsPlumbInstance.makeDynamicAnchor(e.Defaults.DynamicAnchors(t));return n.type="AutoDefault",n};var i=function(t,n){e.Anchors[t]=function(e){var o=e.jsPlumbInstance.makeAnchor(["Continuous",{faces:n}],e.elementId,e.jsPlumbInstance);return o.type=t,o}};e.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},i("ContinuousLeft",["left"]),i("ContinuousTop",["top"]),i("ContinuousBottom",["bottom"]),i("ContinuousRight",["right"]),o(0,0,0,0,"Assign",(function(t,e){var n=e.position||"Fixed";t.positionFinder=n.constructor===String?e.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=e})),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,e,n){return[(t.left-e.left)/n[0],(t.top-e.top)/n[1]]},Grid:function(t,e,n,o){var i=t.top-e.top,r=n[0]/o.grid[0],s=n[1]/o.grid[1],a=Math.floor((t.left-e.left)/r),l=Math.floor(i/s);return[(a*r+r/2)/n[0],(l*s+s/2)/n[1]]}},e.Anchors.Perimeter=function(t){var e=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");var o=function(){for(var t=.5,n=2*Math.PI/e,o=0,i=[],r=0;r<e;r++){var s=t+t*Math.sin(o),a=t+t*Math.cos(o);i.push([s,a,0,0]),o+=n}return i},i=function(t){for(var n=e/t.length,o=[],i=function(t,i,r,s,a,l,c){for(var u=(r-t)/(n=e*a),h=(s-i)/n,d=0;d<n;d++)o.push([t+u*d,i+h*d,null==l?0:l,null==c?0:c])},r=0;r<t.length;r++)i.apply(null,t[r]);return o},r=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length,t[n][4],t[n][5]]);return i(e)},s=function(){return r([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])},a={Circle:o,Ellipse:o,Diamond:function(){return r([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:s,Square:s,Triangle:function(){return r([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var e=t.points,n=[],o=0,r=0;r<e.length-1;r++){var s=Math.sqrt(Math.pow(e[r][2]-e[r][0])+Math.pow(e[r][3]-e[r][1]));o+=s,n.push([e[r][0],e[r][1],e[r+1][0],e[r+1][1],s])}for(var a=0;a<n.length;a++)n[a][4]=n[a][4]/o;return i(n)}};if(!a[n])throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var l=a[n](t);t.rotation&&(l=function(t,e){for(var n=[],o=e/180*Math.PI,i=0;i<t.length;i++){var r=t[i][0]-.5,s=t[i][1]-.5;n.push([r*Math.cos(o)-s*Math.sin(o)+.5,r*Math.sin(o)+s*Math.cos(o)+.5,t[i][2],t[i][3]])}return n}(l,t.rotation));var c=t.jsPlumbInstance.makeDynamicAnchor(l);return c.type="Perimeter",c}}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb;t.DefaultRouter=function(e){this.jsPlumbInstance=e,this.anchorManager=new t.AnchorManager({jsPlumbInstance:e}),this.sourceOrTargetChanged=function(t,e,n,o,i){this.anchorManager.sourceOrTargetChanged(t,e,n,o,i)},this.reset=function(){this.anchorManager.reset()},this.changeId=function(t,e){this.anchorManager.changeId(t,e)},this.elementRemoved=function(t){this.anchorManager.elementRemoved(t)},this.newConnection=function(t){this.anchorManager.newConnection(t)},this.connectionDetached=function(t,e){this.anchorManager.connectionDetached(t,e)}}}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this,e=t.jsPlumb,n=t.jsPlumbUtil,o=t.Biltong;e.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(t,e){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}},this.lineIntersection=function(t,e,n,o){return[]},this.boxIntersection=function(t,e,n,o){var i=[];return i.push.apply(i,this.lineIntersection(t,e,t+n,e)),i.push.apply(i,this.lineIntersection(t+n,e,t+n,e+o)),i.push.apply(i,this.lineIntersection(t+n,e+o,t,e+o)),i.push.apply(i,this.lineIntersection(t,e+o,t,e)),i},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){e.Segments.AbstractSegment.apply(this,arguments);var n,i,r,s,a,l,c,u=function(){n=Math.sqrt(Math.pow(a-s,2)+Math.pow(c-l,2)),i=o.gradient({x:s,y:l},{x:a,y:c}),r=-1/i};this.type="Straight",this.getLength=function(){return n},this.getGradient=function(){return i},this.getCoordinates=function(){return{x1:s,y1:l,x2:a,y2:c}},this.setCoordinates=function(t){s=t.x1,l=t.y1,a=t.x2,c=t.y2,u()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(s,a),minY:Math.min(l,c),maxX:Math.max(s,a),maxY:Math.max(l,c)}},this.pointOnPath=function(t,e){return 0!==t||e?1!==t||e?o.pointOnLine({x:s,y:l},{x:a,y:c},e?t>0?t:n+t:t*n):{x:a,y:c}:{x:s,y:l}},this.gradientAtPoint=function(t){return i},this.pointAlongPathFrom=function(t,e,n){var i=this.pointOnPath(t,n),r=e<=0?{x:s,y:l}:{x:a,y:c};return e<=0&&Math.abs(e)>1&&(e*=-1),o.pointOnLine(i,r,e)};var h=function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)},d=function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e};this.findClosestPointOnPath=function(t,e){var u={d:1/0,x:null,y:null,l:null,x1:s,x2:a,y1:l,y2:c};if(0===i)u.y=l,u.x=h(s,a,t)?t:d(s,a,t);else if(i===1/0||i===-1/0)u.x=s,u.y=h(l,c,e)?e:d(l,c,e);else{var p=l-i*s,f=(e-r*t-p)/(i-r),g=i*f+p;u.x=h(s,a,f)?f:d(s,a,f),u.y=h(l,c,g)?g:d(l,c,g)}var m=o.lineLength([u.x,u.y],[s,l]);return u.d=o.lineLength([t,e],[u.x,u.y]),u.l=m/n,u};var p=function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n},f=p;this.lineIntersection=function(t,e,n,r){var u=Math.abs(o.gradient({x:t,y:e},{x:n,y:r})),h=Math.abs(i),d=h===1/0?s:l-h*s,p=[],g=u===1/0?t:e-u*t;if(u!==h)if(u===1/0&&0===h)f(t,s,a)&&f(l,e,r)&&(p=[t,l]);else if(0===u&&h===1/0)f(e,l,c)&&f(s,t,n)&&(p=[s,e]);else{var m,v;u===1/0?f(m=t,s,a)&&f(v=h*t+d,e,r)&&(p=[m,v]):0===u?f(v=e,l,c)&&f(m=(e-d)/h,t,n)&&(p=[m,v]):(v=h*(m=(g-d)/(h-u))+d,f(m,s,a)&&f(v,l,c)&&(p=[m,v]))}return p},this.boxIntersection=function(t,e,n,o){var i=[];return i.push.apply(i,this.lineIntersection(t,e,t+n,e)),i.push.apply(i,this.lineIntersection(t+n,e,t+n,e+o)),i.push.apply(i,this.lineIntersection(t+n,e+o,t,e+o)),i.push.apply(i,this.lineIntersection(t,e+o,t,e)),i},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(t){e.Segments.AbstractSegment.apply(this,arguments);var n=function(e,n){return o.theta([t.cx,t.cy],[e,n])},i=function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+r:t.startAngle;return n-Math.abs(n-t.endAngle)*e}var o=Math.abs((t.endAngle<t.startAngle?t.endAngle+r:t.endAngle)-t.startAngle);return t.startAngle+o*e},r=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+this.radius*Math.cos(t.startAngle),this.y1=t.cy+this.radius*Math.sin(t.startAngle),this.x2=t.cx+this.radius*Math.cos(t.endAngle),this.y2=t.cy+this.radius*Math.sin(t.endAngle)):(this.startAngle=n(t.x1,t.y1),this.endAngle=n(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),this.endAngle<0&&(this.endAngle+=r),this.startAngle<0&&(this.startAngle+=r);var s=this.endAngle<this.startAngle?this.endAngle+r:this.endAngle;this.sweep=Math.abs(s-this.startAngle),this.anticlockwise&&(this.sweep=r-this.sweep);var a=2*Math.PI*this.radius,l=this.sweep/r,c=a*l;this.getLength=function(){return c},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var u=1e-10,h=function(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<u?e:n-t<u?n:t};this.pointOnPath=function(e,n){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};n&&(e/=c);var o=i(this,e),r=t.cx+t.r*Math.cos(o),s=t.cy+t.r*Math.sin(o);return{x:h(r),y:h(s),theta:o}},this.gradientAtPoint=function(e,n){var i=this.pointOnPath(e,n),r=o.normal([t.cx,t.cy],[i.x,i.y]);return this.anticlockwise||r!==1/0&&r!==-1/0||(r*=-1),r},this.pointAlongPathFrom=function(e,n,o){var i=this.pointOnPath(e,o),r=n/a*2*Math.PI,s=i.theta+(this.anticlockwise?-1:1)*r;return{x:t.cx+this.radius*Math.cos(s),y:t.cy+this.radius*Math.sin(s)}}},Bezier:function(n){this.curve=[{x:n.x1,y:n.y1},{x:n.cp1x,y:n.cp1y},{x:n.cp2x,y:n.cp2y},{x:n.x2,y:n.y2}];var o=function(t){return t[0].x===t[1].x&&t[0].y===t[1].y},i=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},r=(function(t){var e={x:0,y:0};if(0===t)return this.curve[0];var n=this.curve.length-1;if(1===t)return this.curve[n];var o=this.curve,i=1-t;if(0===n)return this.curve[0];if(1===n)return{x:i*o[0].x+t*o[1].x,y:i*o[0].y+t*o[1].y};if(n<4){var r,s,a,l=i*i,c=t*t,u=0;return 2===n?(o=[o[0],o[1],o[2],e],r=l,s=i*t*2,a=c):3===n&&(r=l*i,s=l*t*3,a=i*c*3,u=t*c),{x:r*o[0].x+s*o[1].x+a*o[2].x+u*o[3].x,y:r*o[0].y+s*o[1].y+a*o[2].y+u*o[3].y}}return e}).bind(this),s=function(t){var e=[];t--;for(var n=0;n<=t;n++)e.push(r(n/t));return e},a=(function(){o(this.curve)&&(this.length=0);var t=s(16);this.length=0;for(var e=0;e<15;e++)this.length+=i(t[e],t[e+1])}).bind(this);e.Segments.AbstractSegment.apply(this,arguments),this.bounds={minX:Math.min(n.x1,n.x2,n.cp1x,n.cp2x),minY:Math.min(n.y1,n.y2,n.cp1y,n.cp2y),maxX:Math.max(n.x1,n.x2,n.cp1x,n.cp2x),maxY:Math.max(n.y1,n.y2,n.cp1y,n.cp2y)},this.type="Bezier",a();var l=function(e,n,o){return o&&(n=t.jsBezier.locationAlongCurveFrom(e,n>0?0:1,n)),n};this.pointOnPath=function(e,n){return e=l(this.curve,e,n),t.jsBezier.pointOnCurve(this.curve,e)},this.gradientAtPoint=function(e,n){return e=l(this.curve,e,n),t.jsBezier.gradientAtPoint(this.curve,e)},this.pointAlongPathFrom=function(e,n,o){return e=l(this.curve,e,o),t.jsBezier.pointAlongCurveFrom(this.curve,e,n)},this.getLength=function(){return this.length},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(e,n){var o=t.jsBezier.nearestPointOnCurve({x:e,y:n},this.curve);return{d:Math.sqrt(Math.pow(o.point.x-e,2)+Math.pow(o.point.y-n,2)),x:o.point.x,y:o.point.y,l:1-o.location,s:this}},this.lineIntersection=function(e,n,o,i){return t.jsBezier.lineIntersection(e,n,o,i,this.curve)}}},e.SegmentRenderer={getPath:function(t,e){return{Straight:function(e){var n=t.getCoordinates();return(e?"M "+n.x1+" "+n.y1+" ":"")+"L "+n.x2+" "+n.y2},Bezier:function(e){var n=t.params;return(e?"M "+n.x2+" "+n.y2+" ":"")+"C "+n.cp2x+" "+n.cp2y+" "+n.cp1x+" "+n.cp1y+" "+n.x1+" "+n.y1},Arc:function(e){var n=t.sweep>Math.PI?1:0;return(e?"M"+t.x1+" "+t.y1+" ":"")+"A "+t.radius+" "+t.params.r+" 0 "+n+","+(t.anticlockwise?0:1)+" "+t.x2+" "+t.y2}}[t.type](e)}};var i=function(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()};e.Connectors.AbstractConnector=function(t){i.apply(this,arguments);var r=[],s=0,a=[],l=[],c=t.stub||0,u=n.isArray(c)?c[0]:c,h=n.isArray(c)?c[1]:c,d=t.gap||0,p=n.isArray(d)?d[0]:d,f=n.isArray(d)?d[1]:d,g=null,m=null;this.getPathData=function(){for(var t="",n=0;n<r.length;n++)t+=e.SegmentRenderer.getPath(r[n],0===n),t+=" ";return t},this.findSegmentForPoint=function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null},o=0;o<r.length;o++){var i=r[o].findClosestPointOnPath(t,e);i.d<n.d&&(n.d=i.d,n.l=i.l,n.x=i.x,n.y=i.y,n.s=r[o],n.x1=i.x1,n.x2=i.x2,n.y1=i.y1,n.y2=i.y2,n.index=o,n.connectorLocation=a[o][0]+i.l*(a[o][1]-a[o][0]))}return n},this.lineIntersection=function(t,e,n,o){for(var i=[],s=0;s<r.length;s++)i.push.apply(i,r[s].lineIntersection(t,e,n,o));return i},this.boxIntersection=function(t,e,n,o){for(var i=[],s=0;s<r.length;s++)i.push.apply(i,r[s].boxIntersection(t,e,n,o));return i},this.boundingBoxIntersection=function(t){for(var e=[],n=0;n<r.length;n++)e.push.apply(e,r[n].boundingBoxIntersection(t));return e};var v=function(){for(var t=0,e=0;e<r.length;e++){var n=r[e].getLength();l[e]=n/s,a[e]=[t,t+=n/s]}},b=function(t,e){var n,o,i;if(e&&(t=t>0?t/s:(s+t)/s),1===t)n=r.length-1,i=1;else if(0===t)i=0,n=0;else if(t>=.5){for(n=0,i=0,o=a.length-1;o>-1;o--)if(a[o][1]>=t&&a[o][0]<=t){n=o,i=(t-a[o][0])/l[o];break}}else for(n=a.length-1,i=1,o=0;o<a.length;o++)if(a[o][1]>=t){n=o,i=(t-a[o][0])/l[o];break}return{segment:r[n],proportion:i,index:n}},y=function(t,n,o){if(o.x1!==o.x2||o.y1!==o.y2){var i=new e.Segments[n](o);r.push(i),s+=i.getLength(),t.updateBounds(i)}},P=function(){s=r.length=a.length=l.length=0};this.setSegments=function(t){g=[],s=0;for(var e=0;e<t.length;e++)g.push(t[e]),s+=t[e].getLength()},this.getLength=function(){return s};var C=function(t){this.strokeWidth=t.strokeWidth;var e=o.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],i=t.targetPos[1]<t.sourcePos[1],r=t.strokeWidth||1,s=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),a=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),l=n?t.targetPos[0]:t.sourcePos[0],c=i?t.targetPos[1]:t.sourcePos[1],d=Math.abs(t.targetPos[0]-t.sourcePos[0]),g=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===s[0]&&0===s[1]||0===a[0]&&0===a[1]){var m=d>g?0:1,v=[1,0][m];a=[],(s=[])[m]=t.sourcePos[m]>t.targetPos[m]?-1:1,a[m]=t.sourcePos[m]>t.targetPos[m]?1:-1,s[v]=0,a[v]=0}var b=n?d+p*s[0]:p*s[0],y=i?g+p*s[1]:p*s[1],P=n?f*a[0]:d+f*a[0],C=i?f*a[1]:g+f*a[1],x=s[0]*a[0]+s[1]*a[1],_={sx:b,sy:y,tx:P,ty:C,lw:r,xSpan:Math.abs(P-b),ySpan:Math.abs(C-y),mx:(b+P)/2,my:(y+C)/2,so:s,to:a,x:l,y:c,w:d,h:g,segment:e,startStubX:b+s[0]*u,startStubY:y+s[1]*u,endStubX:P+a[0]*h,endStubY:C+a[1]*h,isXGreaterThanStubTimes2:Math.abs(b-P)>u+h,isYGreaterThanStubTimes2:Math.abs(y-C)>u+h,opposite:-1===x,perpendicular:0===x,orthogonal:1===x,sourceAxis:0===s[0]?"y":"x",points:[l,c,d,g,b,y,P,C],stubs:[u,h]};return _.anchorOrientation=_.opposite?"opposite":_.orthogonal?"orthogonal":"perpendicular",_};return this.getSegments=function(){return r},this.updateBounds=function(t){var e=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,e.minX),this.bounds.maxX=Math.max(this.bounds.maxX,e.maxX),this.bounds.minY=Math.min(this.bounds.minY,e.minY),this.bounds.maxY=Math.max(this.bounds.maxY,e.maxY)},this.pointOnPath=function(t,e){var n=b(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,e){var n=b(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0},this.pointAlongPathFrom=function(t,e,n){var o=b(t,n);return o.segment&&o.segment.pointAlongPathFrom(o.proportion,e,!1)||[0,0]},this.compute=function(t){m=C.call(this,t),P(),this._compute(m,t),this.x=m.points[0],this.y=m.points[1],this.w=m.points[2],this.h=m.points[3],this.segment=m.segment,v()},{addSegment:y,prepareCompute:C,sourceStub:u,targetStub:h,maxStub:Math.max(u,h),sourceGap:p,targetGap:f,maxGap:Math.max(p,f)}},n.extend(e.Connectors.AbstractConnector,i),e.Endpoints.AbstractEndpoint=function(t){i.apply(this,arguments);var e=this.compute=function(t,e,n,o){var i=this._compute.apply(this,arguments);return this.x=i[0],this.y=i[1],this.w=i[2],this.h=i[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,i};return{compute:e,cssClass:t.cssClass}},n.extend(e.Endpoints.AbstractEndpoint,i),e.Endpoints.Dot=function(t){this.type="Dot",e.Endpoints.AbstractEndpoint.apply(this,arguments),this.radius=(t=t||{}).radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,e,n,o){this.radius=n.radius||this.radius;var i=t[0]-this.radius,r=t[1]-this.radius,s=2*this.radius,a=2*this.radius;if(n.stroke){var l=n.strokeWidth||1;i-=l,r-=l,s+=2*l,a+=2*l}return[i,r,s,a,this.radius]}},n.extend(e.Endpoints.Dot,e.Endpoints.AbstractEndpoint),e.Endpoints.Rectangle=function(t){this.type="Rectangle",e.Endpoints.AbstractEndpoint.apply(this,arguments),this.width=(t=t||{}).width||20,this.height=t.height||20,this._compute=function(t,e,n,o){var i=n.width||this.width,r=n.height||this.height;return[t[0]-i/2,t[1]-r/2,i,r]}},n.extend(e.Endpoints.Rectangle,e.Endpoints.AbstractEndpoint);var r=function(t){e.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]};n.extend(r,e.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),e.Endpoints.Image=function(o){this.type="Image",r.apply(this,arguments),e.Endpoints.AbstractEndpoint.apply(this,arguments);var i=o.onload,s=o.src||o.url,a=o.cssClass?" "+o.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=o.width,this._jsPlumb.heightToUse=o.height,this._jsPlumb.endpoint=o.endpoint,this._jsPlumb.img.onload=(function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,i&&i(this))}).bind(this),this._jsPlumb.endpoint.setImage=(function(t,e){i=e,this._jsPlumb.img.src=t.constructor===String?t:t.src,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}).bind(this),this._jsPlumb.endpoint.setImage(s,i),this._compute=function(t,e,n,o){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=e.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+a),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(t,e,o){this._jsPlumb.deleted||(this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0),n.sizeElement(this.canvas,this.anchorPoint[0]-this._jsPlumb.widthToUse/2,this.anchorPoint[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse))},this.paint=function(e,n){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(e,n):t.setTimeout((function(){this.paint(e,n)}).bind(this),200))}},n.extend(e.Endpoints.Image,[r,e.Endpoints.AbstractEndpoint],{cleanup:function(t){t&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),e.Endpoints.Blank=function(t){e.Endpoints.AbstractEndpoint.apply(this,arguments),this.type="Blank",r.apply(this,arguments),this._compute=function(t,e,n,o){return[t[0],t[1],10,0]};var o=t.cssClass?" "+t.cssClass:"";this.canvas=e.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+o),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(t,e){n.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},n.extend(e.Endpoints.Blank,[e.Endpoints.AbstractEndpoint,r],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),e.Endpoints.Triangle=function(t){this.type="Triangle",e.Endpoints.AbstractEndpoint.apply(this,arguments);var n=this;(t=t||{}).width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,e,o,i){var r=o.width||n.width,s=o.height||n.height;return[t[0]-r/2,t[1]-s/2,r,s]}};var s=e.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.visible=!1!==t.visible};s.prototype={cleanup:function(t){t&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(t,e){},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},e.Overlays.Arrow=function(t){this.type="Arrow",s.apply(this,arguments),this.isAppendedAtTopLevel=!1;var i=this;this.length=(t=t||{}).length||20,this.width=t.width||20,this.id=t.id,this.direction=(t.direction||1)<0?-1:1;var r=t.paintStyle||{"stroke-width":1},a=t.foldback||.623;this.computeMaxSize=function(){return 1.5*i.width},this.elementCreated=function(n,o){if(this.path=n,t.events)for(var i in t.events)e.on(n,i,t.events[i])},this.draw=function(t,e){var i,s,l,c;if(t.pointAlongPathFrom){if(n.isString(this.loc)||this.loc>1||this.loc<0){var u=parseInt(this.loc,10),h=this.loc<0?1:0;i=t.pointAlongPathFrom(h,u,!1),s=t.pointAlongPathFrom(h,u-this.direction*this.length/2,!1),l=o.pointOnLine(i,s,this.length)}else if(1===this.loc){if(i=t.pointOnPath(this.loc),s=t.pointAlongPathFrom(this.loc,-this.length),l=o.pointOnLine(i,s,this.length),-1===this.direction){var d=l;l=i,i=d}}else if(0===this.loc){if(l=t.pointOnPath(this.loc),s=t.pointAlongPathFrom(this.loc,this.length),i=o.pointOnLine(l,s,this.length),-1===this.direction){var p=l;l=i,i=p}}else i=t.pointAlongPathFrom(this.loc,this.direction*this.length/2),s=t.pointOnPath(this.loc),l=o.pointOnLine(i,s,this.length);return{component:t,d:{hxy:i,tail:c=o.perpendicularLineTo(i,l,this.width),cxy:o.pointOnLine(i,l,a*this.length)},"stroke-width":r.strokeWidth||e.strokeWidth,stroke:r.stroke||e.stroke,fill:r.fill||e.stroke,minX:Math.min(i.x,c[0].x,c[1].x),maxX:Math.max(i.x,c[0].x,c[1].x),minY:Math.min(i.y,c[0].y,c[1].y),maxY:Math.max(i.y,c[0].y,c[1].y)}}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},n.extend(e.Overlays.Arrow,s,{updateFrom:function(t){this.length=t.length||this.length,this.width=t.width||this.width,this.direction=null!=t.direction?t.direction:this.direction,this.foldback=t.foldback||this.foldback},cleanup:function(){this.path&&this.path.parentNode&&this.path.parentNode.removeChild(this.path)}}),e.Overlays.PlainArrow=function(t){var n=e.extend(t=t||{},{foldback:1});e.Overlays.Arrow.call(this,n),this.type="PlainArrow"},n.extend(e.Overlays.PlainArrow,e.Overlays.Arrow),e.Overlays.Diamond=function(t){var n=e.extend(t=t||{},{length:(t.length||40)/2,foldback:2});e.Overlays.Arrow.call(this,n),this.type="Diamond"},n.extend(e.Overlays.Diamond,e.Overlays.Arrow);var a=function(t,e){return(null==t._jsPlumb.cachedDimensions||e)&&(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions},l=function(t){e.jsPlumbUIComponent.apply(this,arguments),s.apply(this,arguments);var o=this.fire;this.fire=function(){o.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=t.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=t.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=t.create,this._jsPlumb.initiallyInvisible=!1===t.visible,this.getElement=function(){if(null==this._jsPlumb.div){var n=this._jsPlumb.div=e.getElement(this._jsPlumb.create(this._jsPlumb.component));n.style.position="absolute",jsPlumb.addClass(n,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:t.cssClass?t.cssClass:"")),this._jsPlumb.instance.appendElement(n),this._jsPlumb.instance.getId(n),this.canvas=n;var o="translate(-50%, -50%)";n.style.webkitTransform=o,n.style.mozTransform=o,n.style.msTransform=o,n.style.oTransform=o,n.style.transform=o,n._jsPlumb=this,!1===t.visible&&(n.style.display="none")}return this._jsPlumb.div},this.draw=function(t,e,o){var i=a(this);if(null!=i&&2===i.length){var r={x:0,y:0};if(o)r={x:o[0],y:o[1]};else if(t.pointOnPath){var s=this.loc,l=!1;(n.isString(this.loc)||this.loc<0||this.loc>1)&&(s=parseInt(this.loc,10),l=!0),r=t.pointOnPath(s,l)}else{var c=this.loc.constructor===Array?this.loc:this.endpointLoc;r={x:c[0]*t.w,y:c[1]*t.h}}var u=r.x-i[0]/2,h=r.y-i[1]/2;return{component:t,d:{minx:u,miny:h,td:i,cxy:r},minX:u,maxX:u+i[0],minY:h,maxY:h+i[1]}}return{minX:0,maxX:0,minY:0,maxY:0}}};n.extend(l,[e.jsPlumbUIComponent,s],{getDimensions:function(){return[1,1]},setVisible:function(t){this._jsPlumb.div&&(this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(a(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){t?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(t,e){null!=this._jsPlumb.div&&t.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var t=a(this);return Math.max(t[0],t[1])},paint:function(t,e){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),e.Overlays.Custom=function(t){this.type="Custom",l.apply(this,arguments)},n.extend(e.Overlays.Custom,l),e.Overlays.GuideLines=function(){var t=this;t.length=50,t.strokeWidth=5,this.type="GuideLines",s.apply(this,arguments),e.jsPlumbUIComponent.apply(this,arguments),this.draw=function(e,n){var i=e.pointAlongPathFrom(t.loc,t.length/2),r=e.pointOnPath(t.loc),s=o.pointOnLine(i,r,t.length),a=o.perpendicularLineTo(i,s,40),l=o.perpendicularLineTo(s,i,20);return{connector:e,head:i,tail:s,headLine:l,tailLine:a,minX:Math.min(i.x,s.x,l[0].x,l[1].x),minY:Math.min(i.y,s.y,l[0].y,l[1].y),maxX:Math.max(i.x,s.x,l[0].x,l[1].x),maxY:Math.max(i.y,s.y,l[0].y,l[1].y)}}},e.Overlays.Label=function(t){this.labelStyle=t.labelStyle,this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var n=e.extend({create:function(){return e.createElement("div")}},t);if(e.Overlays.Custom.call(this,n),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var o=this.getElement();this.labelStyle.font=this.labelStyle.font||"12px sans-serif",o.style.font=this.labelStyle.font,o.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(o.style.background=this.labelStyle.fill),this.labelStyle.borderWidth>0&&(o.style.border=this.labelStyle.borderWidth+"px solid "+(this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black")),this.labelStyle.padding&&(o.style.padding=this.labelStyle.padding)}},n.extend(e.Overlays.Label,e.Overlays.Custom,{cleanup:function(t){t&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),l.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(t){null!=t.label&&this.setLabel(t.label)}})}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this,e=t.jsPlumbUtil,n=t.jsPlumbInstance,o="_jsPlumbGroup",i=function(t){var n={},i={},r={},s=this;function a(e,n){for(var o=t.getContainer();;){if(null==e||e===o)return!1;if(e===n)return!0;e=e.parentNode}}function l(e,n){for(var o=e.getEl().querySelectorAll(".jtk-managed"),i=0;i<o.length;i++)t[n?"show":"hide"](o[i],!0)}t.bind("connection",(function(n){var o=t.getGroupFor(n.source),s=t.getGroupFor(n.target);null!=o&&null!=s&&o===s?(i[n.connection.id]=o,r[n.connection.id]=o):(null!=o&&(e.suggest(o.connections.source,n.connection),i[n.connection.id]=o),null!=s&&(e.suggest(s.connections.target,n.connection),r[n.connection.id]=s))})),t.bind("internal.connectionDetached",(function(t){!function(t){delete t.proxies;var n,o=i[t.id];null!=o&&(e.removeWithFunction(o.connections.source,n=function(e){return e.id===t.id}),e.removeWithFunction(o.connections.target,n),delete i[t.id]),null!=(o=r[t.id])&&(e.removeWithFunction(o.connections.source,n=function(e){return e.id===t.id}),e.removeWithFunction(o.connections.target,n),delete r[t.id])}(t.connection)})),t.bind("connectionMoved",(function(t){var e=(0===t.index?i:r)[t.connection.id];if(e){var n=e.connections[0===t.index?"source":"target"],o=n.indexOf(t.connection);-1!==o&&n.splice(o,1)}})),this.addGroup=function(e){t.addClass(e.getEl(),"jtk-group-expanded"),n[e.id]=e,e.manager=this,h(e),t.fire("group:add",{group:e})},this.addToGroup=function(e,n,o){if(e=this.getGroup(e)){var i=e.getEl();if(n._isJsPlumbGroup)return;var r=n._jsPlumbGroup;if(r!==e){t.removeFromDragSelection(n);var a=t.getOffset(n,!0),l=t.getOffset(e.collapsed?i:e.getDragArea(),!0);null!=r&&(r.remove(n,!1,o,!1,e),s.updateConnectionsForGroup(r)),e.add(n,o);var h=function(t,n){var o=0===n?1:0;t.each((function(t){t.setVisible(!1),t.endpoints[o].element._jsPlumbGroup===e?(t.endpoints[o].setVisible(!1),u(t,o,e)):(t.endpoints[n].setVisible(!1),c(t,n,e))}))};e.collapsed&&(h(t.select({source:n}),0),h(t.select({target:n}),1));var d=t.getId(n);t.dragManager.setParent(n,d,i,t.getId(i),a);var p={left:a.left-l.left,top:a.top-l.top};if(t.setPosition(n,p),t.dragManager.revalidateParent(n,d,a),s.updateConnectionsForGroup(e),t.revalidate(d),!o){var f={group:e,el:n,pos:p};r&&(f.sourceGroup=r),t.fire("group:addMember",f)}}}},this.removeFromGroup=function(t,e,n){if(t=this.getGroup(t)){if(t.collapsed){var o=function(n,o){for(var i=0;i<n.length;i++){var r=n[i];if(r.proxies)for(var s=0;s<r.proxies.length;s++)if(null!=r.proxies[s]){var l=r.proxies[s].originalEp.element;(l===e||a(l,e))&&u(r,o,t)}}};o(t.connections.source.slice(),0),o(t.connections.target.slice(),1)}t.remove(e,null,n)}},this.getGroup=function(t){var o=t;if(e.isString(t)&&null==(o=n[t]))throw new TypeError("No such group ["+t+"]");return o},this.getGroups=function(){var t=[];for(var e in n)t.push(n[e]);return t},this.removeGroup=function(e,o,i,r){e=this.getGroup(e),this.expandGroup(e,!0);var s=e[o?"removeAll":"orphanAll"](i,r);return t.remove(e.getEl()),delete n[e.id],delete t._groups[e.id],t.fire("group:remove",{group:e}),s},this.removeAllGroups=function(t,e,o){for(var i in n)this.removeGroup(n[i],t,e,o)};var c=function(e,n,i){var r=e.endpoints[0===n?1:0].element;if(!r[o]||r[o].shouldProxy()||!r[o].collapsed){var s=i.getEl(),a=t.getId(s);t.proxyConnection(e,n,s,a,(function(t,e){return i.getEndpoint(t,e)}),(function(t,e){return i.getAnchor(t,e)}))}};this.collapseGroup=function(e){if(null!=(e=this.getGroup(e))&&!e.collapsed){var n=e.getEl();if(l(e,!1),e.shouldProxy()){var o=function(t,n){for(var o=0;o<t.length;o++)c(t[o],n,e)};o(e.connections.source,0),o(e.connections.target,1)}e.collapsed=!0,t.removeClass(n,"jtk-group-expanded"),t.addClass(n,"jtk-group-collapsed"),t.revalidate(n),t.fire("group:collapse",{group:e})}};var u=function(e,n,o){t.unproxyConnection(e,n,t.getId(o.getEl()))};function h(e){for(var n=e.getMembers().slice(),o=[],s=0;s<n.length;s++)Array.prototype.push.apply(o,n[s].querySelectorAll(".jtk-managed"));Array.prototype.push.apply(n,o);var a=t.getConnections({source:n,scope:"*"},!0),l=t.getConnections({target:n,scope:"*"},!0),c={};e.connections.source.length=0,e.connections.target.length=0;var u=function(n){for(var o=0;o<n.length;o++)if(!c[n[o].id]){c[n[o].id]=!0;var s=t.getGroupFor(n[o].source),a=t.getGroupFor(n[o].target);s===e?(a!==e&&e.connections.source.push(n[o]),i[n[o].id]=e):a===e&&(e.connections.target.push(n[o]),r[n[o].id]=e)}};u(a),u(l)}this.expandGroup=function(e,n){if(null!=(e=this.getGroup(e))&&e.collapsed){var o=e.getEl();if(l(e,!0),e.shouldProxy()){var i=function(t,n){for(var o=0;o<t.length;o++)u(t[o],n,e)};i(e.connections.source,0),i(e.connections.target,1)}e.collapsed=!1,t.addClass(o,"jtk-group-expanded"),t.removeClass(o,"jtk-group-collapsed"),t.revalidate(o),this.repaintGroup(e),n||t.fire("group:expand",{group:e})}},this.repaintGroup=function(e){for(var n=(e=this.getGroup(e)).getMembers(),o=0;o<n.length;o++)t.revalidate(n[o])},this.updateConnectionsForGroup=h,this.refreshAllGroups=function(){for(var e in n)h(n[e]),t.dragManager.updateOffsets(t.getId(n[e].getEl()))}},r=function(n,i){var r=this,s=i.el;this.getEl=function(){return s},this.id=i.id||e.uuid(),s._isJsPlumbGroup=!0;var a=this.getDragArea=function(){var t=n.getSelector(s,"[jtk-group-content]");return t&&t.length>0?t[0]:s},l=!0===i.ghost,c=l||!0===i.constrain,u=!1!==i.revert,h=!0===i.orphan,d=!0===i.prune,p=!0===i.dropOverride,f=!1!==i.proxied,g=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(t,e){return i.anchor||"Continuous"},this.getEndpoint=function(t,e){return i.endpoint||["Dot",{radius:10}]},this.collapsed=!1,!1!==i.draggable){var m={drag:function(){for(var t=0;t<g.length;t++)n.draw(g[t])},stop:function(t){n.fire("groupDragStop",jsPlumb.extend(t,{group:r}))},scope:"_jsPlumbGroupDrag"};i.dragOptions&&t.jsPlumb.extend(m,i.dragOptions),n.draggable(i.el,m)}!1!==i.droppable&&n.droppable(i.el,{drop:function(t){var e=t.drag.el;if(!e._isJsPlumbGroup){var o=e._jsPlumbGroup;if(o!==r){if(null!=o&&o.overrideDrop(e,r))return;n.getGroupManager().addToGroup(r,e,!1)}}}});var v=function(t,e){for(var n=null==t.nodeType?t:[t],o=0;o<n.length;o++)e(n[o])};function b(t,e){var o=function(t){return t.offsetParent}(t),i=n.getSize(o),r=n.getSize(t),s=e[0],a=e[1];return s+r[0]>0&&s<i[0]&&a+r[1]>0&&a<i[1]}function y(t){var e=n.getId(t),o=n.getOffset(t);return t.parentNode.removeChild(t),n.getContainer().appendChild(t),n.setPosition(t,o),x(t),n.dragManager.clearParent(t,e),[e,o]}function P(t){var e=[];function o(t,e,o){var i=null;if(!b(t,[e,o])){var r=t._jsPlumbGroup;d?n.remove(t):i=y(t),r.remove(t)}return i}for(var i=0;i<t.selection.length;i++)e.push(o(t.selection[i][0],t.selection[i][1].left,t.selection[i][1].top));return 1===e.length?e[0]:e}function C(t){var e=n.getId(t);n.revalidate(t),n.dragManager.revalidateParent(t,e)}function x(t){t._katavorioDrag&&((d||h)&&t._katavorioDrag.off("stop",P),d||h||!u||(t._katavorioDrag.off("revert",C),t._katavorioDrag.setRevert(null)))}function _(t){t._katavorioDrag&&((d||h)&&t._katavorioDrag.on("stop",P),c&&t._katavorioDrag.setConstrain(!0),l&&t._katavorioDrag.setUseGhostProxy(!0),d||h||!u||(t._katavorioDrag.on("revert",C),t._katavorioDrag.setRevert((function(t,e){return!b(t,e)}))))}this.overrideDrop=function(t,e){return p&&(u||d||h)},this.add=function(t,e){var o=a();v(t,(function(t){if(null!=t._jsPlumbGroup){if(t._jsPlumbGroup===r)return;t._jsPlumbGroup.remove(t,!0,e,!1)}t._jsPlumbGroup=r,g.push(t),n.isAlreadyDraggable(t)&&_(t),t.parentNode!==o&&o.appendChild(t)})),n.getGroupManager().updateConnectionsForGroup(r)},this.remove=function(t,o,i,s,a){v(t,(function(t){if(t._jsPlumbGroup===r){if(delete t._jsPlumbGroup,e.removeWithFunction(g,(function(e){return e===t})),o)try{r.getDragArea().removeChild(t)}catch(l){jsPlumbUtil.log("Could not remove element from Group "+l)}if(x(t),!i){var s={group:r,el:t};a&&(s.targetGroup=a),n.fire("group:removeMember",s)}}})),s||n.getGroupManager().updateConnectionsForGroup(r)},this.removeAll=function(t,e){for(var o=0,i=g.length;o<i;o++){var s=g[0];r.remove(s,t,e,!0),n.remove(s,!0)}g.length=0,n.getGroupManager().updateConnectionsForGroup(r)},this.orphanAll=function(){for(var t={},e=0;e<g.length;e++){var n=y(g[e]);t[n[0]]=n[1]}return g.length=0,t},this.getMembers=function(){return g},s[o]=this,n.bind("elementDraggable",(function(t){t.el._jsPlumbGroup===this&&_(t.el)}).bind(this)),this.shouldProxy=function(){return f},n.getGroupManager().addGroup(this)};n.prototype.addGroup=function(t){var e=this;if(e._groups=e._groups||{},null!=e._groups[t.id])throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=t.el[o])throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new r(e,t);return e._groups[n.id]=n,t.collapsed&&this.collapseGroup(n),n},n.prototype.addToGroup=function(t,e,n){var o=(function(e){var o=this.getId(e);this.manage(o,e),this.getGroupManager().addToGroup(t,e,n)}).bind(this);if(Array.isArray(e))for(var i=0;i<e.length;i++)o(e[i]);else o(e)},n.prototype.removeFromGroup=function(t,e,n){this.getGroupManager().removeFromGroup(t,e,n),this.getContainer().appendChild(e)},n.prototype.removeGroup=function(t,e,n,o){return this.getGroupManager().removeGroup(t,e,n,o)},n.prototype.removeAllGroups=function(t,e,n){this.getGroupManager().removeAllGroups(t,e,n)},n.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)},n.prototype.getGroups=function(){return this.getGroupManager().getGroups()},n.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)},n.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)},n.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)},n.prototype.toggleGroup=function(t){null!=(t=this.getGroupManager().getGroup(t))&&this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)},n.prototype.getGroupManager=function(){var t=this._groupManager;return null==t&&(t=this._groupManager=new i(this)),t},n.prototype.removeGroupManager=function(){delete this._groupManager},n.prototype.getGroupFor=function(t){if(t=this.getElement(t)){for(var e=this.getContainer(),n=!1,i=null;!n;)null==t||t===e?n=!0:t[o]?(i=t[o],n=!0):t=t.parentNode;return i}}}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil;t.Connectors.Flowchart=function(e){this.type="Flowchart",(e=e||{}).stub=null==e.stub?30:e.stub;var n,o=t.Connectors.AbstractConnector.apply(this,arguments),i=null==e.midpoint?.5:e.midpoint,r=!0===e.alwaysRespectStubs,s=null,a=null,l=null!=e.cornerRadius?e.cornerRadius:0,c=function(t){return t<0?-1:0===t?0:1},u=function(t){return[c(t[2]-t[0]),c(t[3]-t[1])]},h=function(t,e,n,o){if(s!==e||a!==n){var i=null==s?o.sx:s,r=null==a?o.sy:a;s=e,a=n,t.push([i,r,e,n,i===e?"v":"h"])}},d=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},p=function(t){var e=[];return e.push.apply(e,t),e},f=function(t,e,n){for(var i,r,s,a=null,c=0;c<e.length-1;c++){if(a=a||p(e[c]),i=p(e[c+1]),r=u(a),s=u(i),l>0&&a[4]!==i[4]){var h=Math.min(d(a),d(i)),f=Math.min(l,h/2);a[2]-=r[0]*f,a[3]-=r[1]*f,i[0]+=s[0]*f,i[1]+=s[1]*f;var g=r[1]===s[0]&&1===s[0]||r[1]===s[0]&&0===s[0]&&r[0]!==s[1]||r[1]===s[0]&&-1===s[0],m=(i[1]>a[3]?1:-1)==(i[0]>a[2]?1:-1),v=m&&g||!m&&!g?i[0]:a[2],b=m&&g||!m&&!g?a[3]:i[1];o.addSegment(t,"Straight",{x1:a[0],y1:a[1],x2:a[2],y2:a[3]}),o.addSegment(t,"Arc",{r:f,x1:a[2],y1:a[3],x2:i[0],y2:i[1],cx:v,cy:b,ac:g})}else{var y=a[2]===a[0]?0:a[2]>a[0]?n.lw/2:-n.lw/2,P=a[3]===a[1]?0:a[3]>a[1]?n.lw/2:-n.lw/2;o.addSegment(t,"Straight",{x1:a[0]-y,y1:a[1]-P,x2:a[2]+y,y2:a[3]+P})}a=i}null!=i&&o.addSegment(t,"Straight",{x1:i[0],y1:i[1],x2:i[2],y2:i[3]})};this._compute=function(t,e){n=[],s=null,a=null;var l=function(){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},c={perpendicular:l,orthogonal:l,opposite:function(e){var n=t,o="x"===e?0:1;return!r&&{x:function(){return 1===n.so[o]&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||-1===n.so[o]&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return 1===n.so[o]&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||-1===n.so[o]&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}}[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}}[t.anchorOrientation](t.sourceAxis),u="x"===t.sourceAxis?0:1,d="x"===t.sourceAxis?1:0,p=c[u],g=c[d],m=c[u+2],v=c[d+2];h(n,c[0],c[1],t);var b=t.startStubX+(t.endStubX-t.startStubX)*i,y=t.startStubY+(t.endStubY-t.startStubY)*i,P={x:[0,1],y:[1,0]},C={perpendicular:function(e){var n={x:[[t.startStubX,t.endStubX],null,[t.endStubX,t.startStubX]],y:[[t.startStubY,t.endStubY],null,[t.endStubY,t.startStubY]]},o={x:[t.startStubY,t.endStubY],y:[t.startStubX,t.endStubX]},i=P[e][1],r=t.so[P[e][0]]+1,s=-1===t.to[i]&&o[e][1]<o[e][0]||1===t.to[i]&&o[e][1]>o[e][0],a=n[e][r][0],l=n[e][r][1],c={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][r][t.to[i]+1];return t.segment===c[3]||t.segment===c[2]&&s?{x:[[b,t.startStubY],[b,t.endStubY]],y:[[t.startStubX,y],[t.endStubX,y]]}[e]:t.segment===c[2]&&l<a?{x:[[t.endStubX,t.startStubY]],y:[[t.startStubX,t.endStubY]]}[e]:t.segment===c[2]&&l>=a||t.segment===c[1]&&!s?{x:[[t.startStubX,y],[t.endStubX,y],[t.endStubX,t.endStubY]],y:[[b,t.startStubY],[b,t.endStubY],[t.endStubX,t.endStubY]]}[e]:t.segment===c[0]||t.segment===c[1]&&s?{x:[[t.startStubX,t.endStubY],[t.endStubX,t.endStubY]],y:[[t.endStubX,t.startStubY],[t.endStubX,t.endStubY]]}[e]:void 0},orthogonal:function(e,n,o,i,r){var s=t,a={x:-1===s.so[0]?Math.min(n,i):Math.max(n,i),y:-1===s.so[1]?Math.min(n,i):Math.max(n,i)}[e];return{x:[[a,o],[a,r],[i,r]],y:[[o,a],[r,a],[r,i]]}[e]},opposite:function(n,i,r,s){var a=t,l={x:"y",y:"x"}[n],c={x:"height",y:"width"}[n],h=a["is"+n.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var d=r+(1-e.sourceEndpoint.anchor[l])*e.sourceInfo[c]+o.maxStub;return{x:[[i,d],[s,d]],y:[[d,i],[d,s]]}[n]}return!h||1===a.so[u]&&i>s||-1===a.so[u]&&i<s?{x:[[i,y],[s,y]],y:[[b,i],[b,s]]}[n]:1===a.so[u]&&i<s||-1===a.so[u]&&i>s?{x:[[b,a.sy],[b,a.ty]],y:[[a.sx,y],[a.tx,y]]}[n]:void 0}}[t.anchorOrientation](t.sourceAxis,p,g,m,v);if(C)for(var x=0;x<C.length;x++)h(n,C[x][0],C[x][1],t);h(n,c[2],c[3],t),h(n,t.tx,t.ty,t),f(this,n,t)}},e.extend(t.Connectors.Flowchart,t.Connectors.AbstractConnector)}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil;t.Connectors.AbstractBezierConnector=function(e){var n,o=!1!==(e=e||{}).showLoopback,i=e.margin||5,r=e.orientation&&"clockwise"===e.orientation,s=e.loopbackRadius||25;return this._compute=function(t,e){var a=e.sourcePos,l=e.targetPos,c=Math.abs(a[0]-l[0]),u=Math.abs(a[1]-l[1]);if(o&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var h=e.sourcePos[0],d=e.sourcePos[1]-i,p=h,f=d-s,g=p-s,m=f-s;c=2*s,u=2*s,t.points[0]=g,t.points[1]=m,t.points[2]=c,t.points[3]=u,n.addSegment(this,"Arc",{loopback:!0,x1:h-g+4,y1:d-m,startAngle:0,endAngle:2*Math.PI,r:s,ac:!r,x2:h-g-4,y2:d-m,cx:p-g,cy:f-m})}else this._computeBezier(t,e,a,l,c,u)},n=t.Connectors.AbstractConnector.apply(this,arguments)},e.extend(t.Connectors.AbstractBezierConnector,t.Connectors.AbstractConnector);var n=function(e){e=e||{},this.type="Bezier";var n=t.Connectors.AbstractBezierConnector.apply(this,arguments),o=e.curviness||150,i=10;this.getCurviness=function(){return o},this._findControlPoint=function(t,e,n,r,s,a,l){var c=[];return a[0]!==l[0]||a[1]===l[1]?(c.push(0===l[0]?n[0]<e[0]?t[0]+i:t[0]-i:t[0]+o*l[0]),c.push(0===l[1]?n[1]<e[1]?t[1]+i:t[1]-i:t[1]+o*a[1])):(c.push(0===a[0]?e[0]<n[0]?t[0]+i:t[0]-i:t[0]-o*a[0]),c.push(0===a[1]?e[1]<n[1]?t[1]+i:t[1]-i:t[1]+o*l[1])),c},this._computeBezier=function(t,e,o,i,r,s){var a,l,c=o[0]<i[0]?r:0,u=o[1]<i[1]?s:0,h=o[0]<i[0]?0:r,d=o[1]<i[1]?0:s;a=this._findControlPoint([c,u],o,i,e.sourceEndpoint,e.targetEndpoint,t.so,t.to),l=this._findControlPoint([h,d],i,o,e.targetEndpoint,e.sourceEndpoint,t.to,t.so),n.addSegment(this,"Bezier",{x1:c,y1:u,x2:h,y2:d,cp1x:a[0],cp1y:a[1],cp2x:l[0],cp2y:l[1]})}};t.Connectors.Bezier=n,e.extend(n,t.Connectors.AbstractBezierConnector)}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n=function(t,e,n,o){return t<=n&&o<=e?1:t<=n&&e<=o?2:n<=t&&o>=e?3:4},o=function(t,e,n,o,i,r,s,a,l){return a<=l?[t,e]:1===n?o[3]<=0&&i[3]>=1?[t+(o[2]<.5?-1*r:r),e]:o[2]>=1&&i[2]<=0?[t,e+(o[3]<.5?-1*s:s)]:[t+-1*r,e+-1*s]:2===n?o[3]>=1&&i[3]<=0?[t+(o[2]<.5?-1*r:r),e]:o[2]>=1&&i[2]<=0?[t,e+(o[3]<.5?-1*s:s)]:[t+r,e+-1*s]:3===n?o[3]>=1&&i[3]<=0?[t+(o[2]<.5?-1*r:r),e]:o[2]<=0&&i[2]>=1?[t,e+(o[3]<.5?-1*s:s)]:[t+-1*r,e+-1*s]:4===n?o[3]<=0&&i[3]>=1?[t+(o[2]<.5?-1*r:r),e]:o[2]<=0&&i[2]>=1?[t,e+(o[3]<.5?-1*s:s)]:[t+r,e+-1*s]:void 0},i=function(e){e=e||{},this.type="StateMachine";var i,r=t.Connectors.AbstractBezierConnector.apply(this,arguments),s=e.curviness||10,a=e.margin||5,l=e.proximityLimit||80;this._computeBezier=function(t,e,c,u,h,d){var p=e.sourcePos[0]<e.targetPos[0]?0:h,f=e.sourcePos[1]<e.targetPos[1]?0:d,g=e.sourcePos[0]<e.targetPos[0]?h:0,m=e.sourcePos[1]<e.targetPos[1]?d:0;0===e.sourcePos[2]&&(p-=a),1===e.sourcePos[2]&&(p+=a),0===e.sourcePos[3]&&(f-=a),1===e.sourcePos[3]&&(f+=a),0===e.targetPos[2]&&(g-=a),1===e.targetPos[2]&&(g+=a),0===e.targetPos[3]&&(m-=a),1===e.targetPos[3]&&(m+=a);var v=(p+g)/2,b=(f+m)/2,y=n(p,f,g,m),P=Math.sqrt(Math.pow(g-p,2)+Math.pow(m-f,2));i=o(v,b,y,e.sourcePos,e.targetPos,s,s,P,l),r.addSegment(this,"Bezier",{x1:g,y1:m,x2:p,y2:f,cp1x:i[0],cp1y:i[1],cp2x:i[0],cp2y:i[1]})}};t.Connectors.StateMachine=i,e.extend(i,t.Connectors.AbstractBezierConnector)}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n=function(e){this.type="Straight";var n=t.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t,e){n.addSegment(this,"Straight",{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),n.addSegment(this,"Straight",{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),n.addSegment(this,"Straight",{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}};t.Connectors.Straight=n,e.extend(n,t.Connectors.AbstractConnector)}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t=this.jsPlumb,e=this.jsPlumbUtil,n={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},o="http://www.w3.org/2000/svg",i=function(t,e){for(var n in e)t.setAttribute(n,""+e[n])},r=function(e,n){return(n=n||{}).version="1.1",n.xmlns=o,t.createElementNS(o,e,null,null,n)},s=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},a=function(t){for(var e=t.querySelectorAll(" defs,linearGradient,radialGradient"),n=0;n<e.length;n++)e[n].parentNode.removeChild(e[n])},l=function(t,e,o,i,s){if(e.setAttribute("fill",o.fill?o.fill:"none"),e.setAttribute("stroke",o.stroke?o.stroke:"none"),o.gradient?function(t,e,n,o,i){var s,l="jsplumb_gradient_"+i._jsPlumb.instance.idstamp();a(t),s=n.gradient.offset?r("radialGradient",{id:l}):r("linearGradient",{id:l,gradientUnits:"userSpaceOnUse"});var c=r("defs");t.appendChild(c),c.appendChild(s);for(var u=0;u<n.gradient.stops.length;u++){var h=n.gradient.stops[1===i.segment||2===i.segment?u:n.gradient.stops.length-1-u][1],d=r("stop",{offset:Math.floor(100*n.gradient.stops[u][0])+"%","stop-color":h});s.appendChild(d)}e.setAttribute(n.stroke?"stroke":"fill","url(#"+l+")")}(t,e,o,0,s):(a(t),e.setAttribute("style","")),o.strokeWidth&&e.setAttribute("stroke-width",o.strokeWidth),o.dashstyle&&o.strokeWidth&&!o["stroke-dasharray"]){var l=-1===o.dashstyle.indexOf(",")?" ":",",c=o.dashstyle.split(l),u="";c.forEach((function(t){u+=Math.floor(t*o.strokeWidth)+l})),e.setAttribute("stroke-dasharray",u)}else o["stroke-dasharray"]&&e.setAttribute("stroke-dasharray",o["stroke-dasharray"]);for(var h in n)o[h]&&e.setAttribute(n[h],o[h])},c=function(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)};e.svg={node:r,attr:i,pos:s};var u=function(n){var o=n.pointerEventsSpec||"all",a={};t.jsPlumbUIComponent.apply(this,n.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var l=n.cssClass+" "+(n.originalArgs[0].cssClass||"");this.svg=r("svg",{style:"",width:0,height:0,"pointer-events":o,position:"absolute"}),n.useDivWrapper?(this.canvas=t.createElement("div",{position:"absolute"}),e.sizeElement(this.canvas,0,0,1,1),this.canvas.className=l):(i(this.svg,{class:l}),this.canvas=this.svg),n._jsPlumb.appendElement(this.canvas,n.originalArgs[0].parent),n.useDivWrapper&&this.canvas.appendChild(this.svg);var c=[this.canvas];return this.getDisplayElements=function(){return c},this.appendDisplayElement=function(t){c.push(t)},this.paint=function(t,o,r){if(null!=t){var l,c=[this.x,this.y],u=[this.w,this.h];null!=r&&(r.xmin<0&&(c[0]+=r.xmin),r.ymin<0&&(c[1]+=r.ymin),u[0]=r.xmax+(r.xmin<0?-r.xmin:0),u[1]=r.ymax+(r.ymin<0?-r.ymin:0)),n.useDivWrapper?(e.sizeElement(this.canvas,c[0],c[1],u[0]>0?u[0]:1,u[1]>0?u[1]:1),c[0]=0,c[1]=0,l=s([0,0])):l=s([c[0],c[1]]),a.paint.apply(this,arguments),i(this.svg,{style:l,width:u[0]||1,height:u[1]||1})}},{renderer:a}};e.extend(u,t.jsPlumbUIComponent,{cleanup:function(t){t||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(t){var e=t.getContainer();this.canvas&&null==this.canvas.parentNode&&e.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&e.appendChild(this.bgCanvas)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none")}}),t.ConnectorRenderers.svg=function(e){var n=this,o=u.apply(this,[{cssClass:e._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:e._jsPlumb}]);o.renderer.paint=function(o,s,a){var u=n.getSegments(),h=[0,0];if(a.xmin<0&&(h[0]=-a.xmin),a.ymin<0&&(h[1]=-a.ymin),u.length>0){var d={d:n.getPathData(),transform:"translate("+h[0]+","+h[1]+")","pointer-events":e["pointer-events"]||"visibleStroke"},p=null;if(o.outlineStroke){var f=o.strokeWidth+2*(o.outlineWidth||1);delete(p=t.extend({},o)).gradient,p.stroke=o.outlineStroke,p.strokeWidth=f,null==n.bgPath?(n.bgPath=r("path",d),t.addClass(n.bgPath,t.connectorOutlineClass),c(n.svg,n.bgPath,0)):i(n.bgPath,d),l(n.svg,n.bgPath,p,0,n)}null==n.path?(n.path=r("path",d),c(n.svg,n.path,o.outlineStroke?1:0)):i(n.path,d),l(n.svg,n.path,o,0,n)}}},e.extend(t.ConnectorRenderers.svg,u);var h=t.SvgEndpoint=function(e){var n=u.apply(this,[{cssClass:e._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:e._jsPlumb}]);n.renderer.paint=(function(e){var n=t.extend({},e);n.outlineStroke&&(n.stroke=n.outlineStroke),null==this.node?(this.node=this.makeNode(n),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),l(this.svg,this.node,n,0,this),s(this.node)}).bind(this)};e.extend(h,u),t.Endpoints.svg.Dot=function(){t.Endpoints.Dot.apply(this,arguments),h.apply(this,arguments),this.makeNode=function(t){return r("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){i(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},e.extend(t.Endpoints.svg.Dot,[t.Endpoints.Dot,h]),t.Endpoints.svg.Rectangle=function(){t.Endpoints.Rectangle.apply(this,arguments),h.apply(this,arguments),this.makeNode=function(t){return r("rect",{width:this.w,height:this.h})},this.updateNode=function(t){i(t,{width:this.w,height:this.h})}},e.extend(t.Endpoints.svg.Rectangle,[t.Endpoints.Rectangle,h]),t.Endpoints.svg.Image=t.Endpoints.Image,t.Endpoints.svg.Blank=t.Endpoints.Blank,t.Overlays.svg.Label=t.Overlays.Label,t.Overlays.svg.Custom=t.Overlays.Custom;var d=function(e,n){e.apply(this,n),t.jsPlumbUIComponent.apply(this,n),this.isAppendedAtTopLevel=!1,this.path=null,this.paint=function(t,e){if(t.component.svg&&e){null==this.path&&(this.path=r("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,t.component),this.canvas=t.component.svg);var s=n&&1===n.length&&n[0].cssClass||"",a=[0,0];e.xmin<0&&(a[0]=-e.xmin),e.ymin<0&&(a[1]=-e.ymin),i(this.path,{d:o(t.d),class:s,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+a[0]+","+a[1]+")"})}};var o=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){t.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),t.canvas.appendChild(this.path))}},p={cleanup:function(t){null!=this.path&&(t?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(t,e){this.path&&e.canvas&&e.canvas.appendChild(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}};e.extend(d,[t.jsPlumbUIComponent,t.Overlays.AbstractOverlay]),t.Overlays.svg.Arrow=function(){d.apply(this,[t.Overlays.Arrow,arguments])},e.extend(t.Overlays.svg.Arrow,[t.Overlays.Arrow,d],p),t.Overlays.svg.PlainArrow=function(){d.apply(this,[t.Overlays.PlainArrow,arguments])},e.extend(t.Overlays.svg.PlainArrow,[t.Overlays.PlainArrow,d],p),t.Overlays.svg.Diamond=function(){d.apply(this,[t.Overlays.Diamond,arguments])},e.extend(t.Overlays.svg.Diamond,[t.Overlays.Diamond,d],p),t.Overlays.svg.GuideLines=function(){var e,n,o=null,s=this;t.Overlays.GuideLines.apply(this,arguments),this.paint=function(t,l){null==o&&(o=r("path"),t.connector.svg.appendChild(o),s.attachListeners(o,t.connector),s.attachListeners(o,s),e=r("path"),t.connector.svg.appendChild(e),s.attachListeners(e,t.connector),s.attachListeners(e,s),n=r("path"),t.connector.svg.appendChild(n),s.attachListeners(n,t.connector),s.attachListeners(n,s));var c=[0,0];l.xmin<0&&(c[0]=-l.xmin),l.ymin<0&&(c[1]=-l.ymin),i(o,{d:a(t.head,t.tail),stroke:"red",fill:null,transform:"translate("+c[0]+","+c[1]+")"}),i(e,{d:a(t.tailLine[0],t.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+c[0]+","+c[1]+")"}),i(n,{d:a(t.headLine[0],t.headLine[1]),stroke:"green",fill:null,transform:"translate("+c[0]+","+c[1]+")"})};var a=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}},e.extend(t.Overlays.svg.GuideLines,t.Overlays.GuideLines)}).call("undefined"!=typeof window?window:this),(function(){"use strict";var t,e,n=this,o=n.jsPlumb,i=n.jsPlumbUtil,r=n.Katavorio,s=n.Biltong,a=function(t,e){var n="_katavorio_"+(e=e||"main"),i=t[n],a=t.getEventManager();return i||((i=new r({bind:a.on,unbind:a.off,getSize:o.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(e,n){var o=t.getOffset(e,n,e._katavorioDrag?e.offsetParent:null);return[o.left,o.top]},setPosition:function(t,e){t.style.left=e[0]+"px",t.style.top=e[1]+"px"},addClass:o.addClass,removeClass:o.removeClass,intersects:s.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:t.getDefaultScope(),css:{noSelect:t.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(t.getZoom()),t[n]=i,t.bind("zoom",i.setZoom)),i},l=function(t){var e=t.el._jsPlumbDragOptions,n=!0;return e.canDrag&&(n=e.canDrag()),n&&(this.setHoverSuspended(!0),this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.setConnectionBeingDragged(!0)),n},c=function(t){var e=this.getUIPosition(arguments,this.getZoom());if(null!=e){var n=t.el._jsPlumbDragOptions;this.draw(t.el,e,null,!0),n._dragging&&this.addClass(t.el,"jtk-dragged"),n._dragging=!0}},u=function(t){for(var e,n=t.selection,o=(function(t){null!=t[1]&&(e=this.getUIPosition([{el:t[2].el,pos:[t[1].left,t[1].top]}]),this.draw(t[2].el,e)),null!=t[0]._jsPlumbDragOptions&&delete t[0]._jsPlumbDragOptions._dragging,this.removeClass(t[0],"jtk-dragged"),this.select({source:t[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.getDragManager().dragEnded(t[2].el)}).bind(this),i=0;i<n.length;i++)o(n[i]);this.setHoverSuspended(!1),this.setConnectionBeingDragged(!1)},h=function(t,e){if(null==e)return[0,0];var n=m(e),o=g(n,0);return[o[t+"X"],o[t+"Y"]]},d=h.bind(this,"page"),p=h.bind(this,"screen"),f=h.bind(this,"client"),g=function(t,e){return t.item?t.item(e):t[e]},m=function(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]},v=function(t){var e={},n=[],o={},i={},r={};this.register=function(s){var a,l=t.getId(s);e[l]||(e[l]=s,n.push(s),o[l]={});var c=function(e){if(e)for(var n=0;n<e.childNodes.length;n++)if(3!==e.childNodes[n].nodeType&&8!==e.childNodes[n].nodeType){var u=jsPlumb.getElement(e.childNodes[n]),h=t.getId(e.childNodes[n],null,!0);if(h&&i[h]&&i[h]>0){a||(a=t.getOffset(s));var d=t.getOffset(u);o[l][h]={id:h,offset:{left:d.left-a.left,top:d.top-a.top}},r[h]=l}c(e.childNodes[n])}};c(s)},this.updateOffsets=function(e,n){if(null!=e){n=n||{};var i,s=jsPlumb.getElement(e),a=t.getId(s),l=o[a];if(l)for(var c in l)if(l.hasOwnProperty(c)){var u=jsPlumb.getElement(c),h=n[c]||t.getOffset(u);if(null==u.offsetParent&&null!=o[a][c])continue;i||(i=t.getOffset(s)),o[a][c]={id:c,offset:{left:h.left-i.left,top:h.top-i.top}},r[c]=a}}},this.endpointAdded=function(n,s){s=s||t.getId(n);var a=document.body,l=n.parentNode;for(i[s]=i[s]?i[s]+1:1;null!=l&&l!==a;){var c=t.getId(l,null,!0);if(c&&e[c]){var u=t.getOffset(l);if(null==o[c][s]){var h=t.getOffset(n);o[c][s]={id:s,offset:{left:h.left-u.left,top:h.top-u.top}},r[s]=c}break}l=l.parentNode}},this.endpointDeleted=function(t){if(i[t.elementId]&&(i[t.elementId]--,i[t.elementId]<=0))for(var e in o)o.hasOwnProperty(e)&&o[e]&&(delete o[e][t.elementId],delete r[t.elementId])},this.changeId=function(t,e){o[e]=o[t],o[t]={},r[e]=r[t],r[t]=null},this.getElementsForDraggable=function(t){return o[t]},this.elementRemoved=function(t){var e=r[t];e&&(delete o[e][t],delete r[t])},this.reset=function(){e={},n=[],o={},i={}},this.dragEnded=function(e){if(null!=e.offsetParent){var n=t.getId(e),o=r[n];o&&this.updateOffsets(o)}},this.setParent=function(e,n,i,s,a){var l=r[n];o[s]||(o[s]={});var c=t.getOffset(i),u=a||t.getOffset(e);l&&o[l]&&delete o[l][n],o[s][n]={id:n,offset:{left:u.left-c.left,top:u.top-c.top}},r[n]=s},this.clearParent=function(t,e){var n=r[e];n&&(delete o[n][e],delete r[e])},this.revalidateParent=function(e,n,o){var i=r[n];if(i){var s={};s[n]=o,this.updateOffsets(i,s),t.revalidate(i)}},this.getDragAncestor=function(e){var n=jsPlumb.getElement(e),o=t.getId(n),i=r[o];return i?jsPlumb.getElement(i):null}},b=function(t,e,n){e=i.fastTrim(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var o=t.classList;if(null!=o){for(;o.length>0;)o.remove(o.item(0));for(var r=0;r<n.length;r++)n[r]&&o.add(n[r])}}catch(s){i.log("JSPLUMB: cannot set class list",s)}},y=function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal},P=function(t,e,n){e=null==e?[]:i.isArray(e)?e:e.split(/\s+/),n=null==n?[]:i.isArray(n)?n:n.split(/\s+/);var o=y(t).split(/\s+/),r=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===o.indexOf(e[n])&&o.push(e[n]);else{var i=o.indexOf(e[n]);-1!==i&&o.splice(i,1)}};r(!0,e),r(!1,n),b(t,o.join(" "),o)};n.jsPlumb.extend(n.jsPlumbInstance.prototype,{headless:!1,pageLocation:d,screenLocation:p,clientLocation:f,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new v(this)),this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,e,n,o){return this.createElementNS(null,t,e,n,o)},createElementNS:function(t,e,n,o,i){var r,s=null==t?document.createElement(e):document.createElementNS(t,e);for(r in n=n||{})s.style[r]=n[r];for(r in o&&(s.className=o),i=i||{})s.setAttribute(r,""+i[r]);return s},getAttribute:function(t,e){return null!=t.getAttribute?t.getAttribute(e):null},setAttribute:function(t,e,n){null!=t.setAttribute&&t.setAttribute(e,n)},setAttributes:function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:y,addClass:function(t,e){jsPlumb.each(t,(function(t){P(t,e)}))},hasClass:function(t,e){return(t=jsPlumb.getElement(t)).classList?t.classList.contains(e):-1!==y(t).indexOf(e)},removeClass:function(t,e){jsPlumb.each(t,(function(t){P(t,null,e)}))},toggleClass:function(t,e){jsPlumb.hasClass(t,e)?jsPlumb.removeClass(t,e):jsPlumb.addClass(t,e)},updateClasses:function(t,e,n){jsPlumb.each(t,(function(t){P(t,e,n)}))},setClass:function(t,e){null!=e&&jsPlumb.each(t,(function(t){b(t,e,e.split(/\s+/))}))},setPosition:function(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px"},getPosition:function(t){var e=function(e){var n=t.style[e];return n?n.substring(0,n.length-2):0};return{left:e("left"),top:e("top")}},getStyle:function(t,e){return void 0!==window.getComputedStyle?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]},getSelector:function(t,e){return 1===arguments.length?null!=t.nodeType?t:document.querySelectorAll(t):t.querySelectorAll(e)},getOffset:function(t,e,n){t=jsPlumb.getElement(t),n=n||this.getContainer();for(var o={left:t.offsetLeft,top:t.offsetTop},i=e||null!=n&&t!==n&&t.offsetParent!==n?t.offsetParent:null,r=(function(t){null!=t&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(o.left-=t.scrollLeft,o.top-=t.scrollTop)}).bind(this);null!=i;)o.left+=i.offsetLeft,o.top+=i.offsetTop,r(i),i=e?i.offsetParent:i.offsetParent===n?null:i.offsetParent;if(null!=n&&!e&&(n.scrollTop>0||n.scrollLeft>0)){var s=null!=t.offsetParent?this.getStyle(t.offsetParent,"position"):"static",a=this.getStyle(t,"position");"absolute"!==a&&"fixed"!==a&&"absolute"!==s&&"fixed"!==s&&(o.left-=n.scrollLeft,o.top-=n.scrollTop)}return o},getPositionOnElement:function(t,e,n){var o=void 0!==e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},i=document.body,r=document.documentElement,s=window.pageYOffset||r.scrollTop||i.scrollTop,a=window.pageXOffset||r.scrollLeft||i.scrollLeft,l=o.top+s-(r.clientTop||i.clientTop||0)+0*n,c=o.left+a-(r.clientLeft||i.clientLeft||0)+0*n,u=jsPlumb.pageLocation(t);return[(u[0]-c)/(o.width||e.offsetWidth*n),(u[1]-l)/(o.height||e.offsetHeight*n)]},getAbsolutePosition:function(t){var e=function(e){var n=t.style[e];if(n)return parseFloat(n.substring(0,n.length-2))};return[e("left"),e("top")]},setAbsolutePosition:function(t,e,n,o){n?this.animate(t,{left:"+="+(e[0]-n[0]),top:"+="+(e[1]-n[1])},o):(t.style.left=e[0]+"px",t.style.top=e[1]+"px")},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,e){var n;return t=i.isArray(t)||null!=t.length&&!i.isString(t)?t:[t],Array.prototype.slice.call(t).forEach((function(t){(n=this.info(t)).el&&this._initDraggableIfNecessary(n.el,!0,e,n.id,!0)}).bind(this)),this},snapToGrid:function(t,e,n){var o=[],i=(function(t){var i=this.info(t);if(null!=i.el&&i.el._katavorioDrag){var r=i.el._katavorioDrag.snap(e,n);this.revalidate(i.el),o.push([i.el,r])}}).bind(this);if(1===arguments.length||3===arguments.length)i(t,e,n);else{var r=this.getManagedElements();for(var s in r)i(s,arguments[0],arguments[1])}return o},initDraggable:function(t,e,n){a(this,n).draggable(t,e),t._jsPlumbDragOptions=e},destroyDraggable:function(t,e){a(this,e).destroyDraggable(t),delete t._jsPlumbDragOptions},unbindDraggable:function(t,e,n,o){a(this,o).destroyDraggable(t,e,n)},setDraggable:function(t,e){return jsPlumb.each(t,(function(t){this.isDragSupported(t)&&(this._draggableStates[this.getAttribute(t,"id")]=e,this.setElementDraggable(t,e))}).bind(this))},_draggableStates:{},toggleDraggable:function(t){var e;return jsPlumb.each(t,(function(t){var n=this.getAttribute(t,"id");return this._draggableStates[n]=e=!(e=null!=this._draggableStates[n]&&this._draggableStates[n]),this.setDraggable(t,e),e}).bind(this)),e},_initDraggableIfNecessary:function(t,e,n,o,r){if(!jsPlumb.headless&&null!=e&&e&&jsPlumb.isDragSupported(t,this)){var s=n||this.Defaults.DragOptions;if(s=jsPlumb.extend({},s),jsPlumb.isAlreadyDraggable(t,this))n.force&&this.initDraggable(t,s);else{var a=jsPlumb.dragEvents.drag,h=jsPlumb.dragEvents.stop,d=jsPlumb.dragEvents.start;this.manage(o,t),s[d]=i.wrap(s[d],l.bind(this)),s[a]=i.wrap(s[a],c.bind(this)),s[h]=i.wrap(s[h],u.bind(this));var p=this.getId(t);this._draggableStates[p]=!0;var f=this._draggableStates[p];s.disabled=null!=f&&!f,this.initDraggable(t,s),this.getDragManager().register(t),r&&this.fire("elementDraggable",{el:t,options:s})}}},animationSupported:!0,getElement:function(t){return null==t?null:"string"==typeof(t="string"==typeof t?t:null!=t.length&&null==t.enctype?t[0]:t)?document.getElementById(t):t},removeElement:function(t){a(this).elementRemoved(t),this.getEventManager().remove(t)},doAnimate:function(t,e,n){n=n||{};var r=this.getOffset(t),s=function(t,e){var n=function(n){if(null!=e[n]){if(i.isString(e[n])){var o=e[n].match(/-=/)?-1:1,r=e[n].substring(2);return t[n]+o*r}return e[n]}return t[n]};return[n("left"),n("top")]}(r,e),a=n.duration||250,l=a/15,c=15/a*(s[0]-r.left),u=15/a*(s[1]-r.top),h=0,d=setInterval((function(){o.setPosition(t,{left:r.left+c*(h+1),top:r.top+u*(h+1)}),null!=n.step&&n.step(h,Math.ceil(l)),++h>=l&&(window.clearInterval(d),null!=n.complete&&n.complete())}),15)},destroyDroppable:function(t,e){a(this,e).destroyDroppable(t)},unbindDroppable:function(t,e,n,o){a(this,o).destroyDroppable(t,e,n)},droppable:function(t,e){var n;return t=i.isArray(t)||null!=t.length&&!i.isString(t)?t:[t],(e=e||{}).allowLoopback=!1,Array.prototype.slice.call(t).forEach((function(t){(n=this.info(t)).el&&this.initDroppable(n.el,e)}).bind(this)),this},initDroppable:function(t,e,n){a(this,n).droppable(t,e)},isAlreadyDraggable:function(t){return null!=t._katavorioDrag},isDragSupported:function(t,e){return!0},isDropSupported:function(t,e){return!0},isElementDraggable:function(t){return(t=o.getElement(t))._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t,e){var n=t[0].el;if(null==n.offsetParent)return null;var o=t[0].finalPos||t[0].pos,i={left:o[0],top:o[1]};if(n._katavorioDrag&&n.offsetParent!==this.getContainer()){var r=this.getOffset(n.offsetParent);i.left+=r.left,i.top+=r.top}return i},setDragFilter:function(t,e,n){t._katavorioDrag&&t._katavorioDrag.setFilter(e,n)},setElementDraggable:function(t,e){(t=o.getElement(t))._katavorioDrag&&t._katavorioDrag.setEnabled(e)},setDragScope:function(t,e){t._katavorioDrag&&t._katavorioDrag.k.setDragScope(t,e)},setDropScope:function(t,e){t._katavorioDrop&&t._katavorioDrop.length>0&&t._katavorioDrop[0].k.setDropScope(t,e)},addToPosse:function(t,e){var n=Array.prototype.slice.call(arguments,1),i=a(this);o.each(t,(function(t){(t=[o.getElement(t)]).push.apply(t,n),i.addToPosse.apply(i,t)}))},setPosse:function(t,e){var n=Array.prototype.slice.call(arguments,1),i=a(this);o.each(t,(function(t){(t=[o.getElement(t)]).push.apply(t,n),i.setPosse.apply(i,t)}))},removeFromPosse:function(t,e){var n=Array.prototype.slice.call(arguments,1),i=a(this);o.each(t,(function(t){(t=[o.getElement(t)]).push.apply(t,n),i.removeFromPosse.apply(i,t)}))},removeFromAllPosses:function(t){var e=a(this);o.each(t,(function(t){e.removeFromAllPosses(o.getElement(t))}))},setPosseState:function(t,e,n){var i=a(this);o.each(t,(function(t){i.setPosseState(o.getElement(t),e,n)}))},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){t._katavorioDrag&&t._katavorioDrag.abort()},addToDragSelection:function(t){var e=this.getElement(t);null==e||!e._isJsPlumbGroup&&null!=e._jsPlumbGroup||a(this).select(t)},removeFromDragSelection:function(t){a(this).deselect(t)},getDragSelection:function(){return a(this).getSelection()},clearDragSelection:function(){a(this).deselectAll()},trigger:function(t,e,n,o){this.getEventManager().trigger(t,e,n,o)},doReset:function(){for(var t in this)0===t.indexOf("_katavorio_")&&this[t].reset()},getEventManager:function(){return(t=this._mottle)||(t=this._mottle=new n.Mottle),t;var t},on:function(t,e,n){return this.getEventManager().on.apply(this,arguments),this},off:function(t,e,n){return this.getEventManager().off.apply(this,arguments),this}}),t=o.init,(e=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(e,9)})()}).call("undefined"!=typeof window?window:this)},ALb8:function(t,e,n){"use strict";n.r(e),n.d(e,"EditorModule",(function(){return Bt}));var o=n("nIj0"),i=n("hctd"),r=n("2kYt"),s=n("EM62");let a=(()=>{class t{}return t.\u0275mod=s.Jb({type:t}),t.\u0275inj=s.Ib({factory:function(e){return new(e||t)},imports:[[r.c,i.a,o.i]]}),t})();var l=n("rWMW"),c=n("sEIs"),u=n("A2ki"),h=n("OZ4H"),d=n("29Wa"),p=n("Cd2c"),f=n("PBFl");function g(t,e){1&t&&(s.Qb(0,"mat-error"),s.qc(1," Name is "),s.Qb(2,"strong"),s.qc(3,"required"),s.Pb(),s.Pb())}function m(t,e){if(1&t){const t=s.Rb();s.Ob(0),s.Qb(1,"div",1),s.Qb(2,"div",2),s.qc(3),s.Pb(),s.Qb(4,"form",3),s.Qb(5,"div",4),s.Qb(6,"mat-form-field",5),s.Qb(7,"mat-label"),s.qc(8,"Name"),s.Pb(),s.Mb(9,"input",6),s.pc(10,g,4,0,"mat-error",0),s.Pb(),s.Pb(),s.Qb(11,"div",7),s.Qb(12,"button",8),s.qc(13,"Cancel"),s.Pb(),s.Qb(14,"button",9),s.Xb("click",(function(){return s.jc(t),s.bc().save()})),s.qc(15," Save "),s.Pb(),s.Pb(),s.Pb(),s.Pb(),s.Nb()}if(2&t){const t=s.bc();s.zb(3),s.sc(" ",null==t.node||null==t.node.type?null:t.node.type.name," "),s.zb(1),s.gc("formGroup",t.nodeForm),s.zb(5),s.gc("formControlName","name"),s.zb(1),s.gc("ngIf",t.nodeForm.get("name").hasError("required")),s.zb(4),s.gc("disabled",t.nodeForm.invalid)}}let v=(()=>{class t{constructor(t,e,n){this.formBuilder=t,this.dialogRef=e,this.data=n,this.nodeForm=this.formBuilder.group({name:[this.node.name,o.j.required]})}get node(){return this.data.node}ngOnInit(){}save(){this.data.node=Object.assign(this.data.node,this.nodeForm.value),this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(o.b),s.Lb(h.f),s.Lb(h.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-node-editor"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"op-node-editor"],[1,"op-node-title"],[3,"formGroup"],[1,"op-node-form"],[1,"op-full-width"],["matInput","","placeholder","Name of the node",3,"formControlName"],[1,"op-node-editor-actions"],["mat-button","","mat-dialog-actions","","mat-dialog-close",""],["mat-button","","mat-dialog-actions","","color","primary",3,"disabled","click"]],template:function(t,e){1&t&&s.pc(0,m,16,5,"ng-container",0),2&t&&s.gc("ngIf",e.node)},directives:[r.j,o.k,o.g,o.d,d.b,d.e,p.a,o.a,o.f,o.c,f.a,h.c,h.d,d.a],styles:[".op-node-editor{padding:16px}.op-node-editor .op-node-title{text-align:center;font-weight:500;font-size:16pt}.op-node-editor .mat-form-field.op-full-width{width:100%}"],encapsulation:2}),t})();var b=n("ODsK"),y=n("ZTXN"),P=n("vobO");function C(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function a(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))}var x,_=(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),S=function(t){function e(e,n){var o=this,i=this.constructor.prototype;return(o=t.call(this,e)||this).statusCode=n,o.__proto__=i,o}return _(e,t),e}(Error),w=function(t){function e(e){void 0===e&&(e="A timeout occurred.");var n=this,o=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=o,n}return _(e,t),e}(Error),E=function(t){function e(e){void 0===e&&(e="An abort occurred.");var n=this,o=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=o,n}return _(e,t),e}(Error),j=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},D=function(){return function(t,e,n){this.statusCode=t,this.statusText=e,this.content=n}}(),k=function(){function t(){}return t.prototype.get=function(t,e){return this.send(j({},e,{method:"GET",url:t}))},t.prototype.post=function(t,e){return this.send(j({},e,{method:"POST",url:t}))},t.prototype.delete=function(t,e){return this.send(j({},e,{method:"DELETE",url:t}))},t.prototype.getCookieString=function(t){return""},t}(),I=function(t){return t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None",t}({}),O=function(){function t(){}return t.prototype.log=function(t,e){},t.instance=new t,t}(),T=function(){function t(){}return t.isRequired=function(t,e){if(null==t)throw new Error("The '"+e+"' argument is required.")},t.isIn=function(t,e,n){if(!(t in e))throw new Error("Unknown "+n+" value: "+t+".")},t}(),A=function(){function t(){}return Object.defineProperty(t,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),t}();function M(t,e){var n="";return L(t)?(n="Binary data of length "+t.byteLength,e&&(n+=". Content: '"+function(t){var e=new Uint8Array(t),n="";return e.forEach((function(t){n+="0x"+(t<16?"0":"")+t.toString(16)+" "})),n.substr(0,n.length-1)}(t)+"'")):"string"==typeof t&&(n="String data of length "+t.length,e&&(n+=". Content: '"+t+"'")),n}function L(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function F(t,e,n,o,i,r,s){return a=this,void 0,c=function(){var a,l,c,u,h;return function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(d){switch(d.label){case 0:return i?[4,i()]:[3,2];case 1:(c=d.sent())&&((a={}).Authorization="Bearer "+c,l=a),d.label=2;case 2:return t.log(I.Trace,"("+e+" transport) sending data. "+M(r,s)+"."),u=L(r)?"arraybuffer":"text",[4,n.post(o,{content:r,headers:l,responseType:u})];case 3:return h=d.sent(),t.log(I.Trace,"("+e+" transport) request complete. Response status: "+h.statusCode+"."),[2]}}))},new((l=void 0)||(l=Promise))((function(t,e){function n(t){try{i(c.next(t))}catch(n){e(n)}}function o(t){try{i(c.throw(t))}catch(n){e(n)}}function i(e){e.done?t(e.value):new l((function(t){t(e.value)})).then(n,o)}i((c=c.apply(a,[])).next())}));var a,l,c}var N,R=function(){function t(t,e){this.subject=t,this.observer=e}return t.prototype.dispose=function(){var t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch((function(t){}))},t}(),H=function(){function t(t){this.minimumLogLevel=t,this.outputConsole=console}return t.prototype.log=function(t,e){if(t>=this.minimumLogLevel)switch(t){case I.Critical:case I.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+I[t]+": "+e);break;case I.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+I[t]+": "+e);break;case I.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+I[t]+": "+e);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+I[t]+": "+e)}},t}(),U=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};if("undefined"==typeof XMLHttpRequest){var B=require;N=B("request")}var W=function(t){function e(e){var n=t.call(this)||this;if(void 0===N)throw new Error("The 'request' module could not be loaded.");return n.logger=e,n.cookieJar=N.jar(),n.request=N.defaults({jar:n.cookieJar}),n}return U(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new E):new Promise((function(n,o){var i;i=L(t.content)?Buffer.from(t.content):t.content||"";var r=e.request(t.url,{body:i,encoding:"arraybuffer"===t.responseType?null:"utf8",headers:G({"X-Requested-With":"XMLHttpRequest"},t.headers),method:t.method,timeout:t.timeout},(function(i,r,s){if(t.abortSignal&&(t.abortSignal.onabort=null),i)return"ETIMEDOUT"===i.code&&(e.logger.log(I.Warning,"Timeout from HTTP request."),o(new w)),e.logger.log(I.Warning,"Error from HTTP request. "+i),void o(i);r.statusCode>=200&&r.statusCode<300?n(new D(r.statusCode,r.statusMessage||"",s)):o(new S(r.statusMessage||"",r.statusCode||0))}));t.abortSignal&&(t.abortSignal.onabort=function(){r.abort(),o(new E)})}))},e.prototype.getCookieString=function(t){return this.cookieJar.getCookieString(t)},e}(k),X=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),q=function(t){function e(e){var n=t.call(this)||this;return n.logger=e,n}return X(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new E):t.method?t.url?new Promise((function(n,o){var i=new XMLHttpRequest;i.open(t.method,t.url,!0),i.withCredentials=!0,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var r=t.headers;r&&Object.keys(r).forEach((function(t){i.setRequestHeader(t,r[t])})),t.responseType&&(i.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=function(){i.abort(),o(new E)}),t.timeout&&(i.timeout=t.timeout),i.onload=function(){t.abortSignal&&(t.abortSignal.onabort=null),i.status>=200&&i.status<300?n(new D(i.status,i.statusText,i.response||i.responseText)):o(new S(i.statusText,i.status))},i.onerror=function(){e.logger.log(I.Warning,"Error from HTTP request. "+i.status+": "+i.statusText+"."),o(new S(i.statusText,i.status))},i.ontimeout=function(){e.logger.log(I.Warning,"Timeout from HTTP request."),o(new w)},i.send(t.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e}(k),Y=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),z=function(t){function e(e){var n=t.call(this)||this;return n.httpClient="undefined"!=typeof XMLHttpRequest?new q(e):new W(e),n}return Y(e,t),e.prototype.send=function(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new E):t.method?t.url?this.httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e.prototype.getCookieString=function(t){return this.httpClient.getCookieString(t)},e}(k),V=function(){function t(){}return t.write=function(e){return""+e+t.RecordSeparator},t.parse=function(e){if(e[e.length-1]!==t.RecordSeparator)throw new Error("Message is incomplete.");var n=e.split(t.RecordSeparator);return n.pop(),n},t.RecordSeparatorCode=30,t.RecordSeparator=String.fromCharCode(t.RecordSeparatorCode),t}(),Q=function(){function t(){}return t.prototype.writeHandshakeRequest=function(t){return V.write(JSON.stringify(t))},t.prototype.parseHandshakeResponse=function(t){var e,n;if(L(t)||"undefined"!=typeof Buffer&&t instanceof Buffer){var o=new Uint8Array(t);if(-1===(r=o.indexOf(V.RecordSeparatorCode)))throw new Error("Message is incomplete.");var i=r+1;e=String.fromCharCode.apply(null,o.slice(0,i)),n=o.byteLength>i?o.slice(i).buffer:null}else{var r,s=t;if(-1===(r=s.indexOf(V.RecordSeparator)))throw new Error("Message is incomplete.");e=s.substring(0,i=r+1),n=s.length>i?s.substring(i):null}var a=V.parse(e),l=JSON.parse(a[0]);if(l.type)throw new Error("Expected a handshake response from the server.");return[n,l]},t}(),J=function(t){return t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close",t}({}),K=function(){function t(){this.observers=[]}return t.prototype.next=function(t){for(var e=0,n=this.observers;e<n.length;e++)n[e].next(t)},t.prototype.error=function(t){for(var e=0,n=this.observers;e<n.length;e++){var o=n[e];o.error&&o.error(t)}},t.prototype.complete=function(){for(var t=0,e=this.observers;t<e.length;t++){var n=e[t];n.complete&&n.complete()}},t.prototype.subscribe=function(t){return this.observers.push(t),new R(this,t)},t}(),Z=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function a(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}l((o=o.apply(t,e||[])).next())}))},$=function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},tt=function(t){return t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting",t}({}),et=function(){function t(t,e,n,o){var i=this;T.isRequired(t,"connection"),T.isRequired(e,"logger"),T.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=e,this.protocol=n,this.connection=t,this.reconnectPolicy=o,this.handshakeProtocol=new Q,this.connection.onreceive=function(t){return i.processIncomingData(t)},this.connection.onclose=function(t){return i.connectionClosed(t)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=tt.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:J.Ping})}return t.create=function(e,n,o,i){return new t(e,n,o,i)},Object.defineProperty(t.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(t){if(this.connectionState!==tt.Disconnected&&this.connectionState!==tt.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t},enumerable:!0,configurable:!0}),t.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},t.prototype.startWithStateTransitions=function(){return Z(this,void 0,void 0,(function(){var t;return $(this,(function(e){switch(e.label){case 0:if(this.connectionState!==tt.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=tt.Connecting,this.logger.log(I.Debug,"Starting HubConnection."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return e.sent(),this.connectionState=tt.Connected,this.connectionStarted=!0,this.logger.log(I.Debug,"HubConnection connected successfully."),[3,4];case 3:return t=e.sent(),this.connectionState=tt.Disconnected,this.logger.log(I.Debug,"HubConnection failed to start successfully because of error '"+t+"'."),[2,Promise.reject(t)];case 4:return[2]}}))}))},t.prototype.startInternal=function(){return Z(this,void 0,void 0,(function(){var t,e,n,o=this;return $(this,(function(i){switch(i.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise((function(t,e){o.handshakeResolver=t,o.handshakeRejecter=e})),[4,this.connection.start(this.protocol.transferFormat)];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,5,,7]),e={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(I.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(e))];case 3:return i.sent(),this.logger.log(I.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(i.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return n=i.sent(),this.logger.log(I.Debug,"Hub handshake failed with error '"+n+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(n)];case 6:throw i.sent(),n;case 7:return[2]}}))}))},t.prototype.stop=function(){return Z(this,void 0,void 0,(function(){var t;return $(this,(function(e){switch(e.label){case 0:return t=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,t];case 3:case 4:return e.sent(),[3,5];case 5:return[2]}}))}))},t.prototype.stopInternal=function(t){return this.connectionState===tt.Disconnected?(this.logger.log(I.Debug,"Call to HubConnection.stop("+t+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===tt.Disconnecting?(this.logger.log(I.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=tt.Disconnecting,this.logger.log(I.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(I.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))},t.prototype.stream=function(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i,r=this.replaceStreamingParams(n),s=r[0],a=r[1],l=this.createStreamInvocation(t,n,a),c=new K;return c.cancelCallback=function(){var t=e.createCancelInvocation(l.invocationId);return delete e.callbacks[l.invocationId],i.then((function(){return e.sendWithProtocol(t)}))},this.callbacks[l.invocationId]=function(t,e){e?c.error(e):t&&(t.type===J.Completion?t.error?c.error(new Error(t.error)):c.complete():c.next(t.item))},i=this.sendWithProtocol(l).catch((function(t){c.error(t),delete e.callbacks[l.invocationId]})),this.launchStreams(s,i),c},t.prototype.sendMessage=function(t){return this.resetKeepAliveInterval(),this.connection.send(t)},t.prototype.sendWithProtocol=function(t){return this.sendMessage(this.protocol.writeMessage(t))},t.prototype.send=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=this.replaceStreamingParams(e),i=o[0],r=o[1],s=this.sendWithProtocol(this.createInvocation(t,e,!0,r));return this.launchStreams(i,s),s},t.prototype.invoke=function(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i=this.replaceStreamingParams(n),r=i[0],s=i[1],a=this.createInvocation(t,n,!1,s),l=new Promise((function(t,n){e.callbacks[a.invocationId]=function(e,o){o?n(o):e&&(e.type===J.Completion?e.error?n(new Error(e.error)):t(e.result):n(new Error("Unexpected message type: "+e.type)))};var o=e.sendWithProtocol(a).catch((function(t){n(t),delete e.callbacks[a.invocationId]}));e.launchStreams(r,o)}));return l},t.prototype.on=function(t,e){t&&e&&(t=t.toLowerCase(),this.methods[t]||(this.methods[t]=[]),-1===this.methods[t].indexOf(e)&&this.methods[t].push(e))},t.prototype.off=function(t,e){if(t){t=t.toLowerCase();var n=this.methods[t];if(n)if(e){var o=n.indexOf(e);-1!==o&&(n.splice(o,1),0===n.length&&delete this.methods[t])}else delete this.methods[t]}},t.prototype.onclose=function(t){t&&this.closedCallbacks.push(t)},t.prototype.onreconnecting=function(t){t&&this.reconnectingCallbacks.push(t)},t.prototype.onreconnected=function(t){t&&this.reconnectedCallbacks.push(t)},t.prototype.processIncomingData=function(t){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(t=this.processHandshakeResponse(t),this.receivedHandshakeResponse=!0),t)for(var e=0,n=this.protocol.parseMessages(t,this.logger);e<n.length;e++){var o=n[e];switch(o.type){case J.Invocation:this.invokeClientMethod(o);break;case J.StreamItem:case J.Completion:var i=this.callbacks[o.invocationId];i&&(o.type===J.Completion&&delete this.callbacks[o.invocationId],i(o));break;case J.Ping:break;case J.Close:this.logger.log(I.Information,"Close message received from server.");var r=o.error?new Error("Server returned an error on close: "+o.error):void 0;!0===o.allowReconnect?this.connection.stop(r):this.stopPromise=this.stopInternal(r);break;default:this.logger.log(I.Warning,"Invalid message type: "+o.type+".")}}this.resetTimeoutPeriod()},t.prototype.processHandshakeResponse=function(t){var e,n,o,i;try{o=(e=this.handshakeProtocol.parseHandshakeResponse(t))[0],n=e[1]}catch(s){this.logger.log(I.Error,i="Error parsing handshake response: "+s);var r=new Error(i);throw this.handshakeRejecter(r),r}if(n.error)throw this.logger.log(I.Error,i="Server returned handshake error: "+n.error),r=new Error(i),this.handshakeRejecter(r),r;return this.logger.log(I.Debug,"Server handshake complete."),this.handshakeResolver(),o},t.prototype.resetKeepAliveInterval=function(){var t=this;this.cleanupPingTimer(),this.pingServerHandle=setTimeout((function(){return Z(t,void 0,void 0,(function(){return $(this,(function(t){switch(t.label){case 0:if(this.connectionState!==tt.Connected)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}}))}))}),this.keepAliveIntervalInMilliseconds)},t.prototype.resetTimeoutPeriod=function(){var t=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout((function(){return t.serverTimeout()}),this.serverTimeoutInMilliseconds))},t.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},t.prototype.invokeClientMethod=function(t){var e=this,n=this.methods[t.target.toLowerCase()];if(n){try{n.forEach((function(n){return n.apply(e,t.arguments)}))}catch(i){this.logger.log(I.Error,"A callback for the method "+t.target.toLowerCase()+" threw error '"+i+"'.")}if(t.invocationId){var o="Server requested a response, which is not supported in this version of the client.";this.logger.log(I.Error,o),this.stopPromise=this.stopInternal(new Error(o))}}else this.logger.log(I.Warning,"No client method with the name '"+t.target+"' found.")},t.prototype.connectionClosed=function(t){this.logger.log(I.Debug,"HubConnection.connectionClosed("+t+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===tt.Disconnecting?this.completeClose(t):this.connectionState===tt.Connected&&this.reconnectPolicy?this.reconnect(t):this.connectionState===tt.Connected&&this.completeClose(t)},t.prototype.completeClose=function(t){var e=this;if(this.connectionStarted){this.connectionState=tt.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach((function(n){return n.apply(e,[t])}))}catch(n){this.logger.log(I.Error,"An onclose callback called with error '"+t+"' threw error '"+n+"'.")}}},t.prototype.reconnect=function(t){return Z(this,void 0,void 0,(function(){var e,n,o,i,r,s=this;return $(this,(function(a){switch(a.label){case 0:if(e=Date.now(),n=0,o=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),null===(i=this.getNextRetryDelay(n++,0,o)))return this.logger.log(I.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(t),[2];if(this.connectionState=tt.Reconnecting,this.logger.log(I.Information,t?"Connection reconnecting because of error '"+t+"'.":"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach((function(e){return e.apply(s,[t])}))}catch(l){this.logger.log(I.Error,"An onreconnecting callback called with error '"+t+"' threw error '"+l+"'.")}if(this.connectionState!==tt.Reconnecting)return this.logger.log(I.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}a.label=1;case 1:return null===i?[3,7]:(this.logger.log(I.Information,"Reconnect attempt number "+n+" will start in "+i+" ms."),[4,new Promise((function(t){s.reconnectDelayHandle=setTimeout(t,i)}))]);case 2:if(a.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==tt.Reconnecting)return this.logger.log(I.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(a.sent(),this.connectionState=tt.Connected,this.logger.log(I.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach((function(t){return t.apply(s,[s.connection.connectionId])}))}catch(l){this.logger.log(I.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+l+"'.")}return[2];case 5:return r=a.sent(),this.logger.log(I.Information,"Reconnect attempt failed because of error '"+r+"'."),this.connectionState!==tt.Reconnecting?(this.logger.log(I.Debug,"Connection left the reconnecting state during reconnect attempt. Done reconnecting."),[2]):(o=r instanceof Error?r:new Error(r.toString()),i=this.getNextRetryDelay(n++,Date.now()-e,o),[3,6]);case 6:return[3,1];case 7:return this.logger.log(I.Information,"Reconnect retries have been exhausted after "+(Date.now()-e)+" ms and "+n+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}}))}))},t.prototype.getNextRetryDelay=function(t,e,n){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:n})}catch(o){return this.logger.log(I.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+t+", "+e+") threw error '"+o+"'."),null}},t.prototype.cancelCallbacksWithError=function(t){var e=this.callbacks;this.callbacks={},Object.keys(e).forEach((function(n){(0,e[n])(null,t)}))},t.prototype.cleanupPingTimer=function(){this.pingServerHandle&&clearTimeout(this.pingServerHandle)},t.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},t.prototype.createInvocation=function(t,e,n,o){if(n)return{arguments:e,streamIds:o,target:t,type:J.Invocation};var i=this.invocationId;return this.invocationId++,{arguments:e,invocationId:i.toString(),streamIds:o,target:t,type:J.Invocation}},t.prototype.launchStreams=function(t,e){var n=this;if(0!==t.length){e||(e=Promise.resolve());var o=function(o){t[o].subscribe({complete:function(){e=e.then((function(){return n.sendWithProtocol(n.createCompletionMessage(o))}))},error:function(t){var i;i=t instanceof Error?t.message:t&&t.toString?t.toString():"Unknown error",e=e.then((function(){return n.sendWithProtocol(n.createCompletionMessage(o,i))}))},next:function(t){e=e.then((function(){return n.sendWithProtocol(n.createStreamItemMessage(o,t))}))}})};for(var i in t)o(i)}},t.prototype.replaceStreamingParams=function(t){for(var e=[],n=[],o=0;o<t.length;o++){var i=t[o];if(this.isObservable(i)){var r=this.invocationId;this.invocationId++,e[r]=i,n.push(r.toString()),t.splice(o,1)}}return[e,n]},t.prototype.isObservable=function(t){return t&&t.subscribe&&"function"==typeof t.subscribe},t.prototype.createStreamInvocation=function(t,e,n){var o=this.invocationId;return this.invocationId++,{arguments:e,invocationId:o.toString(),streamIds:n,target:t,type:J.StreamInvocation}},t.prototype.createCancelInvocation=function(t){return{invocationId:t,type:J.CancelInvocation}},t.prototype.createStreamItemMessage=function(t,e){return{invocationId:t,item:e,type:J.StreamItem}},t.prototype.createCompletionMessage=function(t,e,n){return e?{error:e,invocationId:t,type:J.Completion}:{invocationId:t,result:n,type:J.Completion}},t}(),nt=[0,2e3,1e4,3e4,null],ot=function(){function t(t){this.retryDelays=void 0!==t?t.concat([null]):nt}return t.prototype.nextRetryDelayInMilliseconds=function(t){return this.retryDelays[t.previousRetryCount]},t}(),it=function(t){return t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling",t}({}),rt=function(t){return t[t.Text=1]="Text",t[t.Binary=2]="Binary",t}({}),st=function(){function t(){this.isAborted=!1,this.onabort=null}return t.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(t.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),t}(),at=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function a(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}l((o=o.apply(t,e||[])).next())}))},lt=function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},ct=function(){function t(t,e,n,o){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.pollAbort=new st,this.logMessageContent=o,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(t.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),t.prototype.connect=function(t,e){return at(this,void 0,void 0,(function(){var n,o,i,r;return lt(this,(function(s){switch(s.label){case 0:if(T.isRequired(t,"url"),T.isRequired(e,"transferFormat"),T.isIn(e,rt,"transferFormat"),this.url=t,this.logger.log(I.Trace,"(LongPolling transport) Connecting."),e===rt.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return n={abortSignal:this.pollAbort.signal,headers:{},timeout:1e5},e===rt.Binary&&(n.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return o=s.sent(),this.updateHeaderToken(n,o),i=t+"&_="+Date.now(),this.logger.log(I.Trace,"(LongPolling transport) polling: "+i+"."),[4,this.httpClient.get(i,n)];case 2:return 200!==(r=s.sent()).statusCode?(this.logger.log(I.Error,"(LongPolling transport) Unexpected response code: "+r.statusCode+"."),this.closeError=new S(r.statusText||"",r.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,n),[2]}}))}))},t.prototype.getAccessToken=function(){return at(this,void 0,void 0,(function(){return lt(this,(function(t){switch(t.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}}))}))},t.prototype.updateHeaderToken=function(t,e){t.headers||(t.headers={}),e?t.headers.Authorization="Bearer "+e:t.headers.Authorization&&delete t.headers.Authorization},t.prototype.poll=function(t,e){return at(this,void 0,void 0,(function(){var n,o,i,r;return lt(this,(function(s){switch(s.label){case 0:s.trys.push([0,,8,9]),s.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:n=s.sent(),this.updateHeaderToken(e,n),s.label=3;case 3:return s.trys.push([3,5,,6]),o=t+"&_="+Date.now(),this.logger.log(I.Trace,"(LongPolling transport) polling: "+o+"."),[4,this.httpClient.get(o,e)];case 4:return 204===(i=s.sent()).statusCode?(this.logger.log(I.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==i.statusCode?(this.logger.log(I.Error,"(LongPolling transport) Unexpected response code: "+i.statusCode+"."),this.closeError=new S(i.statusText||"",i.statusCode),this.running=!1):i.content?(this.logger.log(I.Trace,"(LongPolling transport) data received. "+M(i.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(i.content)):this.logger.log(I.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return r=s.sent(),this.running?r instanceof w?this.logger.log(I.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=r,this.running=!1):this.logger.log(I.Trace,"(LongPolling transport) Poll errored after shutdown: "+r.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(I.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}}))}))},t.prototype.send=function(t){return at(this,void 0,void 0,(function(){return lt(this,(function(e){return this.running?[2,F(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},t.prototype.stop=function(){return at(this,void 0,void 0,(function(){var t,e;return lt(this,(function(n){switch(n.label){case 0:this.logger.log(I.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),n.label=1;case 1:return n.trys.push([1,,5,6]),[4,this.receiving];case 2:return n.sent(),this.logger.log(I.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={headers:{}},[4,this.getAccessToken()];case 3:return e=n.sent(),this.updateHeaderToken(t,e),[4,this.httpClient.delete(this.url,t)];case 4:return n.sent(),this.logger.log(I.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(I.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}}))}))},t.prototype.raiseOnClose=function(){if(this.onclose){var t="(LongPolling transport) Firing onclose event.";this.closeError&&(t+=" Error: "+this.closeError),this.logger.log(I.Trace,t),this.onclose(this.closeError)}},t}(),ut=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function a(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}l((o=o.apply(t,e||[])).next())}))},ht=function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},dt=function(){function t(t,e,n,o,i){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.logMessageContent=o,this.eventSourceConstructor=i,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return ut(this,void 0,void 0,(function(){var n,o=this;return ht(this,(function(i){switch(i.label){case 0:return T.isRequired(t,"url"),T.isRequired(e,"transferFormat"),T.isIn(e,rt,"transferFormat"),this.logger.log(I.Trace,"(SSE transport) Connecting."),this.url=t,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=i.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),i.label=2;case 2:return[2,new Promise((function(n,i){var r=!1;if(e===rt.Text){var s;if(A.isBrowser||A.isWebWorker)s=new o.eventSourceConstructor(t,{withCredentials:!0});else{var a=o.httpClient.getCookieString(t);s=new o.eventSourceConstructor(t,{withCredentials:!0,headers:{Cookie:a}})}try{s.onmessage=function(t){if(o.onreceive)try{o.logger.log(I.Trace,"(SSE transport) data received. "+M(t.data,o.logMessageContent)+"."),o.onreceive(t.data)}catch(e){return void o.close(e)}},s.onerror=function(t){var e=new Error(t.data||"Error occurred");r?o.close(e):i(e)},s.onopen=function(){o.logger.log(I.Information,"SSE connected to "+o.url),o.eventSource=s,r=!0,n()}}catch(l){return void i(l)}}else i(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))]}}))}))},t.prototype.send=function(t){return ut(this,void 0,void 0,(function(){return ht(this,(function(e){return this.eventSource?[2,F(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},t.prototype.stop=function(){return this.close(),Promise.resolve()},t.prototype.close=function(t){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(t))},t}(),pt=function(){function t(t,e,n,o,i){this.logger=n,this.accessTokenFactory=e,this.logMessageContent=o,this.webSocketConstructor=i,this.httpClient=t,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return n=this,void 0,i=function(){var n,o=this;return function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(i){switch(i.label){case 0:return T.isRequired(t,"url"),T.isRequired(e,"transferFormat"),T.isIn(e,rt,"transferFormat"),this.logger.log(I.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=i.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),i.label=2;case 2:return[2,new Promise((function(n,i){var r;t=t.replace(/^http/,"ws");var s=o.httpClient.getCookieString(t),a=!1;A.isNode&&s&&(r=new o.webSocketConstructor(t,void 0,{headers:{Cookie:""+s}})),r||(r=new o.webSocketConstructor(t)),e===rt.Binary&&(r.binaryType="arraybuffer"),r.onopen=function(e){o.logger.log(I.Information,"WebSocket connected to "+t+"."),o.webSocket=r,a=!0,n()},r.onerror=function(t){var e;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),i(e)},r.onmessage=function(t){o.logger.log(I.Trace,"(WebSockets transport) data received. "+M(t.data,o.logMessageContent)+"."),o.onreceive&&o.onreceive(t.data)},r.onclose=function(t){var e;a?o.close(t):(e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),i(e))}}))]}}))},new((o=void 0)||(o=Promise))((function(t,e){function r(t){try{a(i.next(t))}catch(n){e(n)}}function s(t){try{a(i.throw(t))}catch(n){e(n)}}function a(e){e.done?t(e.value):new o((function(t){t(e.value)})).then(r,s)}a((i=i.apply(n,[])).next())}));var n,o,i},t.prototype.send=function(t){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(I.Trace,"(WebSockets transport) sending data. "+M(t,this.logMessageContent)+"."),this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},t.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},t.prototype.close=function(t){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(I.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!t||!1!==t.wasClean&&1e3===t.code?this.onclose():this.onclose(new Error("WebSocket closed with status code: "+t.code+" ("+t.reason+").")))},t}(),ft=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function a(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}l((o=o.apply(t,e||[])).next())}))},gt=function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},mt=null,vt=null;if(A.isNode){var bt=require;mt=bt("ws"),vt=bt("eventsource")}var yt=function(){function t(t,e){var n;void 0===e&&(e={}),this.features={},this.negotiateVersion=1,T.isRequired(t,"url"),this.logger=void 0===(n=e.logger)?new H(I.Information):null===n?O.instance:n.log?n:new H(n),this.baseUrl=this.resolveUrl(t),(e=e||{}).logMessageContent=e.logMessageContent||!1,A.isNode||"undefined"==typeof WebSocket||e.WebSocket?A.isNode&&!e.WebSocket&&mt&&(e.WebSocket=mt):e.WebSocket=WebSocket,A.isNode||"undefined"==typeof EventSource||e.EventSource?A.isNode&&!e.EventSource&&void 0!==vt&&(e.EventSource=vt):e.EventSource=EventSource,this.httpClient=e.httpClient||new z(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=e,this.onreceive=null,this.onclose=null}return t.prototype.start=function(t){return ft(this,void 0,void 0,(function(){var e;return gt(this,(function(n){switch(n.label){case 0:return T.isIn(t=t||rt.Binary,rt,"transferFormat"),this.logger.log(I.Debug,"Starting connection with transfer format '"+rt[t]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting ",this.startInternalPromise=this.startInternal(t),[4,this.startInternalPromise]);case 1:return n.sent(),"Disconnecting"!==this.connectionState?[3,3]:(this.logger.log(I.Error,e="Failed to start the HttpConnection before stop() was called."),[4,this.stopPromise]);case 2:return n.sent(),[2,Promise.reject(new Error(e))];case 3:if("Connected"!==this.connectionState)return this.logger.log(I.Error,e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!"),[2,Promise.reject(new Error(e))];n.label=4;case 4:return this.connectionStarted=!0,[2]}}))}))},t.prototype.send=function(t){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new Pt(this.transport)),this.sendQueue.send(t))},t.prototype.stop=function(t){return ft(this,void 0,void 0,(function(){var e=this;return gt(this,(function(n){switch(n.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(I.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(I.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise((function(t){e.stopPromiseResolver=t})),[4,this.stopInternal(t)]);case 1:return n.sent(),[4,this.stopPromise];case 2:return n.sent(),[2]}}))}))},t.prototype.stopInternal=function(t){return ft(this,void 0,void 0,(function(){var e;return gt(this,(function(n){switch(n.label){case 0:this.stopError=t,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:case 3:return n.sent(),[3,4];case 4:if(!this.transport)return[3,9];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return n.sent(),[3,8];case 7:return e=n.sent(),this.logger.log(I.Error,"HttpConnection.transport.stop() threw error '"+e+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(I.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),this.stopConnection(),n.label=10;case 10:return[2]}}))}))},t.prototype.startInternal=function(t){return ft(this,void 0,void 0,(function(){var e,n,o,i,r,s;return gt(this,(function(a){switch(a.label){case 0:e=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,a.label=1;case 1:return a.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==it.WebSockets?[3,3]:(this.transport=this.constructTransport(it.WebSockets),[4,this.startTransport(e,t)]):[3,5];case 2:return a.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,o=0,i=function(){var t;return gt(this,(function(i){switch(i.label){case 0:return[4,r.getNegotiationResponse(e)];case 1:if(n=i.sent(),"Disconnecting"===r.connectionState||"Disconnected"===r.connectionState)throw new Error("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return n.url&&(e=n.url),n.accessToken&&(t=n.accessToken,r.accessTokenFactory=function(){return t}),o++,[2]}}))},r=this,a.label=6;case 6:return[5,i()];case 7:a.sent(),a.label=8;case 8:if(n.url&&o<100)return[3,6];a.label=9;case 9:if(100===o&&n.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(e,this.options.transport,n,t)];case 10:a.sent(),a.label=11;case 11:return this.transport instanceof ct&&(this.features.inherentKeepAlive=!0),"Connecting "===this.connectionState&&(this.logger.log(I.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return s=a.sent(),this.logger.log(I.Error,"Failed to start the connection: "+s),this.connectionState="Disconnected",this.transport=void 0,[2,Promise.reject(s)];case 13:return[2]}}))}))},t.prototype.getNegotiationResponse=function(t){return ft(this,void 0,void 0,(function(){var e,n,o,i,r,s,a;return gt(this,(function(l){switch(l.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(o=l.sent())&&((e={}).Authorization="Bearer "+o,n=e),l.label=2;case 2:i=this.resolveNegotiateUrl(t),this.logger.log(I.Debug,"Sending negotiation request: "+i+"."),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,this.httpClient.post(i,{content:"",headers:n})];case 4:return 200!==(r=l.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate "+r.statusCode))]:((!(s=JSON.parse(r.content)).negotiateVersion||s.negotiateVersion<1)&&(s.connectionToken=s.connectionId),[2,s]);case 5:return a=l.sent(),this.logger.log(I.Error,"Failed to complete negotiation with the server: "+a),[2,Promise.reject(a)];case 6:return[2]}}))}))},t.prototype.createConnectUrl=function(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+"id="+e:t},t.prototype.createTransport=function(t,e,n,o){return ft(this,void 0,void 0,(function(){var i,r,s,a,l,c,u,h,d;return gt(this,(function(p){switch(p.label){case 0:return i=this.createConnectUrl(t,n.connectionToken),this.isITransport(e)?(this.logger.log(I.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,[4,this.startTransport(i,o)]):[3,2];case 1:return p.sent(),this.connectionId=n.connectionId,[2];case 2:r=[],s=n,a=0,l=n.availableTransports||[],p.label=3;case 3:return a<l.length?(u=this.resolveTransportOrError(c=l[a],e,o))instanceof Error?(r.push(c.transport+" failed: "+u),[3,12]):[3,4]:[3,13];case 4:if(!this.isITransport(u))return[3,12];if(this.transport=u,s)return[3,9];p.label=5;case 5:return p.trys.push([5,7,,8]),[4,this.getNegotiationResponse(t)];case 6:return s=p.sent(),[3,8];case 7:return h=p.sent(),[2,Promise.reject(h)];case 8:i=this.createConnectUrl(t,s.connectionToken),p.label=9;case 9:return p.trys.push([9,11,,12]),[4,this.startTransport(i,o)];case 10:return p.sent(),this.connectionId=s.connectionId,[2];case 11:return d=p.sent(),this.logger.log(I.Error,"Failed to start the transport '"+c.transport+"': "+d),s=void 0,r.push(c.transport+" failed: "+d),"Connecting "!==this.connectionState?(this.logger.log(I.Debug,"Failed to select transport before stop() was called."),[2,Promise.reject(new Error("Failed to select transport before stop() was called."))]):[3,12];case 12:return a++,[3,3];case 13:return r.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+r.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}}))}))},t.prototype.constructTransport=function(t){switch(t){case it.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new pt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket);case it.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new dt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource);case it.LongPolling:return new ct(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1);default:throw new Error("Unknown transport: "+t+".")}},t.prototype.startTransport=function(t,e){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(t){return n.stopConnection(t)},this.transport.connect(t,e)},t.prototype.resolveTransportOrError=function(t,e,n){var o=it[t.transport];if(null==o)return this.logger.log(I.Debug,"Skipping transport '"+t.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+t.transport+"' because it is not supported by this client.");if(!function(t,e){return!t||0!=(e&t)}(e,o))return this.logger.log(I.Debug,"Skipping transport '"+it[o]+"' because it was disabled by the client."),new Error("'"+it[o]+"' is disabled by the client.");if(!(t.transferFormats.map((function(t){return rt[t]})).indexOf(n)>=0))return this.logger.log(I.Debug,"Skipping transport '"+it[o]+"' because it does not support the requested transfer format '"+rt[n]+"'."),new Error("'"+it[o]+"' does not support "+rt[n]+".");if(o===it.WebSockets&&!this.options.WebSocket||o===it.ServerSentEvents&&!this.options.EventSource)return this.logger.log(I.Debug,"Skipping transport '"+it[o]+"' because it is not supported in your environment.'"),new Error("'"+it[o]+"' is not supported in your environment.");this.logger.log(I.Debug,"Selecting transport '"+it[o]+"'.");try{return this.constructTransport(o)}catch(i){return i}},t.prototype.isITransport=function(t){return t&&"object"==typeof t&&"connect"in t},t.prototype.stopConnection=function(t){var e=this;if(this.logger.log(I.Debug,"HttpConnection.stopConnection("+t+") called while in state "+this.connectionState+"."),this.transport=void 0,t=this.stopError||t,this.stopError=void 0,"Disconnected"!==this.connectionState)if("Connecting "!==this.connectionState){if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),t?this.logger.log(I.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(I.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch((function(t){e.logger.log(I.Error,"TransportSendQueue.stop() threw error '"+t+"'.")})),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(n){this.logger.log(I.Error,"HttpConnection.onclose("+t+") threw error '"+n+"'.")}}}else this.logger.log(I.Warning,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection hasn't yet left the in the connecting state.");else this.logger.log(I.Debug,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is already in the disconnected state.")},t.prototype.resolveUrl=function(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!A.isBrowser||!window.document)throw new Error("Cannot resolve '"+t+"'.");var e=window.document.createElement("a");return e.href=t,this.logger.log(I.Information,"Normalizing '"+t+"' to '"+e.href+"'."),e.href},t.prototype.resolveNegotiateUrl=function(t){var e=t.indexOf("?"),n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",-1===(n+=-1===e?"":t.substring(e)).indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this.negotiateVersion),n},t}(),Pt=function(){function t(t){this.transport=t,this.buffer=[],this.executing=!0,this.sendBufferedData=new Ct,this.transportResult=new Ct,this.sendLoopPromise=this.sendLoop()}return t.prototype.send=function(t){return this.bufferData(t),this.transportResult||(this.transportResult=new Ct),this.transportResult.promise},t.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},t.prototype.bufferData=function(t){if(this.buffer.length&&typeof this.buffer[0]!=typeof t)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof t);this.buffer.push(t),this.sendBufferedData.resolve()},t.prototype.sendLoop=function(){return ft(this,void 0,void 0,(function(){var e,n,o;return gt(this,(function(i){switch(i.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(i.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new Ct,e=this.transportResult,this.transportResult=void 0,n="string"==typeof this.buffer[0]?this.buffer.join(""):t.concatBuffers(this.buffer),this.buffer.length=0,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.transport.send(n)];case 3:return i.sent(),e.resolve(),[3,5];case 4:return o=i.sent(),e.reject(o),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},t.concatBuffers=function(t){for(var e=t.map((function(t){return t.byteLength})).reduce((function(t,e){return t+e})),n=new Uint8Array(e),o=0,i=0,r=t;i<r.length;i++){var s=r[i];n.set(new Uint8Array(s),o),o+=s.byteLength}return n},t}(),Ct=function(){function t(){var t=this;this.promise=new Promise((function(e,n){var o;return t.resolver=(o=[e,n])[0],t.rejecter=o[1],o}))}return t.prototype.resolve=function(){this.resolver()},t.prototype.reject=function(t){this.rejecter(t)},t}(),xt=function(){function t(){this.name="json",this.version=1,this.transferFormat=rt.Text}return t.prototype.parseMessages=function(t,e){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===e&&(e=O.instance);for(var n=[],o=0,i=V.parse(t);o<i.length;o++){var r=JSON.parse(i[o]);if("number"!=typeof r.type)throw new Error("Invalid payload.");switch(r.type){case J.Invocation:this.isInvocationMessage(r);break;case J.StreamItem:this.isStreamItemMessage(r);break;case J.Completion:this.isCompletionMessage(r);break;case J.Ping:case J.Close:break;default:e.log(I.Information,"Unknown message type '"+r.type+"' ignored.");continue}n.push(r)}return n},t.prototype.writeMessage=function(t){return V.write(JSON.stringify(t))},t.prototype.isInvocationMessage=function(t){this.assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")},t.prototype.isStreamItemMessage=function(t){if(this.assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")},t.prototype.isCompletionMessage=function(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.assertNotEmptyString(t.error,"Invalid payload for Completion message."),this.assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")},t.prototype.assertNotEmptyString=function(t,e){if("string"!=typeof t||""===t)throw new Error(e)},t}(),_t=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},St={trace:I.Trace,debug:I.Debug,info:I.Information,information:I.Information,warn:I.Warning,warning:I.Warning,error:I.Error,critical:I.Critical,none:I.None},wt=function(){function t(){}return t.prototype.configureLogging=function(t){if(T.isRequired(t,"logging"),void 0!==t.log)this.logger=t;else if("string"==typeof t){var e=function(t){var e=St[t.toLowerCase()];if(void 0!==e)return e;throw new Error("Unknown log level: "+t)}(t);this.logger=new H(e)}else this.logger=new H(t);return this},t.prototype.withUrl=function(t,e){return T.isRequired(t,"url"),this.url=t,this.httpConnectionOptions=_t({},this.httpConnectionOptions,"object"==typeof e?e:{transport:e}),this},t.prototype.withHubProtocol=function(t){return T.isRequired(t,"protocol"),this.protocol=t,this},t.prototype.withAutomaticReconnect=function(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=t?Array.isArray(t)?new ot(t):t:new ot,this},t.prototype.build=function(){var t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var e=new yt(this.url,t);return et.create(e,this.logger||O.instance,this.protocol||new xt,this.reconnectPolicy)},t}();let Et=(()=>{class t{constructor(){}get url(){return this.connectionUrl}setConnectionUrl(t){this.connectionUrl||(this.connectionUrl=t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),jt=(()=>{class t{constructor(t){this.settings=t}start(){return C(this,void 0,void 0,(function*(){this.connection=(new wt).withUrl(this.settings.url).configureLogging(I.Trace).withAutomaticReconnect().build(),yield this.connection.start()}))}stop(){return C(this,void 0,void 0,(function*(){yield this.connection.stop()}))}getNodeDescriptions(){return C(this,void 0,void 0,(function*(){return yield this.connection.invoke("GetNodeDescriptions",{})}))}}return t.\u0275fac=function(e){return new(e||t)(s.Ub(Et))},t.\u0275prov=s.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Dt=(()=>{class t{constructor(t,e){this.http=t,this.connection=e,this.configurationUrl="assets/data/node-configuration.json",this.nodeDescriptionSubject=new y.a}get nodeDescriptions$(){return this.nodeDescriptionSubject.asObservable()}getConfigurations(){return this.http.get(this.configurationUrl)}getNodeDescriptions(){this.connection.getNodeDescriptions().then(t=>this.nodeDescriptionSubject.next(t))}}return t.\u0275fac=function(e){return new(e||t)(s.Ub(P.a),s.Ub(jt))},t.\u0275prov=s.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var kt=n("lQ7A");function It(t,e){if(1&t){const t=s.Rb();s.Qb(0,"div",5),s.Xb("click",(function(){s.jc(t);const n=e.$implicit;return s.bc().handleItemClicked(n)})),s.Qb(1,"div",6),s.qc(2),s.Pb(),s.Qb(3,"div",7),s.Qb(4,"p"),s.qc(5),s.Pb(),s.Pb(),s.Mb(6,"div",8),s.Pb()}if(2&t){const t=e.$implicit;s.zb(2),s.tc(" ",t.name," (",t.version,") "),s.zb(3),s.rc(t.name)}}let Ot=(()=>{class t{constructor(t,e,n,o){this.editorConfiguration=t,this.toolboxService=e,this.connection=n,this.router=o,this.editorItemClicked=new s.n,this.nodeDescriptions$=this.editorConfiguration.nodeDescriptions$}ngOnInit(){this.editorConfiguration.getNodeDescriptions()}handleItemClicked(t){this.editorItemClicked.emit(t),this.toolboxService.toggle()}disconnect(){return C(this,void 0,void 0,(function*(){yield this.connection.stop(),this.router.navigate([""])}))}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(Dt),s.Lb(b.a),s.Lb(jt),s.Lb(c.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["opui-editor-toolbox"]],outputs:{editorItemClicked:"editorItemClicked"},decls:7,vars:3,consts:[[1,"op-editor-toolbox"],[1,"op-editor-toolbox-items"],["class","op-editor-toolbox-item",3,"click",4,"ngFor","ngForOf"],[1,"op-editor-toolbox-actions"],["mat-flat-button","","color","danger",3,"click"],[1,"op-editor-toolbox-item",3,"click"],[1,"op-editor-toolbox-item-title"],[1,"op-editor-toolbox-item-details"],[1,"op-editor-toolbox-item-actions"]],template:function(t,e){1&t&&(s.Qb(0,"div",0),s.Qb(1,"div",1),s.pc(2,It,7,3,"div",2),s.cc(3,"async"),s.Pb(),s.Qb(4,"div",3),s.Qb(5,"button",4),s.Xb("click",(function(){return e.disconnect()})),s.qc(6,"Disconnect"),s.Pb(),s.Pb(),s.Pb()),2&t&&(s.zb(2),s.gc("ngForOf",s.dc(3,1,e.nodeDescriptions$)))},directives:[r.i,f.a],pipes:[r.b],styles:[".op-editor-toolbox[_ngcontent-%COMP%]{width:250px;display:flex;flex-direction:column;height:100%}.op-editor-toolbox[_ngcontent-%COMP%]   .op-editor-toolbox-items[_ngcontent-%COMP%]{flex:1 1 100%}.op-editor-toolbox[_ngcontent-%COMP%]   .op-editor-toolbox-item[_ngcontent-%COMP%]{background-color:var(--light-blue);color:var(--white);margin:8px;padding:8px;border-radius:16px}.op-editor-toolbox[_ngcontent-%COMP%]   .op-editor-toolbox-actions[_ngcontent-%COMP%]{padding:1rem}"]}),t})();function Tt(t,e){if(1&t&&(s.Ob(0),s.Qb(1,"div",7),s.qc(2),s.Pb(),s.Nb()),2&t){const t=e.$implicit;s.zb(1),s.gc("id",t.id),s.zb(1),s.sc(" ",t.name," ")}}function At(t,e){if(1&t&&(s.Ob(0),s.Qb(1,"div",8),s.qc(2),s.Pb(),s.Nb()),2&t){const t=e.$implicit;s.zb(1),s.gc("id",t.id),s.zb(1),s.sc(" ",t.name," ")}}function Mt(t,e){if(1&t){const t=s.Rb();s.Qb(0,"div",9),s.Qb(1,"div",10),s.Xb("click",(function(e){return s.jc(t),s.bc(2).delete(e)})),s.ac(),s.Qb(2,"svg",11),s.Mb(3,"use",12),s.Pb(),s.Pb(),s.Zb(),s.Qb(4,"div",13),s.Xb("click",(function(e){return s.jc(t),s.bc(2).edit(e)})),s.ac(),s.Qb(5,"svg",11),s.Mb(6,"use",14),s.Pb(),s.Pb(),s.Pb()}}function Lt(t,e){if(1&t){const t=s.Rb();s.Ob(0),s.Qb(1,"div",1),s.Xb("click",(function(e){return s.jc(t),s.bc().select(e)})),s.Qb(2,"div",2),s.pc(3,Tt,3,2,"ng-container",3),s.Pb(),s.Qb(4,"div",4),s.Qb(5,"p"),s.qc(6),s.Pb(),s.Pb(),s.Qb(7,"div",5),s.pc(8,At,3,2,"ng-container",3),s.Pb(),s.Pb(),s.pc(9,Mt,7,0,"div",6),s.Nb()}if(2&t){const t=s.bc();s.zb(3),s.gc("ngForOf",t.configuration.inputs),s.zb(3),s.rc(t.configuration.name),s.zb(2),s.gc("ngForOf",t.configuration.outputs),s.zb(1),s.gc("ngIf",t.selected)}}let Ft=(()=>{class t{constructor(){this.selectClick=new s.n,this.editClick=new s.n,this.deleteClick=new s.n,this.className="op-node",this.isNodeSelected=!1}get top(){return this.configuration.position.top+"px"}set top(t){this.configuration.position.top=Number(t.substring(0,t.length-2))}get left(){return this.configuration.position.left+"px"}set left(t){this.configuration.position.left=Number(t.substring(0,t.length-2))}get selected(){return this.isNodeSelected}set selected(t){this.isNodeSelected=t}ngOnInit(){}select(t){t.stopPropagation(),this.selectClick.emit(this.configuration)}edit(t){t.stopPropagation(),this.editClick.emit(this.configuration)}delete(t){t.stopPropagation(),this.deleteClick.emit(this.configuration)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Fb({type:t,selectors:[["opui-node"]],hostVars:8,hostBindings:function(t,e){2&t&&(s.Bb(e.className),s.oc("top",e.top)("left",e.left),s.Cb("op-node-selected",e.isNodeSelected))},inputs:{configuration:"configuration",selected:"selected"},outputs:{selectClick:"selectClick",editClick:"editClick",deleteClick:"deleteClick"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"op-node-spacing",3,"click"],[1,"op-node-inputs"],[4,"ngFor","ngForOf"],[1,"op-node-title"],[1,"op-node-outputs"],["class","op-node-actions",4,"ngIf"],[1,"op-node-endpoint-input",3,"id"],[1,"op-node-endpoint-output",3,"id"],[1,"op-node-actions"],[1,"op-node-action","delete",3,"click"],[1,"icon"],[0,"xlink","href","assets/icons.svg#icon-delete"],[1,"op-node-action","edit",3,"click"],[0,"xlink","href","assets/icons.svg#icon-edit"]],template:function(t,e){1&t&&s.pc(0,Lt,10,4,"ng-container",0),2&t&&s.gc("ngIf",e.configuration)},directives:[r.j,r.i],styles:[".op-node[_nghost-%COMP%]{border-radius:16px;border:2px solid var(--transparent,transparent);box-sizing:content-box;color:var(--white,#fff);cursor:pointer;display:block;position:absolute}.op-node.op-node-selected[_nghost-%COMP%]{background-origin:border-box;border:2px solid var(--light-grey,#ababab)}.op-node[_nghost-%COMP%] > .op-node-spacing[_ngcontent-%COMP%]{background-color:var(--light-blue,#1db9ff);border-radius:13px;box-shadow:2px 2px 6px var(--light-grey);display:flex;flex-direction:row;margin:16px}.op-node[_nghost-%COMP%] > .op-node-spacing[_ngcontent-%COMP%] > .op-node-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin:auto;width:150px;max-width:150px;text-align:center}.op-node[_nghost-%COMP%] > .op-node-spacing[_ngcontent-%COMP%] > .op-node-inputs[_ngcontent-%COMP%], .op-node[_nghost-%COMP%] > .op-node-spacing[_ngcontent-%COMP%] > .op-node-outputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.op-node[_nghost-%COMP%] > .op-node-spacing[_ngcontent-%COMP%]   .op-node-endpoint-output[_ngcontent-%COMP%]{font-size:.8rem;padding:10px 35px 15px 15px}.op-node[_nghost-%COMP%] > .op-node-spacing[_ngcontent-%COMP%]   .op-node-endpoint-input[_ngcontent-%COMP%]{font-size:.8rem;padding:10px 15px 15px 35px}.op-node[_nghost-%COMP%] > .op-node-actions[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;flex-direction:row;justify-content:space-between;max-width:100%;padding:0 16px;position:absolute;top:-1px;transform:translateY(-50%);width:100%}.op-node[_nghost-%COMP%] > .op-node-actions[_ngcontent-%COMP%] > .op-node-action[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:50%;position:relative;text-align:center}.op-node[_nghost-%COMP%] > .op-node-actions[_ngcontent-%COMP%] > .op-node-action.delete[_ngcontent-%COMP%]{background-color:red}.op-node[_nghost-%COMP%] > .op-node-actions[_ngcontent-%COMP%] > .op-node-action.edit[_ngcontent-%COMP%]{background-color:var(--light-blue)}.op-node[_nghost-%COMP%] > .op-node-actions[_ngcontent-%COMP%] > .op-node-action.edit[_ngcontent-%COMP%]   svg.icon[_ngcontent-%COMP%]{width:20px;height:20px}.op-node[_nghost-%COMP%] > .op-node-actions[_ngcontent-%COMP%] > .op-node-action[_ngcontent-%COMP%]   svg.icon[_ngcontent-%COMP%]{position:relative;top:50%;transform:translateY(-50%);width:16px;height:16px;fill:var(--white,#fff)}"]}),t})();function Nt(t,e){if(1&t){const t=s.Rb();s.Ob(0),s.Qb(1,"opui-node",6),s.Xb("selectClick",(function(e){return s.jc(t),s.bc().selectNode(e)}))("editClick",(function(e){return s.jc(t),s.bc().editNode(e)}))("deleteClick",(function(e){return s.jc(t),s.bc().deleteNode(e)})),s.Pb(),s.Nb()}if(2&t){const t=e.$implicit,n=s.bc();s.zb(1),s.gc("id",t.id)("configuration",t)("selected",(null==n.selectedNode?null:n.selectedNode.id)===(null==t?null:t.id))}}let Rt=(()=>{class t{constructor(t,e,n,o,i){this.toolbox=t,this.editorConfigurations=e,this.matDialog=n,this.settings=o,this.router=i}get toolboxOpen$(){return this.toolbox.toolboxOpen$}ngOnInit(){this.settings.url?this.loadPromise=this.editorConfigurations.getConfigurations().subscribe(t=>{this.nodeConfigurations=t,this.nodeCount=t.length,setTimeout(()=>this.initNodes(this.nodeConfigurations),0)}):this.router.navigate([""])}ngAfterViewInit(){this.initJsPlumb()}ngOnDestroy(){this.loadPromise&&this.loadPromise.unsubscribe()}selectNode(t){console.log("select:",t),this.selectedNode=t}editNode(t){console.log("edit:",t),this.matDialog.open(v,{panelClass:"op-node-editor-panel",disableClose:!0,data:{node:t}})}createNewNode(t){const e={id:"node"+ ++this.nodeCount,name:t.name+" (new)",type:t,outputs:[],inputs:[],position:{left:0,top:0}};this.nodeConfigurations.push(e),setTimeout(()=>this.addNode(e))}deleteNode(t){console.log("delete:",t)}initJsPlumb(){this.jsPlumbInstance=u.jsPlumb.getInstance({Container:"op-editor-page",DragOptions:{containment:"op-editor-page"}})}initNodes(t){this.jsPlumbInstance.reset();for(const e of t)this.addNode(e)}addNode(t){this.jsPlumbInstance.draggable(t.id);for(const e of t.inputs)this.jsPlumbInstance.addEndpoint(e.id,{isTarget:!0,isSource:!1,maxConnections:1,anchor:[0,0,0,0,20,20],connectorClass:"connector",endpoint:["Dot",{radius:8,cssClass:"startpoint"}],paintStyle:{strokeWidth:4,stroke:"white"}});for(const e of t.outputs)this.jsPlumbInstance.addEndpoint(e.id,{isTarget:!1,isSource:!0,maxConnections:1,anchor:[1,0,0,0,-20,20],connectorClass:"connector",endpoint:["Dot",{radius:8,hoverClass:"endpointHover",cssClass:"endpoint"}],paintStyle:{strokeWidth:4,stroke:"white"}});this.jsPlumbInstance.repaintEverything()}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(b.a),s.Lb(Dt),s.Lb(h.b),s.Lb(Et),s.Lb(c.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-editor-page"]],decls:7,vars:5,consts:[["autosize","",1,"op-editor-page-drawer-container"],["mode","over",1,"op-editor-page-drawer",3,"disableClose","opened"],[3,"editorItemClicked"],[1,"op-editor-page-drawer-content"],["id","op-editor-page",1,"op-editor-page"],[4,"ngFor","ngForOf"],[3,"id","configuration","selected","selectClick","editClick","deleteClick"]],template:function(t,e){1&t&&(s.Qb(0,"mat-drawer-container",0),s.Qb(1,"mat-drawer",1),s.cc(2,"async"),s.Qb(3,"opui-editor-toolbox",2),s.Xb("editorItemClicked",(function(t){return e.createNewNode(t)})),s.Pb(),s.Pb(),s.Qb(4,"mat-drawer-content",3),s.Qb(5,"div",4),s.pc(6,Nt,2,3,"ng-container",5),s.Pb(),s.Pb(),s.Pb()),2&t&&(s.zb(1),s.gc("disableClose",!0)("opened",s.dc(2,3,e.toolboxOpen$)),s.zb(5),s.gc("ngForOf",e.nodeConfigurations))},directives:[kt.b,kt.a,Ot,kt.c,r.i,Ft],pipes:[r.b],styles:[".op-editor-page[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%;width:100%}.op-editor-page[_ngcontent-%COMP%]{display:block;position:relative}.mat-drawer-container.op-editor-page-drawer-container[_ngcontent-%COMP%]{height:100%}"]}),t})();var Ht=n("Meci");let Ut=(()=>{class t{constructor(){this.endpointSelected=new s.n}ngOnInit(){}connect(t){this.endpointSelected.emit(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Fb({type:t,selectors:[["opui-endpoint-selection"]],outputs:{endpointSelected:"endpointSelected"},decls:13,vars:1,consts:[[1,"example-full-width"],["matInput","","type","url","required",""],["urlInput",""],[3,"align"],["type","button","mat-flat-button","","color","primary",3,"click"]],template:function(t,e){if(1&t){const t=s.Rb();s.Qb(0,"mat-card"),s.Qb(1,"mat-card-header"),s.Qb(2,"mat-card-title"),s.qc(3," Please enter your connection endpoint "),s.Pb(),s.Pb(),s.Qb(4,"mat-card-content"),s.Qb(5,"mat-form-field",0),s.Qb(6,"mat-label"),s.qc(7,"OctoPatch Endpoint URL"),s.Pb(),s.Mb(8,"input",1,2),s.Pb(),s.Pb(),s.Qb(10,"mat-card-actions",3),s.Qb(11,"button",4),s.Xb("click",(function(){s.jc(t);const n=s.ic(9);return e.connect(n.value)})),s.qc(12," Connect "),s.Pb(),s.Pb(),s.Pb()}2&t&&(s.zb(10),s.gc("align","end"))},directives:[Ht.a,Ht.d,Ht.f,Ht.c,d.b,d.e,p.a,Ht.b,f.a],styles:[".mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),t})(),Gt=(()=>{class t{constructor(t,e,n){this.connectionSettings=t,this.connection=e,this.router=n}ngOnInit(){}configureEndpoint(t){return C(this,void 0,void 0,(function*(){this.connectionSettings.setConnectionUrl(t),yield this.connection.start().then(t=>{this.router.navigate(["editor"])}).catch(t=>{alert(JSON.stringify(t))})}))}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(Et),s.Lb(jt),s.Lb(c.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-connection-page"]],decls:2,vars:0,consts:[[1,"op-connection-page"],[3,"endpointSelected"]],template:function(t,e){1&t&&(s.Qb(0,"div",0),s.Qb(1,"opui-endpoint-selection",1),s.Xb("endpointSelected",(function(t){return e.configureEndpoint(t)})),s.Pb(),s.Pb())},directives:[Ut],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;align-items:center;justify-content:center}"]}),t})(),Bt=(()=>{class t{}return t.\u0275mod=s.Jb({type:t}),t.\u0275inj=s.Ib({factory:function(e){return new(e||t)},imports:[[r.c,a,l.a,i.a,c.b.forChild([{path:"",component:Gt},{path:"editor",component:Rt}])]]}),t})()}}]);